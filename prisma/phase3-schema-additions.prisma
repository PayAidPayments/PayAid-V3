// Phase 3: Industry-Specific Modules - Database Schema Additions
// Add these models to prisma/schema.prisma

// ============================================
// FIELD SERVICE MODULE
// ============================================

model FieldServiceWorkOrder {
  id                String   @id @default(cuid())
  tenantId          String
  workOrderNumber   String
  customerId        String?  // Link to Contact
  customerName      String
  customerPhone     String?
  customerEmail     String?
  customerAddress   String?
  serviceType       String   // Installation, Repair, Maintenance, Inspection
  priority          String   @default("NORMAL") // LOW, NORMAL, HIGH, URGENT
  status            String   @default("SCHEDULED") // SCHEDULED, IN_PROGRESS, COMPLETED, CANCELLED
  assignedTechnicianId String?
  scheduledDate     DateTime?
  scheduledTime     String?  // Time slot
  completedDate     DateTime?
  estimatedDuration Int?     // in minutes
  actualDuration    Int?
  description       String?
  notes             String?
  gpsLatitude       Decimal? @db.Decimal(10, 8)
  gpsLongitude      Decimal? @db.Decimal(10, 8)
  invoiceId         String?  // Link to Invoice
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  technician        User?    @relation("FieldServiceTechnician", fields: [assignedTechnicianId], references: [id])
  parts             FieldServicePart[]
  history          FieldServiceHistory[]

  @@unique([tenantId, workOrderNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, scheduledDate])
  @@index([assignedTechnicianId])
}

model FieldServicePart {
  id                String   @id @default(cuid())
  workOrderId       String
  partName          String
  partNumber        String?
  quantity          Int      @default(1)
  unitPrice         Decimal? @db.Decimal(10, 2)
  totalPrice        Decimal? @db.Decimal(10, 2)
  workOrder         FieldServiceWorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([workOrderId])
}

model FieldServiceHistory {
  id                String   @id @default(cuid())
  workOrderId       String
  technicianId      String?
  action            String   // CREATED, ASSIGNED, STARTED, COMPLETED, CANCELLED
  notes             String?
  gpsLatitude       Decimal? @db.Decimal(10, 8)
  gpsLongitude      Decimal? @db.Decimal(10, 8)
  timestamp         DateTime @default(now())
  workOrder         FieldServiceWorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([workOrderId])
  @@index([technicianId])
  @@index([timestamp])
}

// ============================================
// ASSET MANAGEMENT MODULE
// ============================================

model Asset {
  id                String   @id @default(cuid())
  tenantId          String
  assetNumber       String
  name              String
  category          String?  // Equipment, Vehicle, Furniture, IT, etc.
  subCategory       String?
  brand             String?
  model             String?
  serialNumber      String?
  barcode           String?
  qrCode            String?
  purchaseDate      DateTime?
  purchasePrice     Decimal? @db.Decimal(12, 2)
  currentValue      Decimal? @db.Decimal(12, 2)
  depreciationMethod String? // STRAIGHT_LINE, DECLINING_BALANCE, UNITS_OF_PRODUCTION
  usefulLife        Int?     // in years
  location          String?
  assignedTo        String?  // Employee ID or Department
  status            String   @default("ACTIVE") // ACTIVE, MAINTENANCE, RETIRED, DISPOSED
  warrantyExpiry    DateTime?
  lastMaintenanceDate DateTime?
  nextMaintenanceDate DateTime?
  notes             String?
  images            String[] // URLs
  documents         String[] // URLs
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  maintenanceRecords AssetMaintenance[]
  depreciationRecords AssetDepreciation[]

  @@unique([tenantId, assetNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, category])
  @@index([barcode])
  @@index([serialNumber])
}

model AssetMaintenance {
  id                String   @id @default(cuid())
  assetId           String
  maintenanceType   String   // PREVENTIVE, CORRECTIVE, INSPECTION
  scheduledDate     DateTime?
  completedDate     DateTime?
  technician        String?
  cost              Decimal? @db.Decimal(10, 2)
  description       String?
  notes             String?
  status            String   @default("SCHEDULED") // SCHEDULED, IN_PROGRESS, COMPLETED, CANCELLED
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  asset             Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([scheduledDate])
  @@index([status])
}

model AssetDepreciation {
  id                String   @id @default(cuid())
  assetId           String
  period            DateTime // Month/Year
  openingValue      Decimal  @db.Decimal(12, 2)
  depreciationAmount Decimal @db.Decimal(12, 2)
  closingValue      Decimal  @db.Decimal(12, 2)
  createdAt         DateTime @default(now())
  asset             Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@unique([assetId, period])
  @@index([assetId])
  @@index([period])
}

// ============================================
// E-COMMERCE MODULE (Enhanced)
// ============================================

model EcommerceStore {
  id                String   @id @default(cuid())
  tenantId          String
  name              String
  domain            String?  @unique
  subdomain         String?  @unique
  theme             String   @default("default")
  logo              String?
  favicon           String?
  primaryColor      String?  @default("#3B82F6")
  isActive          Boolean  @default(true)
  settings          Json?    // Store settings
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  products          EcommerceProduct[]
  orders            EcommerceOrder[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([domain])
  @@index([subdomain])
}

model EcommerceProduct {
  id                String   @id @default(cuid())
  storeId           String
  tenantId          String
  sku               String
  name              String
  description       String?
  shortDescription  String?
  price             Decimal  @db.Decimal(10, 2)
  compareAtPrice    Decimal? @db.Decimal(10, 2)
  costPrice         Decimal? @db.Decimal(10, 2)
  inventoryQuantity Int      @default(0)
  trackInventory    Boolean  @default(true)
  weight            Decimal? @db.Decimal(10, 2)
  images            String[]
  category          String?
  tags              String[]
  isActive          Boolean  @default(true)
  isDigital         Boolean  @default(false)
  seoTitle          String?
  seoDescription    String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  store             EcommerceStore @relation(fields: [storeId], references: [id], onDelete: Cascade)
  orderItems        EcommerceOrderItem[]

  @@unique([storeId, sku])
  @@index([storeId])
  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isActive])
}

model EcommerceOrder {
  id                String   @id @default(cuid())
  storeId           String
  tenantId          String
  orderNumber       String
  customerEmail     String
  customerName      String?
  customerPhone     String?
  shippingAddress   Json?    // Full address object
  billingAddress    Json?
  status            String   @default("PENDING") // PENDING, CONFIRMED, PROCESSING, SHIPPED, DELIVERED, CANCELLED, REFUNDED
  paymentStatus     String   @default("PENDING") // PENDING, PAID, FAILED, REFUNDED
  paymentMethod     String?  // PayAid Payments, COD, etc.
  subtotal          Decimal  @db.Decimal(10, 2)
  tax               Decimal  @db.Decimal(10, 2)
  shipping          Decimal  @db.Decimal(10, 2)
  discount          Decimal  @db.Decimal(10, 2) @default(0)
  total             Decimal  @db.Decimal(10, 2)
  currency          String   @default("INR")
  shippingMethod    String?
  trackingNumber    String?
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  store             EcommerceStore @relation(fields: [storeId], references: [id], onDelete: Cascade)
  items             EcommerceOrderItem[]

  @@unique([storeId, orderNumber])
  @@index([storeId])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, paymentStatus])
  @@index([customerEmail])
}

model EcommerceOrderItem {
  id                String   @id @default(cuid())
  orderId           String
  productId         String?
  productName       String
  productSku       String?
  quantity          Int
  unitPrice         Decimal  @db.Decimal(10, 2)
  totalPrice        Decimal  @db.Decimal(10, 2)
  order             EcommerceOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product           EcommerceProduct? @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@index([orderId])
  @@index([productId])
}

// ============================================
// MANUFACTURING MODULE (Enhanced)
// ============================================

model ManufacturingBOM {
  id                String   @id @default(cuid())
  tenantId          String
  bomNumber         String
  productName       String
  productSku        String?
  version           String   @default("1.0")
  isActive          Boolean  @default(true)
  items             Json     // Array of BOM items with material, quantity, unit
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, bomNumber])
  @@index([tenantId])
  @@index([tenantId, isActive])
}

model ManufacturingQualityControl {
  id                String   @id @default(cuid())
  tenantId          String
  orderId           String?  // Link to ManufacturingOrder
  inspectionType    String   // INCOMING, IN_PROCESS, FINAL
  inspectorName     String
  inspectionDate    DateTime
  passed            Boolean
  defects           Json?    // Array of defects found
  notes             String?
  createdAt         DateTime @default(now())
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([orderId])
  @@index([inspectionDate])
}

