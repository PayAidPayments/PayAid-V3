generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                       String                    @id @default(cuid())
  name                     String
  subdomain                String?                   @unique
  domain                   String?                   @unique
  plan                     String                    @default("free")
  status                   String                    @default("active")
  industry                 String?
  industrySubType          String?
  industrySettings         Json?
  invoiceSettings          Json?
  gstin                    String?
  address                  String?
  city                     String?
  state                    String?
  postalCode               String?
  country                  String?                   @default("India")
  phone                    String?
  email                    String?
  website                  String?
  logo                     String?
  maxContacts              Int                       @default(50)
  maxInvoices              Int                       @default(10)
  maxUsers                 Int                       @default(1)
  maxStorage               Int                       @default(1024)
  subscriptionId           String?
  currentPeriodEnd         DateTime?
  googleAiStudioApiKey     String?
  licensedModules          String[]                  @default([])
  subscriptionTier         String                    @default("free")
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  aiCalls                  AICall[]
  aiCofounderConversations AICofounderConversation[]
  aiUsage                  AIUsage[]
  alerts                   Alert[]
  assets                   Asset[]
  assetAssignments         AssetAssignment[]
  attendanceRecords        AttendanceRecord[]
  auditLogs                AuditLog[]
  budgetLines              BudgetLine[]
  crmConfig                CRMConfig?
  callFAQs                 CallFAQ[]
  callRecordings           CallRecording[]
  callTranscripts          CallTranscript[]
  campaigns                Campaign[]
  candidates               Candidate[]
  chatWorkspaces           ChatWorkspace?
  chatbotConversations     ChatbotConversation[]
  checkoutPages            CheckoutPage[]
  contacts                 Contact[]
  customDashboards         CustomDashboard[]
  customFields             CustomField[]
  customReports            CustomReport[]
  deals                    Deal[]
  departments              Department[]              @relation("TenantDepartments")
  designations             Designation[]             @relation("TenantDesignations")
  esiConfigs               ESIConfig?
  emailAccounts            EmailAccount[]
  EmailAutoResponder       EmailAutoResponder[]
  emailBounces             EmailBounce[]
  EmailForwardingRule      EmailForwardingRule[]
  emailTemplates           EmailTemplate[]
  employees                Employee[]
  employeeDocuments        EmployeeDocument[]
  employeeSalaryStructures EmployeeSalaryStructure[]
  employeeTaxDeclarations  EmployeeTaxDeclaration[]
  events                   Event[]
  eventRegistrations       EventRegistration[]
  exitInstances            ExitInstance[]
  exitTemplates            ExitTemplate[]
  expenses                 Expense[]
  expenseApprovals         ExpenseApproval[]
  featureToggles           FeatureToggle[]
  goodsReceipts            GoodsReceipt[]
  hrDocumentTemplates      HRDocumentTemplate[]
  healthcareAppointments   HealthcareAppointment[]
  healthcarePatients       HealthcarePatient[]
  holidayCalendars         HolidayCalendar[]
  invoices                 Invoice[]
  invoicingConfig          InvoicingConfig?
  jobRequisitions          JobRequisition[]
  knowledgeDocuments       KnowledgeDocument[]
  knowledgeQueries         KnowledgeQuery[]
  landingPages             LandingPage[]
  leadSources              LeadSource[]
  leaveBalances            LeaveBalance[]
  leavePolicies            LeavePolicy[]
  leaveRequests            LeaveRequest[]
  leaveTypes               LeaveType[]
  locations                Location[]                @relation("TenantLocations")
  logos                    Logo[]
  logoVariations           LogoVariation[]
  loyaltyPoints            LoyaltyPoints[]
  loyaltyPrograms          LoyaltyProgram[]
  loyaltyTransactions      LoyaltyTransaction[]
  manufacturingMaterials   ManufacturingMaterial[]
  manufacturingOrders      ManufacturingOrder[]
  mediaLibrary             MediaLibrary[]
  newsItems                NewsItem[]
  nurtureEnrollments       NurtureEnrollment[]
  nurtureTemplates         NurtureTemplate[]
  oauthIntegrations        OAuthIntegration[]
  offers                   Offer[]
  onboardingInstances      OnboardingInstance[]
  onboardingTemplates      OnboardingTemplate[]
  orders                   Order[]
  pfConfigs                PFConfig?
  ptConfigs                PTConfig[]
  payrollCycles            PayrollCycle[]
  payrollRuns              PayrollRun[]
  products                 Product[]
  productionSchedules      ProductionSchedule[]
  projects                 Project[]
  purchaseOrders           PurchaseOrder[]
  realEstateAdvances       RealEstateAdvance[]
  realEstateProperties     RealEstateProperty[]
  reports                  Report[]
  reportTemplates          ReportTemplate[]
  restaurantMenuItems      RestaurantMenuItem[]
  restaurantOrders         RestaurantOrder[]
  restaurantReservations   RestaurantReservation[]
  restaurantTables         RestaurantTable[]
  retailProducts           RetailProduct[]
  retailTransactions       RetailTransaction[]
  smsDeliveryReports       SMSDeliveryReport[]
  smsOptOuts               SMSOptOut[]
  smsTemplates             SMSTemplate[]
  salaryStructures         SalaryStructure[]
  salesReps                SalesRep[]
  scheduledEmails          ScheduledEmail[]
  scheduledPosts           ScheduledPost[]
  scheduledReportRuns      ScheduledReportRun[]
  segments                 Segment[]
  socialMediaAccounts      SocialMediaAccount[]
  socialPosts              SocialPost[]
  subscription             Subscription?
  suppliers                Supplier[]
  tdsConfigs               TDSConfig?
  tasks                    Task[]
  taxDeclarationCategories TaxDeclarationCategory[]
  tenantMembers            TenantMember[]
  paymentSettings          TenantPaymentSettings?
  users                    User[]                    @relation("PrimaryTenant")
  vendors                  Vendor[]
  vendorRatings            VendorRating[]
  websites                 Website[]
  websiteChatbots          WebsiteChatbot[]
  websiteEvents            WebsiteEvent[]
  websiteHeatmaps          WebsiteHeatmap[]
  websiteSessions          WebsiteSession[]
  websiteVisits            WebsiteVisit[]
  whatsappAccounts         WhatsappAccount[]
  // Productivity Suite Relations
  spreadsheets             Spreadsheet[]
  documents                Document[]
  driveFiles               DriveFile[]
  presentations            Presentation[]
  meetings                 Meeting[]

  @@index([subdomain])
  @@index([status])
  @@index([industry])
  @@index([subscriptionTier])
}

model TenantPaymentSettings {
  id                  String   @id @default(cuid())
  tenantId            String   @unique
  payaidApiKey        String?
  payaidSalt          String?
  payaidBaseUrl       String?
  payaidEncryptionKey String?
  payaidDecryptionKey String?
  payaidWebhookSecret String?
  isConfigured        Boolean  @default(false)
  isActive            Boolean  @default(false)
  testMode            Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model Subscription {
  id                String    @id @default(cuid())
  tenantId          String    @unique
  modules           String[]
  tier              String
  monthlyPrice      Decimal   @default(0)
  billingCycleStart DateTime
  billingCycleEnd   DateTime
  status            String    @default("active")
  trialEndsAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([status])
}

model ModuleDefinition {
  id                String   @id @default(cuid())
  moduleId          String   @unique
  displayName       String
  description       String
  icon              String?
  starterPrice      Decimal
  professionalPrice Decimal
  enterprisePrice   Decimal?
  features          String[]
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([moduleId])
  @@index([isActive])
}

model CRMConfig {
  id                 String   @id @default(cuid())
  tenantId           String   @unique
  leadScoringEnabled Boolean  @default(true)
  automationsEnabled Boolean  @default(true)
  maxContacts        Int      @default(1000)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model InvoicingConfig {
  id                  String   @id @default(cuid())
  tenantId            String   @unique
  maxInvoicesPerMonth Int      @default(200)
  recurringEnabled    Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model AuditLog {
  id             String   @id @default(cuid())
  entityType     String
  entityId       String
  changedBy      String
  changeSummary  String
  beforeSnapshot Json?
  afterSnapshot  Json?
  tenantId       String
  timestamp      DateTime @default(now())
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, entityType])
  @@index([tenantId, entityId])
  @@index([tenantId, timestamp])
  @@index([changedBy])
}

model User {
  id                       String                    @id @default(cuid())
  email                    String                    @unique
  name                     String?
  password                 String?
  role                     String                    @default("member")
  avatar                   String?
  emailVerified            DateTime?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  lastLoginAt              DateTime?
  tenantId                 String
  aiCofounderConversations AICofounderConversation[] @relation("AICofounderConversations")
  chatMembers              ChatMember[]              @relation("ChatMembers")
  emailAccounts            EmailAccount[]            @relation("EmailAccounts")
  receivedGRs              GoodsReceipt[]            @relation("GRReceivedBy")
  uploadedMedia            MediaLibrary[]            @relation("MediaUploads")
  ownedProjects            Project[]                 @relation("ProjectOwner")
  projectMemberships       ProjectMember[]           @relation("ProjectMembers")
  assignedProjectTasks     ProjectTask[]             @relation("AssignedProjectTasks")
  approvedPOs              PurchaseOrder[]           @relation("POApprovedBy")
  requestedPOs             PurchaseOrder[]           @relation("PORequestedBy")
  createdReports           Report[]                  @relation("ReportCreator")
  salesRep                 SalesRep?                 @relation("SalesRepUser")
  assignedTasks            Task[]                    @relation("AssignedTasks")
  tenantMemberships        TenantMember[]
  timeEntries              TimeEntry[]               @relation("TimeEntries")
  tenant                   Tenant                    @relation("PrimaryTenant", fields: [tenantId], references: [id], onDelete: Cascade)
  vendorRatings            VendorRating[]            @relation("VendorRatings")
  whatsappMessages         WhatsappMessage[]
  whatsappSessions         WhatsappSession[]
  // Productivity Suite Relations
  spreadsheetCreated       Spreadsheet[]              @relation("SpreadsheetCreatedBy")
  spreadsheetUpdated       Spreadsheet[]              @relation("SpreadsheetUpdatedBy")
  spreadsheetCollaborations SpreadsheetCollaborator[] @relation("SpreadsheetCollaborations")
  spreadsheetVersionCreated SpreadsheetVersion[]       @relation("SpreadsheetVersionCreatedBy")
  documentCreated          Document[]                 @relation("DocumentCreatedBy")
  documentUpdated          Document[]                 @relation("DocumentUpdatedBy")
  documentCollaborations   DocumentCollaborator[]     @relation("DocumentCollaborations")
  documentVersionCreated   DocumentVersion[]          @relation("DocumentVersionCreatedBy")
  driveFileCreated         DriveFile[]                @relation("DriveFileCreatedBy")
  driveFileUpdated         DriveFile[]                @relation("DriveFileUpdatedBy")
  driveFileVersionCreated  DriveFileVersion[]         @relation("DriveFileVersionCreatedBy")
  presentationCreated      Presentation[]             @relation("PresentationCreatedBy")
  presentationUpdated      Presentation[]             @relation("PresentationUpdatedBy")
  presentationCollaborations PresentationCollaborator[] @relation("PresentationCollaborations")
  presentationVersionCreated PresentationVersion[]    @relation("PresentationVersionCreatedBy")
  meetingHost               Meeting[]                 @relation("MeetingHost")
  meetingCreated            Meeting[]                 @relation("MeetingCreatedBy")
  createdWhatsappTemplates WhatsappTemplate[]

  @@index([email])
  @@index([tenantId])
}

model TenantMember {
  id        String   @id @default(cuid())
  userId    String
  tenantId  String
  role      String   @default("member")
  createdAt DateTime @default(now())
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, tenantId])
  @@index([tenantId])
}

model SalesRep {
  id             String        @id @default(cuid())
  userId         String        @unique
  tenantId       String
  specialization String?
  conversionRate Float         @default(0)
  isOnLeave      Boolean       @default(false)
  leaveEndDate   DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  alerts         Alert[]
  assignedLeads  Contact[]
  deals          Deal[]
  interactions   Interaction[] @relation("RepInteractions")
  tenant         Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user           User          @relation("SalesRepUser", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, isOnLeave])
}

model Contact {
  id                    String                    @id @default(cuid())
  name                  String
  email                 String?
  phone                 String?
  company               String?
  type                  String                    @default("lead")
  status                String                    @default("active")
  source                String?
  sourceId              String?
  sourceData            Json?
  attributionChannel    String?
  address               String?
  city                  String?
  state                 String?
  postalCode            String?
  country               String?                   @default("India")
  gstin                 String?
  likelyToBuy           Boolean?                  @default(false)
  churnRisk             Boolean?                  @default(false)
  leadScore             Float                     @default(0)
  scoreUpdatedAt        DateTime                  @default(now())
  scoreComponents       Json?
  tags                  String[]
  notes                 String?
  createdAt             DateTime                  @default(now())
  lastContactedAt       DateTime?
  nextFollowUp          DateTime?
  tenantId              String
  assignedToId          String?
  assignedTo            SalesRep?                 @relation(fields: [assignedToId], references: [id])
  leadSource            LeadSource?               @relation(fields: [sourceId], references: [id])
  tenant                Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  deals                 Deal[]
  emailContacts         EmailContact[]            @relation("EmailContacts")
  emailMessages         EmailMessage[]            @relation("EmailMessages")
  interactions          Interaction[]
  invoices              Invoice[]                 @relation("CustomerInvoices")
  loyaltyPoints         LoyaltyPoints[]
  nurtureEnrollments    NurtureEnrollment[]
  orders                Order[]                   @relation("CustomerOrders")
  clientProjects        Project[]                 @relation("ProjectClient")
  realEstateAdvances    RealEstateAdvance[]
  smsDeliveryReports    SMSDeliveryReport[]
  scheduledEmails       ScheduledEmail[]
  tasks                 Task[]
  whatsappIdentities    WhatsappContactIdentity[]
  whatsappConversations WhatsappConversation[]

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
  @@index([tenantId, leadScore])
}

model Interaction {
  id             String    @id @default(cuid())
  type           String
  subject        String?
  notes          String?
  duration       Int?
  outcome        String?
  createdByRepId String?
  createdAt      DateTime  @default(now())
  contactId      String
  contact        Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)
  createdByRep   SalesRep? @relation("RepInteractions", fields: [createdByRepId], references: [id])

  @@index([contactId])
  @@index([createdAt])
  @@index([createdByRepId])
}

model AIUsage {
  id          String   @id @default(cuid())
  tenantId    String
  service     String
  tokens      Int?
  duration    Int?
  requestType String?
  modelUsed   String?
  createdAt   DateTime @default(now())
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, service])
  @@index([tenantId, createdAt])
  @@index([service])
}

model AICofounderConversation {
  id               String   @id @default(cuid())
  tenantId         String
  userId           String
  title            String?
  agentId          String
  messages         Json
  messageCount     Int      @default(0)
  lastMessageAt    DateTime @default(now())
  suggestedActions Json?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user             User     @relation("AICofounderConversations", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, userId])
  @@index([lastMessageAt])
}

model Deal {
  id                String    @id @default(cuid())
  name              String
  value             Float
  probability       Float     @default(50)
  stage             String    @default("lead")
  expectedCloseDate DateTime?
  actualCloseDate   DateTime?
  lostReason        String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  tenantId          String
  contactId         String
  assignedToId      String?
  assignedTo        SalesRep? @relation(fields: [assignedToId], references: [id])
  contact           Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, stage])
  @@index([contactId])
}

model Task {
  id           String    @id @default(cuid())
  title        String
  description  String?
  priority     String    @default("medium")
  status       String    @default("pending")
  dueDate      DateTime?
  completedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenantId     String
  contactId    String?
  assignedToId String?
  assignedTo   User?     @relation("AssignedTasks", fields: [assignedToId], references: [id])
  contact      Contact?  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([assignedToId])
}

model Product {
  id                 String              @id @default(cuid())
  name               String
  description        String?
  sku                String
  barcode            String?
  costPrice          Float
  salePrice          Float
  discountPrice      Float?
  quantity           Int                 @default(0)
  reorderLevel       Int                 @default(10)
  images             String[]
  categories         String[]
  hsnCode            String?
  sacCode            String?
  gstRate            Float?
  itemType           String?
  totalSold          Int                 @default(0)
  totalRevenue       Float               @default(0)
  lastSoldAt         DateTime?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  tenantId           String
  orderItems         OrderItem[]
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  purchaseOrderItems PurchaseOrderItem[] @relation("PurchaseOrderItems")

  @@index([tenantId])
  @@index([tenantId, sku])
  @@index([tenantId, categories])
}

model Order {
  id                String      @id @default(cuid())
  orderNumber       String      @unique
  status            String      @default("pending")
  subtotal          Float
  tax               Float
  shipping          Float
  total             Float
  discountCode      String?
  discountAmount    Float?
  shippingAddress   String
  shippingCity      String
  shippingPostal    String
  shippingCountry   String      @default("India")
  shiprocketOrderId String?
  trackingUrl       String?
  createdAt         DateTime    @default(now())
  paidAt            DateTime?
  shippedAt         DateTime?
  deliveredAt       DateTime?
  tenantId          String
  customerId        String?
  customer          Contact?    @relation("CustomerOrders", fields: [customerId], references: [id])
  tenant            Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items             OrderItem[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([orderNumber])
}

model OrderItem {
  id          String   @id @default(cuid())
  productName String
  quantity    Int
  price       Float
  total       Float
  orderId     String
  productId   String?
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product? @relation(fields: [productId], references: [id])

  @@index([orderId])
}

model Invoice {
  id                     String            @id @default(cuid())
  invoiceNumber          String            @unique
  status                 String            @default("draft")
  subtotal               Float
  tax                    Float
  total                  Float
  gstRate                Float?
  gstAmount              Float?
  cgst                   Float?
  sgst                   Float?
  igst                   Float?
  isInterState           Boolean           @default(false)
  placeOfSupply          String?
  hsnCode                String?
  reverseCharge          Boolean           @default(false)
  supplierGSTIN          String?
  orderNumber            String?
  terms                  String?
  accountsReceivable     String?
  salespersonId          String?
  template               String?
  discount               Float             @default(0)
  discountType           String            @default("amount")
  tdsType                String?
  tdsTax                 String?
  tdsAmount              Float?
  adjustment             Float             @default(0)
  notes                  String?
  termsAndConditions     String?
  items                  Json?
  customerName           String?
  customerEmail          String?
  customerPhone          String?
  customerAddress        String?
  customerCity           String?
  customerState          String?
  customerPostalCode     String?
  customerGSTIN          String?
  paymentLinkUrl         String?
  paymentLinkUuid        String?
  paymentLinkExpiry      DateTime?
  paymentTransactionId   String?
  paymentStatus          String?
  paymentMode            String?
  paymentChannel         String?
  paymentDatetime        DateTime?
  paymentLinkOpenedAt    DateTime?
  paymentLinkOpenedCount Int               @default(0)
  invoiceDate            DateTime          @default(now())
  dueDate                DateTime?
  paidAt                 DateTime?
  tenantId               String
  customerId             String?
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  customer               Contact?          @relation("CustomerInvoices", fields: [customerId], references: [id])
  tenant                 Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  restaurantOrders       RestaurantOrder[] @relation("RestaurantOrderInvoices")

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([invoiceNumber])
  @@index([paymentTransactionId])
  @@index([paymentLinkUuid])
}

model Department {
  id              String           @id @default(cuid())
  name            String
  code            String?
  tenantId        String
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  tenant          Tenant           @relation("TenantDepartments", fields: [tenantId], references: [id], onDelete: Cascade)
  employees       Employee[]
  jobRequisitions JobRequisition[]

  @@unique([tenantId, name])
  @@index([tenantId])
}

model Designation {
  id        String     @id @default(cuid())
  name      String
  code      String?
  tenantId  String
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  tenant    Tenant     @relation("TenantDesignations", fields: [tenantId], references: [id], onDelete: Cascade)
  employees Employee[]

  @@unique([tenantId, name])
  @@index([tenantId])
}

model Location {
  id               String            @id @default(cuid())
  name             String
  code             String?
  city             String?
  state            String?
  country          String            @default("India")
  tenantId         String
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  assets           Asset[]
  employees        Employee[]
  holidayCalendars HolidayCalendar[]
  jobRequisitions  JobRequisition[]
  tenant           Tenant            @relation("TenantLocations", fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId])
}

model Employee {
  id                   String                    @id @default(cuid())
  employeeCode         String
  firstName            String
  lastName             String
  officialEmail        String
  personalEmail        String?
  mobileCountryCode    String                    @default("+91")
  mobileNumber         String
  joiningDate          DateTime
  probationEndDate     DateTime?
  confirmationDate     DateTime?
  exitDate             DateTime?
  exitReason           String?
  status               String                    @default("ACTIVE")
  departmentId         String?
  designationId        String?
  managerId            String?
  locationId           String?
  ctcAnnualInr         Decimal?                  @db.Decimal(12, 2)
  fixedComponentInr    Decimal?                  @db.Decimal(12, 2)
  variableComponentInr Decimal?                  @db.Decimal(12, 2)
  bankAccountNumber    String?
  ifscCode             String?
  bankName             String?
  accountType          String?
  panNumber            String?
  aadhaarNumber        String?
  uanNumber            String?
  esiNumber            String?
  pfApplicable         Boolean                   @default(false)
  esiApplicable        Boolean                   @default(false)
  ptApplicable         Boolean                   @default(true)
  tdsApplicable        Boolean                   @default(true)
  createdBy            String?
  updatedBy            String?
  tenantId             String
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  assetAssignments     AssetAssignment[]
  attendanceRecords    AttendanceRecord[]
  department           Department?               @relation(fields: [departmentId], references: [id])
  designation          Designation?              @relation(fields: [designationId], references: [id])
  location             Location?                 @relation(fields: [locationId], references: [id])
  manager              Employee?                 @relation("EmployeeManager", fields: [managerId], references: [id])
  reports              Employee[]                @relation("EmployeeManager")
  tenant               Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  employeeDocuments    EmployeeDocument[]
  salaryStructures     EmployeeSalaryStructure[]
  taxDeclarations      EmployeeTaxDeclaration[]
  exitInstances        ExitInstance[]
  expenses             Expense[]                 @relation("EmployeeExpenses")
  leaveBalances        LeaveBalance[]
  leaveRequests        LeaveRequest[]
  offers               Offer[]
  onboardingInstances  OnboardingInstance[]
  payrollRuns          PayrollRun[]

  @@unique([tenantId, employeeCode])
  @@unique([tenantId, officialEmail])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, departmentId])
  @@index([tenantId, designationId])
  @@index([managerId])
}

model OAuthIntegration {
  id             String    @id @default(cuid())
  tenantId       String
  provider       String
  accessToken    String
  refreshToken   String?
  expiresAt      DateTime?
  tokenType      String?   @default("Bearer")
  scope          String?
  providerUserId String?
  providerEmail  String?
  providerName   String?
  isActive       Boolean   @default(true)
  lastUsedAt     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, provider])
  @@index([tenantId])
  @@index([provider])
}

model Expense {
  id                 String            @id @default(cuid())
  tenantId           String
  description        String
  amount             Decimal           @db.Decimal(10, 2)
  category           String
  vendor             String?
  date               DateTime          @default(now())
  receiptUrl         String?
  gstAmount          Decimal?          @db.Decimal(10, 2)
  hsnCode            String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  approvedAt         DateTime?
  approverId         String?
  employeeId         String?
  isRecurring        Boolean           @default(false)
  nextRecurrenceDate DateTime?
  recurringFrequency String?
  reimbursedAt       DateTime?
  rejectedAt         DateTime?
  rejectionReason    String?
  status             String            @default("pending")
  employee           Employee?         @relation("EmployeeExpenses", fields: [employeeId], references: [id])
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  approvals          ExpenseApproval[]

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, date])
  @@index([tenantId, status])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model ExpenseApproval {
  id           String   @id @default(cuid())
  expenseId    String
  approverId   String
  approverName String?
  status       String
  comments     String?
  tenantId     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  expense      Expense  @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([expenseId])
  @@index([approverId])
}

model BudgetLine {
  id           String   @id @default(cuid())
  tenantId     String
  category     String
  period       String
  periodType   String
  budgetAmount Decimal  @db.Decimal(12, 2)
  actualAmount Decimal  @default(0) @db.Decimal(12, 2)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, category, period])
  @@index([tenantId])
  @@index([tenantId, period])
}

model Segment {
  id             String   @id @default(cuid())
  name           String
  description    String?
  criteria       String
  criteriaConfig String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, createdAt])
}

model Campaign {
  id                 String              @id @default(cuid())
  name               String
  type               String
  subject            String?
  content            String
  status             String              @default("draft")
  segmentId          String?
  contactIds         String[]
  scheduledFor       DateTime?
  sentAt             DateTime?
  recipientCount     Int                 @default(0)
  sent               Int                 @default(0)
  delivered          Int                 @default(0)
  opened             Int                 @default(0)
  clicked            Int                 @default(0)
  bounced            Int                 @default(0)
  unsubscribed       Int                 @default(0)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  tenantId           String
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  emailBounces       EmailBounce[]
  leadSources        LeadSource[]
  smsDeliveryReports SMSDeliveryReport[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, type])
  @@index([tenantId, createdAt])
}

model NurtureTemplate {
  id          String              @id @default(cuid())
  name        String
  description String?
  tenantId    String
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  enrollments NurtureEnrollment[]
  steps       NurtureStep[]
  tenant      Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, createdAt])
}

model NurtureStep {
  id         String          @id @default(cuid())
  templateId String
  dayNumber  Int
  channel    String          @default("email")
  subject    String?
  body       String
  order      Int
  createdAt  DateTime        @default(now())
  template   NurtureTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@index([templateId, order])
}

model ScheduledEmail {
  id          String    @id @default(cuid())
  contactId   String
  templateId  String?
  channel     String    @default("email")
  subject     String?
  body        String
  scheduledAt DateTime
  sentAt      DateTime?
  status      String    @default("PENDING")
  retryCount  Int       @default(0)
  tenantId    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  contact     Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, scheduledAt])
  @@index([contactId])
  @@index([status, scheduledAt])
  @@index([channel, status])
}

model NurtureEnrollment {
  id             String          @id @default(cuid())
  contactId      String
  templateId     String
  enrolledAt     DateTime        @default(now())
  status         String          @default("ACTIVE")
  completedSteps Int             @default(0)
  totalSteps     Int
  tenantId       String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  contact        Contact         @relation(fields: [contactId], references: [id], onDelete: Cascade)
  template       NurtureTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([contactId])
  @@index([templateId])
  @@index([status, enrolledAt])
}

model LeadSource {
  id               String    @id @default(cuid())
  name             String
  type             String
  tenantId         String
  leadsCount       Int       @default(0)
  conversionsCount Int       @default(0)
  totalValue       Float     @default(0)
  avgDealValue     Float     @default(0)
  conversionRate   Float     @default(0)
  roi              Float     @default(0)
  campaignId       String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  contacts         Contact[]
  campaign         Campaign? @relation(fields: [campaignId], references: [id])
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, createdAt])
}

model Alert {
  id        String    @id @default(cuid())
  repId     String
  type      String
  title     String
  message   String
  leadId    String?
  dealId    String?
  taskId    String?
  channels  String[]
  priority  String    @default("MEDIUM")
  isRead    Boolean   @default(false)
  readAt    DateTime?
  tenantId  String
  createdAt DateTime  @default(now())
  rep       SalesRep  @relation(fields: [repId], references: [id], onDelete: Cascade)
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, repId])
  @@index([tenantId, isRead])
  @@index([tenantId, createdAt])
  @@index([repId, isRead])
}

model AttendanceRecord {
  id                String    @id @default(cuid())
  employeeId        String
  date              DateTime  @db.Date
  checkInTime       DateTime?
  checkOutTime      DateTime?
  workHours         Decimal?  @db.Decimal(5, 2)
  status            String    @default("PRESENT")
  source            String    @default("WEB")
  checkInLatitude   Decimal?  @db.Decimal(10, 8)
  checkInLongitude  Decimal?  @db.Decimal(11, 8)
  checkOutLatitude  Decimal?  @db.Decimal(10, 8)
  checkOutLongitude Decimal?  @db.Decimal(11, 8)
  remarks           String?
  tenantId          String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  employee          Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, employeeId, date])
  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([tenantId, date])
  @@index([employeeId, date])
}

model LeaveType {
  id            String         @id @default(cuid())
  name          String
  code          String?
  tenantId      String
  isActive      Boolean        @default(true)
  isPaid        Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  leaveBalances LeaveBalance[]
  leavePolicies LeavePolicy[]  @relation("LeaveTypePolicies")
  leaveRequests LeaveRequest[]
  tenant        Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId])
}

model LeavePolicy {
  id                  String    @id @default(cuid())
  leaveTypeId         String
  tenantId            String
  accrualType         String    @default("MONTHLY")
  accrualAmount       Decimal   @db.Decimal(5, 2)
  maxBalance          Decimal?  @db.Decimal(5, 2)
  carryForwardLimit   Decimal?  @db.Decimal(5, 2)
  carryForwardEnabled Boolean   @default(true)
  minDaysNotice       Int?
  maxConsecutiveDays  Int?
  requiresApproval    Boolean   @default(true)
  requiresDocument    Boolean   @default(false)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  leaveType           LeaveType @relation("LeaveTypePolicies", fields: [leaveTypeId], references: [id], onDelete: Cascade)
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([leaveTypeId])
}

model LeaveBalance {
  id          String    @id @default(cuid())
  employeeId  String
  leaveTypeId String
  balance     Decimal   @db.Decimal(5, 2)
  asOfDate    DateTime  @default(now())
  tenantId    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  employee    Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, employeeId, leaveTypeId, asOfDate])
  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model LeaveRequest {
  id                    String    @id @default(cuid())
  employeeId            String
  leaveTypeId           String
  startDate             DateTime  @db.Date
  endDate               DateTime  @db.Date
  days                  Decimal   @db.Decimal(5, 2)
  isHalfDay             Boolean   @default(false)
  halfDayType           String?
  reason                String?
  supportingDocumentUrl String?
  status                String    @default("PENDING")
  approverId            String?
  approvedAt            DateTime?
  rejectedAt            DateTime?
  rejectionReason       String?
  tenantId              String
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  employee              Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  leaveType             LeaveType @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([tenantId, status])
  @@index([employeeId])
  @@index([approverId])
}

model HolidayCalendar {
  id         String    @id @default(cuid())
  name       String
  date       DateTime  @db.Date
  isOptional Boolean   @default(false)
  locationId String?
  tenantId   String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  location   Location? @relation(fields: [locationId], references: [id])
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, locationId, date])
  @@index([tenantId])
  @@index([tenantId, date])
}

model SalaryStructure {
  id                       String                    @id @default(cuid())
  name                     String
  description              String?
  tenantId                 String
  isDefault                Boolean                   @default(false)
  structureJson            Json
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  employeeSalaryStructures EmployeeSalaryStructure[]
  tenant                   Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, isDefault])
}

model EmployeeSalaryStructure {
  id            String          @id @default(cuid())
  employeeId    String
  structureId   String
  effectiveFrom DateTime
  effectiveTo   DateTime?
  tenantId      String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  employee      Employee        @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  structure     SalaryStructure @relation(fields: [structureId], references: [id], onDelete: Cascade)
  tenant        Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
  @@index([structureId])
}

model PayrollCycle {
  id          String       @id @default(cuid())
  month       Int
  year        Int
  tenantId    String
  status      String       @default("DRAFT")
  runType     String       @default("REGULAR")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payrollRuns PayrollRun[]

  @@unique([tenantId, month, year, runType])
  @@index([tenantId])
  @@index([tenantId, status])
}

model PayrollRun {
  id                 String              @id @default(cuid())
  cycleId            String
  employeeId         String
  grossEarningsInr   Decimal             @db.Decimal(12, 2)
  grossDeductionsInr Decimal             @db.Decimal(12, 2)
  tdsInr             Decimal             @db.Decimal(12, 2)
  pfEmployeeInr      Decimal             @db.Decimal(12, 2)
  pfEmployerInr      Decimal             @db.Decimal(12, 2)
  esiEmployeeInr     Decimal             @db.Decimal(12, 2)
  esiEmployerInr     Decimal             @db.Decimal(12, 2)
  ptInr              Decimal             @db.Decimal(12, 2)
  lopDays            Decimal             @db.Decimal(5, 2)
  lopAmountInr       Decimal             @db.Decimal(12, 2)
  netPayInr          Decimal             @db.Decimal(12, 2)
  daysPaid           Int
  payoutStatus       String              @default("PENDING")
  payaidPayoutId     String?
  payslipUrl         String?
  generatedAt        DateTime?
  approvedAt         DateTime?
  paidAt             DateTime?
  tenantId           String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  adjustments        PayrollAdjustment[]
  cycle              PayrollCycle        @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  employee           Employee            @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, cycleId, employeeId])
  @@index([tenantId])
  @@index([tenantId, cycleId])
  @@index([tenantId, employeeId])
  @@index([tenantId, payoutStatus])
}

model PayrollAdjustment {
  id             String     @id @default(cuid())
  payrollRunId   String
  componentName  String
  originalAmount Decimal    @db.Decimal(12, 2)
  adjustedAmount Decimal    @db.Decimal(12, 2)
  reason         String
  adjustedBy     String
  createdAt      DateTime   @default(now())
  payrollRun     PayrollRun @relation(fields: [payrollRunId], references: [id], onDelete: Cascade)

  @@index([payrollRunId])
}

model PFConfig {
  id              String   @id @default(cuid())
  tenantId        String   @unique
  wageCeiling     Decimal  @default(15000) @db.Decimal(10, 2)
  employeePercent Decimal  @default(12) @db.Decimal(5, 2)
  employerPercent Decimal  @default(12) @db.Decimal(5, 2)
  epsPercent      Decimal  @default(3.67) @db.Decimal(5, 2)
  pfPercent       Decimal  @default(8.33) @db.Decimal(5, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model ESIConfig {
  id              String   @id @default(cuid())
  tenantId        String   @unique
  wageCeiling     Decimal  @default(21000) @db.Decimal(10, 2)
  employeePercent Decimal  @default(0.75) @db.Decimal(5, 2)
  employerPercent Decimal  @default(3.25) @db.Decimal(5, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model PTConfig {
  id        String   @id @default(cuid())
  tenantId  String
  state     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ptSlabs   PTSlab[]

  @@unique([tenantId, state])
  @@index([tenantId])
}

model PTSlab {
  id          String   @id @default(cuid())
  configId    String
  salaryFrom  Decimal  @db.Decimal(12, 2)
  salaryTo    Decimal? @db.Decimal(12, 2)
  ptAmountInr Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  config      PTConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@index([configId])
}

model TDSConfig {
  id                String   @id @default(cuid())
  tenantId          String   @unique
  taxSlabsJson      Json
  standardDeduction Decimal  @default(50000) @db.Decimal(10, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model TaxDeclarationCategory {
  id             String                   @id @default(cuid())
  name           String
  code           String
  description    String?
  maxAmountInr   Decimal?                 @db.Decimal(12, 2)
  tenantId       String
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  declarations   EmployeeTaxDeclaration[]
  tenant         Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  proofDocuments TaxProofDocument[]

  @@unique([tenantId, code])
  @@index([tenantId])
}

model EmployeeTaxDeclaration {
  id                String                 @id @default(cuid())
  employeeId        String
  categoryId        String
  financialYear     String
  declaredAmountInr Decimal                @db.Decimal(12, 2)
  approvedAmountInr Decimal?               @db.Decimal(12, 2)
  status            String                 @default("PENDING")
  verifiedBy        String?
  verifiedAt        DateTime?
  rejectionReason   String?
  tenantId          String
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  category          TaxDeclarationCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  employee          Employee               @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant            Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  proofDocuments    TaxProofDocument[]

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
  @@index([categoryId])
}

model TaxProofDocument {
  id                 String                  @id @default(cuid())
  declarationId      String
  categoryId         String?
  fileUrl            String
  fileName           String
  fileType           String
  uploadedAt         DateTime                @default(now())
  verifiedBy         String?
  verificationStatus String                  @default("PENDING")
  createdAt          DateTime                @default(now())
  category           TaxDeclarationCategory? @relation(fields: [categoryId], references: [id])
  declaration        EmployeeTaxDeclaration  @relation(fields: [declarationId], references: [id], onDelete: Cascade)

  @@index([declarationId])
  @@index([categoryId])
}

model JobRequisition {
  id                String         @id @default(cuid())
  title             String
  departmentId      String?
  locationId        String?
  employmentType    String         @default("FULL_TIME")
  requestedBy       String
  approvedBy        String?
  budgetedCtcMinInr Decimal?       @db.Decimal(12, 2)
  budgetedCtcMaxInr Decimal?       @db.Decimal(12, 2)
  status            String         @default("DRAFT")
  tenantId          String
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  candidateJobs     CandidateJob[]
  jobPostings       JobPosting[]
  department        Department?    @relation(fields: [departmentId], references: [id])
  location          Location?      @relation(fields: [locationId], references: [id])
  tenant            Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  offers            Offer[]

  @@index([tenantId])
  @@index([tenantId, status])
}

model JobPosting {
  id            String         @id @default(cuid())
  requisitionId String
  postedOn      String?
  status        String         @default("DRAFT")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  requisition   JobRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)

  @@index([requisitionId])
}

model Candidate {
  id               String           @id @default(cuid())
  fullName         String
  email            String
  phone            String
  source           String           @default("OTHERS")
  currentCompany   String?
  currentCtcInr    Decimal?         @db.Decimal(12, 2)
  expectedCtcInr   Decimal?         @db.Decimal(12, 2)
  noticePeriodDays Int?
  location         String?
  skills           String[]
  resumeFileUrl    String?
  status           String           @default("NEW")
  tenantId         String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  candidateJobs    CandidateJob[]
  interviewRounds  InterviewRound[]
  offers           Offer[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, source])
}

model CandidateJob {
  id            String         @id @default(cuid())
  candidateId   String
  requisitionId String
  stage         String         @default("APPLIED")
  createdAt     DateTime       @default(now())
  candidate     Candidate      @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  requisition   JobRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)

  @@unique([candidateId, requisitionId])
  @@index([candidateId])
  @@index([requisitionId])
}

model InterviewRound {
  id            String    @id @default(cuid())
  candidateId   String
  roundName     String
  scheduledAt   DateTime
  mode          String    @default("VIDEO")
  interviewerId String?
  feedback      String?
  rating        Int?
  status        String    @default("SCHEDULED")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  candidate     Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([interviewerId])
}

model Offer {
  id             String         @id @default(cuid())
  candidateId    String
  requisitionId  String
  employeeId     String?
  offeredCtcInr  Decimal        @db.Decimal(12, 2)
  acceptedCtcInr Decimal?       @db.Decimal(12, 2)
  joiningDate    DateTime?
  offerStatus    String         @default("DRAFT")
  offerLetterUrl String?
  tenantId       String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  candidate      Candidate      @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  employee       Employee?      @relation(fields: [employeeId], references: [id])
  requisition    JobRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
  tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([requisitionId])
  @@index([tenantId])
}

model OnboardingTemplate {
  id          String               @id @default(cuid())
  name        String
  description String?
  tenantId    String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  instances   OnboardingInstance[]
  tasks       OnboardingTask[]
  tenant      Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model OnboardingTask {
  id              String                   @id @default(cuid())
  templateId      String
  title           String
  description     String?
  assignedToRole  String
  dueDaysRelative Int
  order           Int
  createdAt       DateTime                 @default(now())
  instanceTasks   OnboardingInstanceTask[]
  template        OnboardingTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@index([templateId, order])
}

model OnboardingInstance {
  id          String                   @id @default(cuid())
  employeeId  String
  templateId  String
  status      String                   @default("IN_PROGRESS")
  startDate   DateTime                 @default(now())
  completedAt DateTime?
  tenantId    String
  createdAt   DateTime                 @default(now())
  updatedAt   DateTime                 @updatedAt
  employee    Employee                 @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template    OnboardingTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)
  tenant      Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tasks       OnboardingInstanceTask[]

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model OnboardingInstanceTask {
  id          String             @id @default(cuid())
  instanceId  String
  taskId      String
  assigneeId  String?
  status      String             @default("PENDING")
  completedAt DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  instance    OnboardingInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  task        OnboardingTask     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([instanceId, taskId])
  @@index([instanceId])
  @@index([taskId])
  @@index([assigneeId])
}

model ExitTemplate {
  id          String         @id @default(cuid())
  name        String
  description String?
  tenantId    String
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  instances   ExitInstance[]
  tasks       ExitTask[]
  tenant      Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model ExitTask {
  id              String             @id @default(cuid())
  templateId      String
  title           String
  description     String?
  assignedToRole  String
  dueDaysRelative Int
  order           Int
  createdAt       DateTime           @default(now())
  instanceTasks   ExitInstanceTask[]
  template        ExitTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
}

model ExitInstance {
  id          String             @id @default(cuid())
  employeeId  String
  templateId  String
  status      String             @default("IN_PROGRESS")
  exitDate    DateTime
  startDate   DateTime           @default(now())
  completedAt DateTime?
  tenantId    String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  employee    Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template    ExitTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)
  tenant      Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tasks       ExitInstanceTask[]

  @@index([tenantId])
  @@index([employeeId])
}

model ExitInstanceTask {
  id          String       @id @default(cuid())
  instanceId  String
  taskId      String
  assigneeId  String?
  status      String       @default("PENDING")
  completedAt DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  instance    ExitInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  task        ExitTask     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([instanceId, taskId])
  @@index([instanceId])
}

model Asset {
  id                 String            @id @default(cuid())
  assetTag           String
  assetType          String
  serialNumber       String?
  brand              String?
  model              String?
  purchaseDate       DateTime?
  purchaseCostInr    Decimal?          @db.Decimal(12, 2)
  warrantyExpiryDate DateTime?
  status             String            @default("AVAILABLE")
  locationId         String?
  tenantId           String
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  location           Location?         @relation(fields: [locationId], references: [id])
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignments        AssetAssignment[]

  @@unique([tenantId, assetTag])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, assetType])
}

model AssetAssignment {
  id                String    @id @default(cuid())
  assetId           String
  employeeId        String
  assignedDate      DateTime  @default(now())
  returnedDate      DateTime?
  conditionOnAssign String?
  conditionOnReturn String?
  remarks           String?
  tenantId          String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  asset             Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)
  employee          Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, assetId])
  @@index([tenantId, employeeId])
  @@index([assetId])
  @@index([employeeId])
}

model HRDocumentTemplate {
  id           String             @id @default(cuid())
  name         String
  type         String
  bodyHtml     String
  placeholders Json
  tenantId     String
  isActive     Boolean            @default(true)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  documents    EmployeeDocument[]
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, type])
}

model EmployeeDocument {
  id           String              @id @default(cuid())
  employeeId   String
  templateId   String?
  documentType String
  fileUrl      String
  generatedAt  DateTime            @default(now())
  generatedBy  String
  tenantId     String
  createdAt    DateTime            @default(now())
  employee     Employee            @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template     HRDocumentTemplate? @relation(fields: [templateId], references: [id])
  tenant       Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model Website {
  id              String           @id @default(cuid())
  tenantId        String
  name            String
  domain          String?          @unique
  subdomain       String?          @unique
  status          String           @default("DRAFT")
  metaTitle       String?
  metaDescription String?
  faviconUrl      String?
  trackingCode    String           @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  chatbots        WebsiteChatbot[]
  events          WebsiteEvent[]
  heatmaps        WebsiteHeatmap[]
  pages           WebsitePage[]
  sessions        WebsiteSession[]
  visits          WebsiteVisit[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([domain])
  @@index([subdomain])
  @@index([trackingCode])
}

model WebsitePage {
  id          String           @id @default(cuid())
  websiteId   String
  path        String
  title       String
  contentJson Json
  isPublished Boolean          @default(false)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  events      WebsiteEvent[]
  heatmaps    WebsiteHeatmap[]
  website     Website          @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  visits      WebsiteVisit[]

  @@unique([websiteId, path])
  @@index([websiteId])
  @@index([websiteId, isPublished])
}

model WebsiteVisit {
  id        String          @id @default(cuid())
  websiteId String
  pageId    String?
  sessionId String?
  ipAddress String?
  userAgent String?
  referrer  String?
  country   String?
  city      String?
  device    String?
  browser   String?
  os        String?
  visitedAt DateTime        @default(now())
  duration  Int?
  tenantId  String
  page      WebsitePage?    @relation(fields: [pageId], references: [id])
  session   WebsiteSession? @relation(fields: [sessionId], references: [id])
  tenant    Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website   Website         @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([sessionId])
  @@index([visitedAt])
}

model WebsiteSession {
  id           String         @id @default(cuid())
  websiteId    String
  sessionId    String         @unique
  visitorId    String?
  startedAt    DateTime       @default(now())
  endedAt      DateTime?
  duration     Int?
  pageViews    Int            @default(1)
  isBounce     Boolean        @default(true)
  recordingUrl String?
  tenantId     String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  events       WebsiteEvent[]
  tenant       Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website      Website        @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  visits       WebsiteVisit[]

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([sessionId])
  @@index([startedAt])
}

model WebsiteEvent {
  id              String          @id @default(cuid())
  websiteId       String
  pageId          String?
  sessionId       String?
  eventType       String
  eventName       String
  elementId       String?
  elementText     String?
  elementSelector String?
  metadata        Json?
  occurredAt      DateTime        @default(now())
  tenantId        String
  page            WebsitePage?    @relation(fields: [pageId], references: [id])
  session         WebsiteSession? @relation(fields: [sessionId], references: [id])
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website         Website         @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([sessionId])
  @@index([eventType])
  @@index([occurredAt])
}

model WebsiteHeatmap {
  id          String       @id @default(cuid())
  websiteId   String
  pageId      String?
  heatmapType String
  dataJson    Json
  imageUrl    String?
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime     @default(now())
  tenantId    String
  page        WebsitePage? @relation(fields: [pageId], references: [id])
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website     Website      @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([pageId])
  @@index([heatmapType])
}

model AICall {
  id               String           @id @default(cuid())
  tenantId         String
  phoneNumber      String
  direction        String           @default("INBOUND")
  status           String           @default("RINGING")
  twilioCallSid    String?          @unique
  twilioAccountSid String?
  startedAt        DateTime         @default(now())
  answeredAt       DateTime?
  endedAt          DateTime?
  duration         Int?
  handledByAI      Boolean          @default(true)
  aiIntent         String?
  aiConfidence     Decimal?         @db.Decimal(5, 2)
  contactId        String?
  dealId           String?
  leadId           String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  recordings       CallRecording[]
  transcripts      CallTranscript[]

  @@index([tenantId])
  @@index([tenantId, phoneNumber])
  @@index([tenantId, status])
  @@index([twilioCallSid])
  @@index([startedAt])
}

model CallRecording {
  id           String   @id @default(cuid())
  callId       String
  recordingUrl String
  duration     Int
  format       String   @default("mp3")
  createdAt    DateTime @default(now())
  tenantId     String
  call         AICall   @relation(fields: [callId], references: [id], onDelete: Cascade)
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([callId])
}

model CallTranscript {
  id             String   @id @default(cuid())
  callId         String
  transcript     String
  segments       Json?
  language       String   @default("en")
  sentiment      String?
  sentimentScore Decimal? @db.Decimal(5, 2)
  keyPoints      Json?
  actionItems    Json?
  createdAt      DateTime @default(now())
  tenantId       String
  call           AICall   @relation(fields: [callId], references: [id], onDelete: Cascade)
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([callId])
  @@index([sentiment])
}

model CallFAQ {
  id         String    @id @default(cuid())
  tenantId   String
  question   String
  answer     String
  category   String?
  timesUsed  Int       @default(0)
  lastUsedAt DateTime?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isActive])
}

model Logo {
  id           String          @id @default(cuid())
  tenantId     String
  businessName String
  industry     String?
  style        String?
  colors       Json?
  prompt       String
  modelUsed    String?
  status       String          @default("GENERATING")
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  tenant       Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  variations   LogoVariation[]

  @@index([tenantId])
  @@index([tenantId, status])
}

model LogoVariation {
  id              String   @id @default(cuid())
  logoId          String
  imageUrl        String
  thumbnailUrl    String?
  colors          Json?
  fonts           Json?
  iconStyle       String?
  exportedFormats Json?
  isSelected      Boolean  @default(false)
  createdAt       DateTime @default(now())
  tenantId        String
  logo            Logo     @relation(fields: [logoId], references: [id], onDelete: Cascade)
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([logoId])
  @@index([tenantId, isSelected])
}

model LandingPage {
  id              String   @id @default(cuid())
  tenantId        String
  name            String
  slug            String   @unique
  status          String   @default("DRAFT")
  contentJson     Json
  metaTitle       String?
  metaDescription String?
  variantA        String?
  variantB        String?
  activeVariant   String?
  views           Int      @default(0)
  conversions     Int      @default(0)
  conversionRate  Decimal? @db.Decimal(5, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([slug])
}

model CheckoutPage {
  id                  String   @id @default(cuid())
  tenantId            String
  name                String
  slug                String   @unique
  paymentMethods      Json
  couponsEnabled      Boolean  @default(true)
  showOrderSummary    Boolean  @default(true)
  showShippingOptions Boolean  @default(true)
  contentJson         Json
  status              String   @default("DRAFT")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([slug])
}

model WebsiteChatbot {
  id                String                @id @default(cuid())
  tenantId          String
  name              String
  websiteId         String?
  position          String                @default("bottom-right")
  primaryColor      String                @default("#007bff")
  greetingMessage   String                @default("Hello! How can I help you today?")
  autoGreet         Boolean               @default(true)
  autoGreetDelay    Int                   @default(3000)
  leadQualification Boolean               @default(true)
  aiModel           String                @default("gpt-3.5-turbo")
  temperature       Decimal               @default(0.7) @db.Decimal(3, 2)
  faqEnabled        Boolean               @default(true)
  knowledgeBase     Json?
  isActive          Boolean               @default(true)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  conversations     ChatbotConversation[]
  tenant            Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website           Website?              @relation(fields: [websiteId], references: [id])

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([tenantId, isActive])
}

model ChatbotConversation {
  id           String         @id @default(cuid())
  chatbotId    String
  visitorId    String
  sessionId    String
  contactId    String?
  leadId       String?
  messages     Json
  startedAt    DateTime       @default(now())
  endedAt      DateTime?
  messageCount Int            @default(0)
  qualified    Boolean        @default(false)
  tenantId     String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  chatbot      WebsiteChatbot @relation(fields: [chatbotId], references: [id], onDelete: Cascade)
  tenant       Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([chatbotId])
  @@index([visitorId])
  @@index([contactId])
  @@index([leadId])
}

model KnowledgeDocument {
  id             String                   @id @default(cuid())
  tenantId       String
  title          String
  description    String?
  category       String?
  tags           String[]
  fileUrl        String
  fileName       String
  fileSize       Int
  fileType       String
  mimeType       String
  extractedText  String?
  summary        String?
  isIndexed      Boolean                  @default(false)
  indexedAt      DateTime?
  embeddingModel String?
  uploadedBy     String?
  uploadedAt     DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  tenant         Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  chunks         KnowledgeDocumentChunk[]
  queries        KnowledgeQuery[]

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isIndexed])
}

model KnowledgeDocumentChunk {
  id             String            @id @default(cuid())
  documentId     String
  chunkIndex     Int
  content        String
  startChar      Int?
  endChar        Int?
  embedding      Json?
  embeddingModel String?
  metadata       Json?
  createdAt      DateTime          @default(now())
  document       KnowledgeDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([documentId, chunkIndex])
}

model KnowledgeQuery {
  id         String             @id @default(cuid())
  documentId String?
  tenantId   String
  query      String
  answer     String
  sources    Json
  confidence Float?
  askedBy    String?
  askedAt    DateTime           @default(now())
  modelUsed  String?
  tokensUsed Int?
  document   KnowledgeDocument? @relation(fields: [documentId], references: [id])
  tenant     Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, askedAt])
  @@index([documentId])
}

model Event {
  id                   String              @id @default(cuid())
  tenantId             String
  title                String
  description          String?
  slug                 String              @unique
  startDate            DateTime
  endDate              DateTime
  timezone             String              @default("Asia/Kolkata")
  locationType         String              @default("PHYSICAL")
  address              String?
  city                 String?
  state                String?
  virtualUrl           String?
  registrationEnabled  Boolean             @default(true)
  maxAttendees         Int?
  registrationDeadline DateTime?
  priceInr             Decimal?            @db.Decimal(10, 2)
  streamingEnabled     Boolean             @default(false)
  streamingUrl         String?
  status               String              @default("DRAFT")
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  registrations        EventRegistration[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([slug])
  @@index([startDate])
}

model EventRegistration {
  id            String    @id @default(cuid())
  eventId       String
  name          String
  email         String
  phone         String?
  company       String?
  status        String    @default("REGISTERED")
  registeredAt  DateTime  @default(now())
  confirmedAt   DateTime?
  attendedAt    DateTime?
  paidAmountInr Decimal?  @db.Decimal(10, 2)
  paymentStatus String?
  tenantId      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  event         Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([eventId, email])
  @@index([tenantId])
  @@index([eventId])
  @@index([email])
  @@index([status])
}

model EmailTemplate {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  category    String?
  subject     String
  htmlContent String
  textContent String?
  variables   Json?
  timesUsed   Int       @default(0)
  lastUsedAt  DateTime?
  isActive    Boolean   @default(true)
  isDefault   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isActive])
}

model CustomDashboard {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  description String?
  layoutJson  Json
  widgets     Json
  isDefault   Boolean  @default(false)
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, isDefault])
}

model CustomReport {
  id                String   @id @default(cuid())
  tenantId          String
  name              String
  description       String?
  reportType        String
  filters           Json
  columns           Json
  grouping          Json?
  sorting           Json?
  scheduleEnabled   Boolean  @default(false)
  scheduleFrequency String?
  scheduleDay       Int?
  scheduleTime      String?
  recipients        Json?
  exportFormats     Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, reportType])
}

model FeatureToggle {
  id          String   @id @default(cuid())
  tenantId    String
  featureName String
  isEnabled   Boolean  @default(false)
  settings    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, featureName])
  @@index([tenantId])
  @@index([tenantId, isEnabled])
  @@index([featureName])
}

model CustomField {
  id           String   @id @default(cuid())
  tenantId     String
  name         String
  fieldType    String
  isRequired   Boolean  @default(false)
  model        String
  options      Json?
  defaultValue String?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, model, name])
  @@index([tenantId])
  @@index([tenantId, model])
}

model RestaurantOrder {
  id            String                @id @default(cuid())
  tenantId      String
  orderNumber   String
  tableNumber   Int?
  customerName  String?
  customerPhone String?
  status        String                @default("PENDING")
  totalAmount   Decimal               @db.Decimal(10, 2)
  paymentStatus String                @default("PENDING")
  notes         String?
  estimatedTime Int?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  servedAt      DateTime?
  invoiceId     String?
  tableId       String?
  invoice       Invoice?              @relation("RestaurantOrderInvoices", fields: [invoiceId], references: [id])
  table         RestaurantTable?      @relation("TableOrders", fields: [tableId], references: [id])
  tenant        Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items         RestaurantOrderItem[]

  @@unique([tenantId, orderNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
  @@index([status, createdAt])
  @@index([invoiceId])
}

model RestaurantOrderItem {
  id                  String             @id @default(cuid())
  orderId             String
  menuItemId          String
  quantity            Int
  price               Decimal            @db.Decimal(10, 2)
  subtotal            Decimal            @db.Decimal(10, 2)
  specialInstructions String?
  createdAt           DateTime           @default(now())
  menuItem            RestaurantMenuItem @relation(fields: [menuItemId], references: [id])
  order               RestaurantOrder    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([menuItemId])
}

model RestaurantMenuItem {
  id              String                @id @default(cuid())
  tenantId        String
  name            String
  description     String?
  category        String
  price           Decimal               @db.Decimal(10, 2)
  imageUrl        String?
  isAvailable     Boolean               @default(true)
  isVegetarian    Boolean               @default(false)
  isVegan         Boolean               @default(false)
  isSpicy         Boolean               @default(false)
  preparationTime Int?
  calories        Int?
  displayOrder    Int                   @default(0)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  tenant          Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  orderItems      RestaurantOrderItem[]

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isAvailable])
}

model RestaurantTable {
  id           String                  @id @default(cuid())
  tenantId     String
  tableNumber  Int
  name         String?
  capacity     Int
  location     String?
  status       String                  @default("AVAILABLE")
  notes        String?
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  orders       RestaurantOrder[]       @relation("TableOrders")
  reservations RestaurantReservation[]
  tenant       Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, tableNumber])
  @@index([tenantId])
  @@index([tenantId, status])
}

model RestaurantReservation {
  id                String           @id @default(cuid())
  tenantId          String
  reservationNumber String
  tableId           String?
  customerName      String
  customerPhone     String
  customerEmail     String?
  reservationDate   DateTime
  partySize         Int
  status            String           @default("CONFIRMED")
  specialRequests   String?
  notes             String?
  confirmedAt       DateTime?
  seatedAt          DateTime?
  cancelledAt       DateTime?
  cancelledReason   String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  table             RestaurantTable? @relation(fields: [tableId], references: [id])
  tenant            Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, reservationNumber])
  @@index([tenantId])
  @@index([tenantId, reservationDate])
  @@index([tenantId, status])
  @@index([tableId])
}

model RetailTransaction {
  id                  String                  @id @default(cuid())
  tenantId            String
  transactionNumber   String
  customerId          String?
  subtotal            Decimal                 @db.Decimal(10, 2)
  tax                 Decimal                 @db.Decimal(10, 2)
  discount            Decimal                 @default(0) @db.Decimal(10, 2)
  total               Decimal                 @db.Decimal(10, 2)
  paymentMethod       String
  paymentStatus       String                  @default("PENDING")
  receiptPrinted      Boolean                 @default(false)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  loyaltyTransactions LoyaltyTransaction[]    @relation("RetailTransactionLoyalty")
  tenant              Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items               RetailTransactionItem[]

  @@unique([tenantId, transactionNumber])
  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([tenantId, paymentStatus])
}

model RetailTransactionItem {
  id            String            @id @default(cuid())
  transactionId String
  productId     String
  quantity      Int
  unitPrice     Decimal           @db.Decimal(10, 2)
  subtotal      Decimal           @db.Decimal(10, 2)
  createdAt     DateTime          @default(now())
  product       RetailProduct     @relation(fields: [productId], references: [id])
  transaction   RetailTransaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@index([transactionId])
  @@index([productId])
}

model RetailProduct {
  id               String                  @id @default(cuid())
  tenantId         String
  name             String
  description      String?
  sku              String?
  barcode          String?
  category         String?
  brand            String?
  price            Decimal                 @db.Decimal(10, 2)
  costPrice        Decimal?                @db.Decimal(10, 2)
  imageUrl         String?
  stockQuantity    Int                     @default(0)
  minStockLevel    Int                     @default(0)
  maxStockLevel    Int?
  isActive         Boolean                 @default(true)
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  tenant           Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transactionItems RetailTransactionItem[]

  @@unique([tenantId, sku])
  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, barcode])
  @@index([tenantId, isActive])
}

model ManufacturingOrder {
  id             String                  @id @default(cuid())
  tenantId       String
  orderNumber    String
  productName    String
  quantity       Int
  status         String                  @default("PLANNED")
  startDate      DateTime?
  completionDate DateTime?
  actualQuantity Int?
  qualityStatus  String?
  notes          String?
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  materials      ManufacturingMaterial[]
  tenant         Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  schedules      ProductionSchedule[]

  @@unique([tenantId, orderNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, startDate])
}

model ManufacturingMaterial {
  id                String             @id @default(cuid())
  orderId           String
  materialName      String
  requiredQuantity  Decimal            @db.Decimal(10, 2)
  unit              String
  availableQuantity Decimal?           @db.Decimal(10, 2)
  supplierId        String?
  createdAt         DateTime           @default(now())
  tenantId          String?
  order             ManufacturingOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  supplier          Supplier?          @relation(fields: [supplierId], references: [id])
  Tenant            Tenant?            @relation(fields: [tenantId], references: [id])

  @@index([orderId])
  @@index([supplierId])
}

model LoyaltyProgram {
  id                  String               @id @default(cuid())
  tenantId            String
  name                String
  description         String?
  isActive            Boolean              @default(true)
  pointsPerRupee      Decimal              @default(1) @db.Decimal(10, 2)
  redemptionRate      Decimal              @default(100) @db.Decimal(10, 2)
  enableTiers         Boolean              @default(false)
  tiers               Json?
  expiryDays          Int?
  minRedemptionPoints Int                  @default(100)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  loyaltyPoints       LoyaltyPoints[]
  tenant              Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  loyaltyTransactions LoyaltyTransaction[]

  @@index([tenantId])
  @@index([tenantId, isActive])
}

model LoyaltyPoints {
  id                String               @id @default(cuid())
  tenantId          String
  programId         String
  customerId        String
  currentPoints     Decimal              @default(0) @db.Decimal(10, 2)
  totalEarned       Decimal              @default(0) @db.Decimal(10, 2)
  totalRedeemed     Decimal              @default(0) @db.Decimal(10, 2)
  tier              String?
  lastTransactionAt DateTime?
  pointsExpiryAt    DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  customer          Contact              @relation(fields: [customerId], references: [id])
  program           LoyaltyProgram       @relation(fields: [programId], references: [id], onDelete: Cascade)
  tenant            Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transactions      LoyaltyTransaction[]

  @@unique([tenantId, programId, customerId])
  @@index([tenantId])
  @@index([tenantId, programId])
  @@index([tenantId, customerId])
}

model LoyaltyTransaction {
  id            String             @id @default(cuid())
  tenantId      String
  pointsId      String
  programId     String
  transactionId String?
  type          String
  points        Decimal            @db.Decimal(10, 2)
  balanceAfter  Decimal            @db.Decimal(10, 2)
  description   String?
  notes         String?
  createdAt     DateTime           @default(now())
  loyaltyPoints LoyaltyPoints      @relation(fields: [pointsId], references: [id], onDelete: Cascade)
  program       LoyaltyProgram     @relation(fields: [programId], references: [id], onDelete: Cascade)
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transaction   RetailTransaction? @relation("RetailTransactionLoyalty", fields: [transactionId], references: [id])

  @@index([tenantId])
  @@index([tenantId, pointsId])
  @@index([tenantId, transactionId])
  @@index([tenantId, type])
  @@index([tenantId, createdAt])
}

model Supplier {
  id             String                  @id @default(cuid())
  tenantId       String
  name           String
  code           String?
  contactName    String?
  email          String?
  phone          String?
  address        String?
  city           String?
  state          String?
  pincode        String?
  gstin          String?
  pan            String?
  rating         Decimal?                @db.Decimal(3, 2)
  totalOrders    Int                     @default(0)
  onTimeDelivery Decimal?                @db.Decimal(5, 2)
  qualityScore   Decimal?                @db.Decimal(5, 2)
  paymentTerms   String?
  creditLimit    Decimal?                @db.Decimal(12, 2)
  status         String                  @default("ACTIVE")
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  materials      ManufacturingMaterial[]
  purchaseOrders PurchaseOrder[]         @relation("SupplierPurchaseOrders")
  tenant         Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([tenantId, status])
}

model ProductionSchedule {
  id                 String             @id @default(cuid())
  tenantId           String
  orderId            String
  scheduledStartDate DateTime
  scheduledEndDate   DateTime
  actualStartDate    DateTime?
  actualEndDate      DateTime?
  machineId          String?
  machineName        String?
  assignedWorkers    Json?
  status             String             @default("SCHEDULED")
  priority           String             @default("MEDIUM")
  notes              String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  order              ManufacturingOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  tenant             Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, orderId])
  @@index([tenantId, scheduledStartDate])
  @@index([tenantId, status])
}

model EmailBounce {
  id              String    @id @default(cuid())
  tenantId        String
  campaignId      String?
  emailAddress    String
  bounceType      String
  bounceReason    String?
  bounceCategory  String?
  messageId       String?
  isSuppressed    Boolean   @default(true)
  suppressedAt    DateTime  @default(now())
  suppressedUntil DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  campaign        Campaign? @relation(fields: [campaignId], references: [id])
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, emailAddress])
  @@index([tenantId])
  @@index([tenantId, bounceType])
  @@index([tenantId, isSuppressed])
}

model SMSTemplate {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  content     String
  description String?
  type        String   @default("GENERAL")
  variables   Json?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, isActive])
}

model SMSDeliveryReport {
  id             String    @id @default(cuid())
  tenantId       String
  contactId      String?
  campaignId     String?
  phoneNumber    String
  message        String
  messageId      String
  status         String    @default("PENDING")
  provider       String?
  providerStatus String?
  providerError  String?
  sentAt         DateTime?
  deliveredAt    DateTime?
  failedAt       DateTime?
  cost           Decimal?  @db.Decimal(10, 4)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  campaign       Campaign? @relation(fields: [campaignId], references: [id])
  contact        Contact?  @relation(fields: [contactId], references: [id])
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, messageId])
  @@index([tenantId, messageId])
  @@index([tenantId])
  @@index([tenantId, phoneNumber])
  @@index([tenantId, status])
  @@index([tenantId, provider])
  @@index([tenantId, createdAt])
  @@index([tenantId, campaignId])
}

model SMSOptOut {
  id           String   @id @default(cuid())
  tenantId     String
  phoneNumber  String
  reason       String?
  source       String?
  isSuppressed Boolean  @default(true)
  suppressedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, phoneNumber])
  @@index([tenantId])
  @@index([tenantId, isSuppressed])
}

model RealEstateProperty {
  id           String              @id @default(cuid())
  tenantId     String
  propertyName String
  propertyType String
  address      String
  city         String
  state        String
  pincode      String?
  totalArea    Decimal?            @db.Decimal(10, 2)
  builtUpArea  Decimal?            @db.Decimal(10, 2)
  bedrooms     Int?
  bathrooms    Int?
  price        Decimal             @db.Decimal(12, 2)
  status       String              @default("AVAILABLE")
  description  String?
  images       String[]
  floorPlan    String?
  virtualTour  String?
  amenities    String[]
  ownerId      String?
  customerId   String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  advances     RealEstateAdvance[]
  tenant       Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, propertyType])
  @@index([tenantId, status])
  @@index([tenantId, city])
}

model RealEstateAdvance {
  id              String             @id @default(cuid())
  tenantId        String
  propertyId      String
  customerId      String
  advanceAmount   Decimal            @db.Decimal(12, 2)
  totalAmount     Decimal            @db.Decimal(12, 2)
  remainingAmount Decimal            @db.Decimal(12, 2)
  paymentStatus   String             @default("PENDING")
  paymentTerms    String?
  dueDate         DateTime?
  paidAt          DateTime?
  receiptNumber   String?
  notes           String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  customer        Contact            @relation(fields: [customerId], references: [id])
  property        RealEstateProperty @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenant          Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, propertyId])
  @@index([tenantId, customerId])
  @@index([tenantId, paymentStatus])
}

model HealthcarePatient {
  id                    String                  @id @default(cuid())
  tenantId              String
  contactId             String?
  patientId             String
  fullName              String
  dateOfBirth           DateTime?
  gender                String?
  phone                 String?
  email                 String?
  address               String?
  bloodGroup            String?
  allergies             String[]
  medicalHistory        String?
  medications           String?
  emergencyContactName  String?
  emergencyContactPhone String?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  appointments          HealthcareAppointment[]
  tenant                Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, patientId])
  @@index([tenantId])
  @@index([tenantId, phone])
  @@index([tenantId, email])
}

model HealthcareAppointment {
  id              String            @id @default(cuid())
  tenantId        String
  patientId       String
  appointmentDate DateTime
  appointmentTime String?
  duration        Int?
  doctorName      String?
  department      String?
  status          String            @default("SCHEDULED")
  appointmentType String?
  reason          String?
  notes           String?
  reminderSent    Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  completedAt     DateTime?
  patient         HealthcarePatient @relation(fields: [patientId], references: [id], onDelete: Cascade)
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, patientId])
  @@index([tenantId, appointmentDate])
  @@index([tenantId, status])
  @@index([appointmentDate, status])
}

model SocialMediaAccount {
  id                String          @id @default(cuid())
  tenantId          String
  platform          String
  accountName       String
  accountId         String?
  accessToken       String
  refreshToken      String?
  expiresAt         DateTime?
  isConnected       Boolean         @default(true)
  lastSyncAt        DateTime?
  followerCount     Int             @default(0)
  lastFollowerCount DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  scheduledPosts    ScheduledPost[]
  tenant            Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  posts             SocialPost[]

  @@unique([tenantId, platform, accountId])
  @@index([tenantId])
  @@index([tenantId, platform])
  @@index([tenantId, isConnected])
}

model SocialPost {
  id             String             @id @default(cuid())
  tenantId       String
  accountId      String
  content        String
  imageUrl       String?
  videoUrl       String?
  platform       String
  status         String             @default("DRAFT")
  scheduledAt    DateTime?
  publishedAt    DateTime?
  reach          Int                @default(0)
  impressions    Int                @default(0)
  engagement     Int                @default(0)
  likes          Int                @default(0)
  comments       Int                @default(0)
  shares         Int                @default(0)
  clicks         Int                @default(0)
  platformPostId String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  account        SocialMediaAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  tenant         Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, platform])
  @@index([tenantId, status])
  @@index([tenantId, accountId])
  @@index([accountId])
  @@index([status, scheduledAt])
}

model MediaLibrary {
  id             String   @id @default(cuid())
  tenantId       String
  fileName       String
  fileUrl        String
  fileSize       Int
  mimeType       String
  width          Int?
  height         Int?
  title          String?
  description    String?
  tags           String[]
  category       String?
  source         String?
  originalPrompt String?
  editHistory    Json?
  usageCount     Int      @default(0)
  uploadedById   String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploadedBy     User?    @relation("MediaUploads", fields: [uploadedById], references: [id])

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, source])
  @@index([tenantId, createdAt])
  @@index([uploadedById])
}

model ScheduledPost {
  id           String             @id @default(cuid())
  tenantId     String
  accountId    String
  content      String
  imageUrl     String?
  videoUrl     String?
  platform     String
  scheduledAt  DateTime
  status       String             @default("SCHEDULED")
  createdBy    String?
  postedAt     DateTime?
  errorMessage String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  account      SocialMediaAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, platform])
  @@index([tenantId, status])
  @@index([tenantId, scheduledAt])
  @@index([accountId])
  @@index([status, scheduledAt])
}

model EmailAccount {
  id                  String                @id @default(cuid())
  tenantId            String
  userId              String
  email               String
  displayName         String?
  storageQuotaMB      Int                   @default(25000)
  storageUsedMB       Int                   @default(0)
  provider            String                @default("custom")
  providerAccountId   String?
  providerCredentials Json?
  password            String
  imapHost            String?
  smtpHost            String?
  imapPort            Int                   @default(993)
  smtpPort            Int                   @default(587)
  isActive            Boolean               @default(true)
  isLocked            Boolean               @default(false)
  settings            Json?
  lastLoginAt         DateTime?
  loginAttempts       Int                   @default(0)
  lastSyncAt          DateTime?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User                  @relation("EmailAccounts", fields: [userId], references: [id], onDelete: Cascade)
  autoReply           EmailAutoResponder[]
  contacts            EmailContact[]
  folders             EmailFolder[]
  forwarding          EmailForwardingRule[]
  messages            EmailMessage[]

  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([tenantId, userId])
  @@index([tenantId, isActive])
  @@index([email])
}

model EmailFolder {
  id           String         @id @default(cuid())
  accountId    String
  name         String
  type         String         @default("custom")
  unreadCount  Int            @default(0)
  totalCount   Int            @default(0)
  displayOrder Int            @default(0)
  isHidden     Boolean        @default(false)
  account      EmailAccount   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  messages     EmailMessage[]

  @@unique([accountId, name])
  @@index([accountId])
  @@index([accountId, type])
}

model EmailMessage {
  id          String            @id @default(cuid())
  accountId   String
  folderId    String
  messageId   String
  uid         Int?
  fromEmail   String
  fromName    String?
  toEmails    String[]
  ccEmails    String[]
  bccEmails   String[]
  subject     String
  body        String?
  htmlBody    String?
  isRead      Boolean           @default(false)
  isStarred   Boolean           @default(false)
  isSpam      Boolean           @default(false)
  isDraft     Boolean           @default(false)
  isArchived  Boolean           @default(false)
  threadId    String?
  inReplyTo   String?
  sentAt      DateTime?
  receivedAt  DateTime          @default(now())
  flags       String[]
  searchText  String?
  contactId   String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  attachments EmailAttachment[]
  account     EmailAccount      @relation(fields: [accountId], references: [id], onDelete: Cascade)
  contact     Contact?          @relation("EmailMessages", fields: [contactId], references: [id])
  folder      EmailFolder       @relation(fields: [folderId], references: [id], onDelete: Cascade)

  @@index([accountId, folderId, isRead])
  @@index([accountId, folderId, receivedAt])
  @@index([accountId, threadId])
  @@index([accountId, fromEmail])
  @@index([accountId, subject])
  @@index([contactId])
}

model EmailAttachment {
  id         String       @id @default(cuid())
  messageId  String
  fileName   String
  mimeType   String
  sizeBytes  Int
  storageUrl String
  localPath  String?
  scanStatus String       @default("pending")
  scanResult String?
  createdAt  DateTime     @default(now())
  message    EmailMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

model EmailContact {
  id          String       @id @default(cuid())
  accountId   String
  name        String?
  email       String
  frequency   Int          @default(1)
  lastContact DateTime     @default(now())
  contactId   String?
  account     EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  contact     Contact?     @relation("EmailContacts", fields: [contactId], references: [id])

  @@unique([accountId, email])
  @@index([accountId])
  @@index([contactId])
}

model EmailForwardingRule {
  id           String       @id @default(cuid())
  accountId    String
  matchPattern String?
  forwardTo    String[]
  isEnabled    Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  tenantId     String?
  account      EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  Tenant       Tenant?      @relation(fields: [tenantId], references: [id])

  @@index([accountId])
}

model EmailAutoResponder {
  id        String       @id @default(cuid())
  accountId String
  subject   String
  message   String
  isEnabled Boolean      @default(false)
  startDate DateTime
  endDate   DateTime?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  tenantId  String?
  account   EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  Tenant    Tenant?      @relation(fields: [tenantId], references: [id])

  @@index([accountId])
  @@index([accountId, isEnabled])
}

model ChatWorkspace {
  id            String             @id @default(cuid())
  tenantId      String             @unique
  name          String
  description   String?
  settings      Json?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  channels      ChatChannel[]
  conversations ChatConversation[]
  members       ChatMember[]
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model ChatChannel {
  id          String               @id @default(cuid())
  workspaceId String
  name        String
  description String?
  isPrivate   Boolean              @default(false)
  topic       String?
  purpose     String?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  workspace   ChatWorkspace        @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  members     ChatChannelMember[]
  messages    ChatChannelMessage[]

  @@unique([workspaceId, name])
  @@index([workspaceId])
  @@index([workspaceId, isPrivate])
}

model ChatChannelMember {
  id         String      @id @default(cuid())
  channelId  String
  memberId   String
  role       String      @default("member")
  joinedAt   DateTime    @default(now())
  lastReadAt DateTime?
  channel    ChatChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  member     ChatMember  @relation("ChannelMemberships", fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([channelId, memberId])
  @@index([channelId])
  @@index([memberId])
}

model ChatChannelMessage {
  id                  String                  @id @default(cuid())
  channelId           String
  senderId            String
  content             String
  threadParentId      String?
  isEdited            Boolean                 @default(false)
  editedAt            DateTime?
  mentionedContactIds String[]
  mentionedDealIds    String[]
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  channel             ChatChannel             @relation(fields: [channelId], references: [id], onDelete: Cascade)
  sender              ChatMember              @relation("ChannelMessages", fields: [senderId], references: [id], onDelete: Cascade)
  threadParent        ChatChannelMessage?     @relation("MessageThread", fields: [threadParentId], references: [id])
  threadMessages      ChatChannelMessage[]    @relation("MessageThread")
  attachments         ChatMessageAttachment[]
  reactions           ChatMessageReaction[]

  @@index([channelId, createdAt])
  @@index([channelId, senderId])
  @@index([threadParentId])
}

model ChatConversation {
  id           String                        @id @default(cuid())
  workspaceId  String
  name         String?
  isGroup      Boolean                       @default(false)
  createdAt    DateTime                      @default(now())
  updatedAt    DateTime                      @updatedAt
  workspace    ChatWorkspace                 @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  participants ChatConversationParticipant[]
  messages     ChatDirectMessage[]

  @@index([workspaceId])
}

model ChatConversationParticipant {
  id             String              @id @default(cuid())
  conversationId String
  memberId       String
  joinedAt       DateTime            @default(now())
  lastReadAt     DateTime?
  conversation   ChatConversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  member         ChatMember          @relation("ConversationParticipants", fields: [memberId], references: [id], onDelete: Cascade)
  directMessages ChatDirectMessage[]

  @@unique([conversationId, memberId])
  @@index([conversationId])
  @@index([memberId])
}

model ChatDirectMessage {
  id                  String                      @id @default(cuid())
  conversationId      String
  senderId            String
  content             String
  isEdited            Boolean                     @default(false)
  editedAt            DateTime?
  mentionedContactIds String[]
  mentionedDealIds    String[]
  createdAt           DateTime                    @default(now())
  updatedAt           DateTime                    @updatedAt
  conversation        ChatConversation            @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender              ChatConversationParticipant @relation(fields: [senderId], references: [id], onDelete: Cascade)
  attachments         ChatMessageAttachment[]
  reactions           ChatMessageReaction[]

  @@index([conversationId, createdAt])
  @@index([senderId])
}

model ChatMember {
  id                       String                        @id @default(cuid())
  workspaceId              String
  userId                   String
  displayName              String
  avatar                   String?
  status                   String                        @default("offline")
  lastSeen                 DateTime                      @default(now())
  channelMemberships       ChatChannelMember[]           @relation("ChannelMemberships")
  channelMessages          ChatChannelMessage[]          @relation("ChannelMessages")
  conversationParticipants ChatConversationParticipant[] @relation("ConversationParticipants")
  user                     User                          @relation("ChatMembers", fields: [userId], references: [id], onDelete: Cascade)
  workspace                ChatWorkspace                 @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, userId])
  @@index([workspaceId])
  @@index([workspaceId, status])
  @@index([userId])
}

model ChatMessageAttachment {
  id               String              @id @default(cuid())
  channelMessageId String?
  directMessageId  String?
  fileName         String
  fileUrl          String
  fileSize         Int
  mimeType         String
  uploadedAt       DateTime            @default(now())
  channelMessage   ChatChannelMessage? @relation(fields: [channelMessageId], references: [id], onDelete: Cascade)
  directMessage    ChatDirectMessage?  @relation(fields: [directMessageId], references: [id], onDelete: Cascade)

  @@index([channelMessageId])
  @@index([directMessageId])
}

model ChatMessageReaction {
  id               String              @id @default(cuid())
  channelMessageId String?
  directMessageId  String?
  userId           String
  emoji            String
  createdAt        DateTime            @default(now())
  channelMessage   ChatChannelMessage? @relation(fields: [channelMessageId], references: [id], onDelete: Cascade)
  directMessage    ChatDirectMessage?  @relation(fields: [directMessageId], references: [id], onDelete: Cascade)

  @@unique([channelMessageId, userId, emoji])
  @@unique([directMessageId, userId, emoji])
  @@index([channelMessageId])
  @@index([directMessageId])
}

model WhatsappAccount {
  id                String                 @id @default(cuid())
  tenantId          String
  deploymentType    String                 @default("payaid_hosted")
  paynaidInstanceId String?
  internalWahaUrl   String?
  internalApiKey    String?
  channelType       String                 @default("web")
  wahaBaseUrl       String?
  wahaApiKey        String?
  isWebConnected    Boolean                @default(false)
  wabaId            String?
  phoneNumberId     String?
  accessToken       String?
  metaAppId         String?
  metaAppSecret     String?
  isCloudConnected  Boolean                @default(false)
  businessName      String
  primaryPhone      String
  status            String                 @default("waiting_qr")
  errorMessage      String?
  isActive          Boolean                @default(true)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  tenant            Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  auditLogs         WhatsappAuditLog[]
  conversations     WhatsappConversation[]
  sessions          WhatsappSession[]
  templates         WhatsappTemplate[]

  @@index([tenantId])
  @@index([status])
  @@index([deploymentType])
}

model WhatsappSession {
  id                String                 @id @default(cuid())
  accountId         String
  employeeId        String?
  providerSessionId String?
  qrCodeUrl         String?
  status            String                 @default("pending_qr")
  deviceName        String?
  phoneNumber       String?
  lastSyncAt        DateTime?
  lastSeenAt        DateTime?
  dailySentCount    Int                    @default(0)
  dailyRecvCount    Int                    @default(0)
  dailyResetAt      DateTime?
  isActive          Boolean                @default(true)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  auditLogs         WhatsappAuditLog[]
  conversations     WhatsappConversation[]
  messages          WhatsappMessage[]
  account           WhatsappAccount        @relation(fields: [accountId], references: [id], onDelete: Cascade)
  employee          User?                  @relation(fields: [employeeId], references: [id])

  @@unique([accountId, providerSessionId])
  @@index([accountId])
  @@index([employeeId])
  @@index([status])
}

model WhatsappContactIdentity {
  id               String    @id @default(cuid())
  contactId        String
  whatsappNumber   String    @unique
  verified         Boolean   @default(false)
  verificationDate DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  contact          Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model WhatsappConversation {
  id            String            @id @default(cuid())
  accountId     String
  contactId     String
  sessionId     String?
  ticketId      String?
  status        String            @default("open")
  lastMessageAt DateTime?
  lastDirection String?
  unreadCount   Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  account       WhatsappAccount   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  contact       Contact           @relation(fields: [contactId], references: [id], onDelete: Cascade)
  session       WhatsappSession?  @relation(fields: [sessionId], references: [id])
  messages      WhatsappMessage[]

  @@unique([accountId, contactId])
  @@index([accountId])
  @@index([contactId])
  @@index([ticketId])
  @@index([status])
}

model WhatsappMessage {
  id                String               @id @default(cuid())
  conversationId    String
  sessionId         String?
  employeeId        String?
  direction         String
  messageType       String
  whatsappMessageId String?
  fromNumber        String
  toNumber          String
  text              String?
  mediaUrl          String?
  mediaMimeType     String?
  mediaCaption      String?
  templateId        String?
  status            String?
  errorCode         String?
  errorMessage      String?
  sentAt            DateTime?
  deliveredAt       DateTime?
  readAt            DateTime?
  createdAt         DateTime             @default(now())
  conversation      WhatsappConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  employee          User?                @relation(fields: [employeeId], references: [id])
  session           WhatsappSession?     @relation(fields: [sessionId], references: [id])
  template          WhatsappTemplate?    @relation(fields: [templateId], references: [id])

  @@index([conversationId])
  @@index([sessionId])
  @@index([employeeId])
  @@index([direction])
  @@index([messageType])
  @@index([status])
}

model WhatsappTemplate {
  id            String            @id @default(cuid())
  accountId     String
  name          String
  category      String
  languageCode  String
  bodyTemplate  String
  headerType    String?
  headerContent String?
  footerContent String?
  buttons       String?
  isMetaBacked  Boolean           @default(false)
  metaName      String?
  metaStatus    String?
  metaReason    String?
  createdById   String?
  isActive      Boolean           @default(true)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  messages      WhatsappMessage[]
  account       WhatsappAccount   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  createdBy     User?             @relation(fields: [createdById], references: [id])

  @@unique([accountId, name, languageCode])
  @@index([accountId])
  @@index([category])
}

model WhatsappAuditLog {
  id           String           @id @default(cuid())
  accountId    String
  sessionId    String?
  action       String
  description  String?
  status       String
  errorCode    String?
  errorMessage String?
  userId       String?
  details      String?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime         @default(now())
  account      WhatsappAccount  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  session      WhatsappSession? @relation(fields: [sessionId], references: [id])

  @@index([accountId])
  @@index([sessionId])
  @@index([action])
  @@index([status])
}

model Coupon {
  id                String   @id @default(cuid())
  code              String   @unique
  discountType      String
  discountValue     Float
  validFrom         DateTime
  validUntil        DateTime
  maxUses           Int?
  currentUses       Int      @default(0)
  applicableModules String[]
  minAmount         Float?
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([code])
  @@index([isActive])
  @@index([validFrom, validUntil])
}

model Vendor {
  id             String          @id @default(cuid())
  tenantId       String
  name           String
  companyName    String?
  email          String?
  phone          String?
  address        String?
  city           String?
  state          String?
  postalCode     String?
  country        String          @default("India")
  gstin          String?
  pan            String?
  paymentTerms   String?
  creditLimit    Decimal?        @db.Decimal(10, 2)
  rating         Decimal?        @db.Decimal(3, 2)
  ratingCount    Int             @default(0)
  status         String          @default("ACTIVE")
  notes          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  purchaseOrders PurchaseOrder[]
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ratings        VendorRating[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, gstin])
}

model PurchaseOrder {
  id                   String              @id @default(cuid())
  tenantId             String
  poNumber             String
  vendorId             String
  supplierId           String?
  status               String              @default("DRAFT")
  orderDate            DateTime            @default(now())
  expectedDeliveryDate DateTime?
  actualDeliveryDate   DateTime?
  subtotal             Decimal             @db.Decimal(10, 2)
  tax                  Decimal             @db.Decimal(10, 2)
  discount             Decimal             @default(0) @db.Decimal(10, 2)
  total                Decimal             @db.Decimal(10, 2)
  requestedById        String?
  approvedById         String?
  approvedAt           DateTime?
  rejectionReason      String?
  notes                String?
  termsAndConditions   String?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  goodsReceipts        GoodsReceipt[]
  approvedBy           User?               @relation("POApprovedBy", fields: [approvedById], references: [id])
  requestedBy          User?               @relation("PORequestedBy", fields: [requestedById], references: [id])
  supplier             Supplier?           @relation("SupplierPurchaseOrders", fields: [supplierId], references: [id])
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor               Vendor              @relation(fields: [vendorId], references: [id])
  items                PurchaseOrderItem[]

  @@unique([tenantId, poNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, vendorId])
  @@index([tenantId, orderDate])
}

model PurchaseOrderItem {
  id                String             @id @default(cuid())
  poId              String
  productId         String?
  productName       String
  description       String?
  quantity          Int
  unitPrice         Decimal            @db.Decimal(10, 2)
  taxRate           Decimal            @default(0) @db.Decimal(5, 2)
  taxAmount         Decimal            @default(0) @db.Decimal(10, 2)
  total             Decimal            @db.Decimal(10, 2)
  receivedQuantity  Int                @default(0)
  hsnCode           String?
  notes             String?
  createdAt         DateTime           @default(now())
  goodsReceiptItems GoodsReceiptItem[]
  purchaseOrder     PurchaseOrder      @relation(fields: [poId], references: [id], onDelete: Cascade)
  product           Product?           @relation("PurchaseOrderItems", fields: [productId], references: [id])

  @@index([poId])
  @@index([productId])
}

model GoodsReceipt {
  id            String             @id @default(cuid())
  tenantId      String
  grnNumber     String
  poId          String
  status        String             @default("PENDING")
  receivedDate  DateTime           @default(now())
  qualityStatus String?
  qualityNotes  String?
  receivedById  String?
  notes         String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  purchaseOrder PurchaseOrder      @relation(fields: [poId], references: [id])
  receivedBy    User?              @relation("GRReceivedBy", fields: [receivedById], references: [id])
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items         GoodsReceiptItem[]

  @@unique([tenantId, grnNumber])
  @@index([tenantId])
  @@index([tenantId, poId])
  @@index([tenantId, receivedDate])
}

model GoodsReceiptItem {
  id               String            @id @default(cuid())
  grnId            String
  poItemId         String
  receivedQuantity Int
  acceptedQuantity Int
  rejectedQuantity Int               @default(0)
  condition        String?
  notes            String?
  createdAt        DateTime          @default(now())
  goodsReceipt     GoodsReceipt      @relation(fields: [grnId], references: [id], onDelete: Cascade)
  poItem           PurchaseOrderItem @relation(fields: [poItemId], references: [id])

  @@index([grnId])
  @@index([poItemId])
}

model VendorRating {
  id                  String   @id @default(cuid())
  tenantId            String
  vendorId            String
  rating              Decimal  @db.Decimal(3, 2)
  qualityRating       Decimal? @db.Decimal(3, 2)
  deliveryRating      Decimal? @db.Decimal(3, 2)
  communicationRating Decimal? @db.Decimal(3, 2)
  pricingRating       Decimal? @db.Decimal(3, 2)
  comment             String?
  ratedById           String?
  createdAt           DateTime @default(now())
  ratedBy             User?    @relation("VendorRatings", fields: [ratedById], references: [id])
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor              Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, vendorId])
}

model Project {
  id              String          @id @default(cuid())
  tenantId        String
  name            String
  description     String?
  code            String?
  status          String          @default("PLANNING")
  startDate       DateTime?
  endDate         DateTime?
  actualStartDate DateTime?
  actualEndDate   DateTime?
  budget          Decimal?        @db.Decimal(10, 2)
  actualCost      Decimal         @default(0) @db.Decimal(10, 2)
  progress        Int             @default(0)
  priority        String          @default("MEDIUM")
  ownerId         String?
  clientId        String?
  tags            String[]
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  client          Contact?        @relation("ProjectClient", fields: [clientId], references: [id])
  owner           User?           @relation("ProjectOwner", fields: [ownerId], references: [id])
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  budgets         ProjectBudget[]
  members         ProjectMember[]
  tasks           ProjectTask[]
  timeEntries     TimeEntry[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, ownerId])
  @@index([tenantId, clientId])
  @@index([code])
}

model ProjectTask {
  id              String        @id @default(cuid())
  projectId       String
  name            String
  description     String?
  status          String        @default("TODO")
  priority        String        @default("MEDIUM")
  assignedToId    String?
  startDate       DateTime?
  dueDate         DateTime?
  completedAt     DateTime?
  dependsOnTaskId String?
  estimatedHours  Decimal?      @db.Decimal(10, 2)
  actualHours     Decimal       @default(0) @db.Decimal(10, 2)
  progress        Int           @default(0)
  tags            String[]
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  assignedTo      User?         @relation("AssignedProjectTasks", fields: [assignedToId], references: [id])
  dependsOnTask   ProjectTask?  @relation("TaskDependencies", fields: [dependsOnTaskId], references: [id])
  dependentTasks  ProjectTask[] @relation("TaskDependencies")
  project         Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  timeEntries     TimeEntry[]

  @@index([projectId])
  @@index([projectId, status])
  @@index([assignedToId])
  @@index([dependsOnTaskId])
}

model ProjectMember {
  id                   String   @id @default(cuid())
  projectId            String
  userId               String
  role                 String   @default("MEMBER")
  allocationPercentage Int      @default(100)
  joinedAt             DateTime @default(now())
  project              Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user                 User     @relation("ProjectMembers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
}

model TimeEntry {
  id          String       @id @default(cuid())
  projectId   String
  taskId      String?
  userId      String
  date        DateTime
  hours       Decimal      @db.Decimal(10, 2)
  description String?
  billable    Boolean      @default(false)
  billingRate Decimal?     @db.Decimal(10, 2)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  project     Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  task        ProjectTask? @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user        User         @relation("TimeEntries", fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, taskId])
  @@index([userId])
  @@index([date])
}

model ProjectBudget {
  id             String   @id @default(cuid())
  projectId      String
  category       String
  budgetedAmount Decimal  @db.Decimal(10, 2)
  actualAmount   Decimal  @default(0) @db.Decimal(10, 2)
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, category])
}

model Report {
  id             String               @id @default(cuid())
  tenantId       String
  name           String
  description    String?
  type           String
  config         Json
  templateId     String?
  scheduleConfig Json?
  lastRunAt      DateTime?
  nextRunAt      DateTime?
  createdById    String
  isPublic       Boolean              @default(false)
  isActive       Boolean              @default(true)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  createdBy      User                 @relation("ReportCreator", fields: [createdById], references: [id])
  template       ReportTemplate?      @relation(fields: [templateId], references: [id])
  tenant         Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  scheduledRuns  ScheduledReportRun[]

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, createdById])
  @@index([tenantId, isActive])
}

model ReportTemplate {
  id           String   @id @default(cuid())
  tenantId     String?
  name         String
  description  String?
  category     String
  config       Json
  previewImage String?
  isPublic     Boolean  @default(false)
  isSystem     Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  reports      Report[]
  tenant       Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([category])
  @@index([isPublic])
}

model ScheduledReportRun {
  id           String    @id @default(cuid())
  tenantId     String
  reportId     String
  status       String    @default("PENDING")
  startedAt    DateTime?
  completedAt  DateTime?
  errorMessage String?
  outputFormat String    @default("PDF")
  fileUrl      String?
  recipients   Json?
  createdAt    DateTime  @default(now())
  report       Report    @relation(fields: [reportId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, reportId])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
}

model NewsItem {
  id                 String    @id @default(cuid())
  tenantId           String?
  title              String
  summary            String?
  description        String?
  source             String
  category           String
  urgency            String    @default("informational")
  icon               String?
  industry           String?
  industryType       String?
  location           String?
  businessImpact     Json?
  recommendedActions Json?
  sourceUrl          String?
  sourceName         String?
  publishedAt        DateTime?
  expiresAt          DateTime?
  isRead             Boolean   @default(false)
  isDismissed        Boolean   @default(false)
  readAt             DateTime?
  dismissedAt        DateTime?
  tags               String[]  @default([])
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  tenant             Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, urgency])
  @@index([tenantId, industry])
  @@index([tenantId, isRead])
  @@index([tenantId, createdAt])
  @@index([industry])
  @@index([urgency])
  @@index([category])
  @@index([createdAt])
}

// Productivity Suite Models
model Spreadsheet {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  data          Json     // Spreadsheet data (cells, formulas, formatting)
  settings      Json?    // Chart settings, pivot tables, etc.
  version       Int      @default(1)
  createdById   String?
  updatedById   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy     User?    @relation("SpreadsheetCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?    @relation("SpreadsheetUpdatedBy", fields: [updatedById], references: [id])
  collaborators SpreadsheetCollaborator[]
  versions      SpreadsheetVersion[]

  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model SpreadsheetCollaborator {
  id            String     @id @default(cuid())
  spreadsheetId String
  userId        String
  role          String     @default("viewer") // viewer, editor, owner
  createdAt     DateTime   @default(now())
  spreadsheet   Spreadsheet @relation(fields: [spreadsheetId], references: [id], onDelete: Cascade)
  user          User       @relation("SpreadsheetCollaborations", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([spreadsheetId, userId])
  @@index([spreadsheetId])
  @@index([userId])
}

model SpreadsheetVersion {
  id            String     @id @default(cuid())
  spreadsheetId String
  version       Int
  data          Json
  createdById   String?
  createdAt     DateTime   @default(now())
  spreadsheet   Spreadsheet @relation(fields: [spreadsheetId], references: [id], onDelete: Cascade)
  createdBy     User?      @relation("SpreadsheetVersionCreatedBy", fields: [createdById], references: [id])

  @@index([spreadsheetId])
  @@index([spreadsheetId, version])
}

model Document {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  content       Json     // Document content (Tiptap JSON)
  htmlContent   String?  // HTML representation
  version       Int      @default(1)
  templateId    String?
  createdById   String?
  updatedById   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy     User?    @relation("DocumentCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?    @relation("DocumentUpdatedBy", fields: [updatedById], references: [id])
  collaborators DocumentCollaborator[]
  versions      DocumentVersion[]

  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model DocumentCollaborator {
  id         String   @id @default(cuid())
  documentId String
  userId     String
  role       String   @default("viewer") // viewer, editor, commenter, owner
  createdAt  DateTime @default(now())
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  user       User     @relation("DocumentCollaborations", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([documentId, userId])
  @@index([documentId])
  @@index([userId])
}

model DocumentVersion {
  id         String   @id @default(cuid())
  documentId String
  version    Int
  content    Json
  htmlContent String?
  createdById String?
  createdAt  DateTime @default(now())
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  createdBy  User?    @relation("DocumentVersionCreatedBy", fields: [createdById], references: [id])

  @@index([documentId])
  @@index([documentId, version])
}

model DriveFile {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  fileName      String
  fileUrl       String
  fileSize      Int
  mimeType      String
  fileType      String   // file, folder
  parentId      String?   // For folder structure
  parent        DriveFile? @relation("DriveFileParent", fields: [parentId], references: [id])
  children      DriveFile[] @relation("DriveFileParent")
  version       Int      @default(1)
  isShared      Boolean  @default(false)
  sharedWith    Json?    // Sharing permissions
  tags          String[] @default([])
  createdById   String?
  updatedById   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy     User?    @relation("DriveFileCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?    @relation("DriveFileUpdatedBy", fields: [updatedById], references: [id])
  versions      DriveFileVersion[]

  @@index([tenantId])
  @@index([tenantId, parentId])
  @@index([tenantId, fileType])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model DriveFileVersion {
  id          String    @id @default(cuid())
  fileId      String
  version     Int
  fileUrl     String
  fileSize    Int
  createdById String?
  createdAt   DateTime  @default(now())
  file        DriveFile @relation(fields: [fileId], references: [id], onDelete: Cascade)
  createdBy   User?     @relation("DriveFileVersionCreatedBy", fields: [createdById], references: [id])

  @@index([fileId])
  @@index([fileId, version])
}

model Presentation {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  slides        Json     // Array of slide data
  theme         String   @default("default")
  settings      Json?    // Animation settings, etc.
  version       Int      @default(1)
  createdById   String?
  updatedById   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy     User?    @relation("PresentationCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?    @relation("PresentationUpdatedBy", fields: [updatedById], references: [id])
  collaborators PresentationCollaborator[]
  versions      PresentationVersion[]

  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model PresentationCollaborator {
  id             String       @id @default(cuid())
  presentationId String
  userId         String
  role           String       @default("viewer") // viewer, editor, owner
  createdAt      DateTime     @default(now())
  presentation   Presentation @relation(fields: [presentationId], references: [id], onDelete: Cascade)
  user           User         @relation("PresentationCollaborations", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([presentationId, userId])
  @@index([presentationId])
  @@index([userId])
}

model PresentationVersion {
  id             String       @id @default(cuid())
  presentationId String
  version        Int
  slides         Json
  createdById    String?
  createdAt      DateTime     @default(now())
  presentation   Presentation @relation(fields: [presentationId], references: [id], onDelete: Cascade)
  createdBy      User?        @relation("PresentationVersionCreatedBy", fields: [createdById], references: [id])

  @@index([presentationId])
  @@index([presentationId, version])
}

model Meeting {
  id            String   @id @default(cuid())
  tenantId      String
  title         String
  description   String?
  meetingCode    String   @unique // Unique meeting code for joining
  startTime     DateTime
  endTime       DateTime?
  status        String   @default("scheduled") // scheduled, in-progress, ended, cancelled
  hostId        String
  participants  Json?    // Array of participant IDs
  recordingUrl  String?
  transcript    String?
  settings      Json?    // Q&A, polling, etc.
  createdById   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  host          User     @relation("MeetingHost", fields: [hostId], references: [id])
  createdBy     User?    @relation("MeetingCreatedBy", fields: [createdById], references: [id])

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, startTime])
  @@index([meetingCode])
  @@index([hostId])
}
