generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                           String                        @id @default(cuid())
  name                         String
  subdomain                    String?                       @unique
  domain                       String?                       @unique
  plan                         String                        @default("free")
  status                       String                        @default("active")
  industry                     String?
  industrySubType              String?
  industrySettings             Json?
  onboardingCompleted          Boolean                       @default(false)
  onboardingData               Json? // Stores onboarding selections (industries, goals, etc.)
  invoiceSettings              Json?
  gstin                        String?
  address                      String?
  city                         String?
  state                        String?
  postalCode                   String?
  country                      String?                       @default("India")
  phone                        String?
  email                        String?
  website                      String?
  logo                         String?
  maxContacts                  Int                           @default(50)
  maxInvoices                  Int                           @default(10)
  maxUsers                     Int                           @default(1)
  maxStorage                   Int                           @default(1024)
  subscriptionId               String?
  currentPeriodEnd             DateTime?
  googleAiStudioApiKey         String?
  licensedModules              String[]                      @default([])
  subscriptionTier             String                        @default("free")
  createdAt                    DateTime                      @default(now())
  updatedAt                    DateTime                      @updatedAt
  aiCalls                      AICall[]
  aiCallingBots                AICallingBot[]
  aiCofounderConversations     AICofounderConversation[]
  aiUsage                      AIUsage[]
  alerts                       Alert[]
  assets                       Asset[]
  assetAssignments             AssetAssignment[]
  attendanceRecords            AttendanceRecord[]
  auditLogs                    AuditLog[]
  apiKeys                      ApiKey[]
  apiUsageLogs                 ApiUsageLog[]
  manufacturingBOMs            ManufacturingBOM[]
  manufacturingQualityControls ManufacturingQualityControl[]
  complianceRecords            ComplianceRecord[]
  lmsCourses                   LMSCourse[]
  ecommerceStores              EcommerceStore[]
  competitors                  Competitor[]
  marketplaceAppInstallations  MarketplaceAppInstallation[]
  dataGovernancePolicies       DataGovernancePolicy[]
  dataRetentionLogs            DataRetentionLog[]
  budgetLines                  BudgetLine[]
  crmConfig                    CRMConfig?
  callFAQs                     CallFAQ[]
  callRecordings               CallRecording[]
  callTranscripts              CallTranscript[]
  campaigns                    Campaign[]
  candidates                   Candidate[]
  chatWorkspaces               ChatWorkspace?
  chatbotConversations         ChatbotConversation[]
  checkoutPages                CheckoutPage[]
  contacts                     Contact[]
  customDashboards             CustomDashboard[]
  customFields                 CustomField[]
  fieldLayouts                 FieldLayout[]
  customReports                CustomReport[]
  deals                        Deal[]
  departments                  Department[]                  @relation("TenantDepartments")
  designations                 Designation[]                 @relation("TenantDesignations")
  esiConfigs                   ESIConfig?
  emailAccounts                EmailAccount[]
  EmailAutoResponder           EmailAutoResponder[]
  emailBounces                 EmailBounce[]
  EmailForwardingRule          EmailForwardingRule[]
  emailTemplates               EmailTemplate[]
  employees                    Employee[]
  employeeDocuments            EmployeeDocument[]
  employeeSalaryStructures     EmployeeSalaryStructure[]
  employeeTaxDeclarations      EmployeeTaxDeclaration[]
  events                       Event[]
  eventRegistrations           EventRegistration[]
  exitInstances                ExitInstance[]
  exitTemplates                ExitTemplate[]
  expenses                     Expense[]
  expenseApprovals             ExpenseApproval[]
  featureToggles               FeatureToggle[]
  goodsReceipts                GoodsReceipt[]
  hrDocumentTemplates          HRDocumentTemplate[]
  healthcareAppointments       HealthcareAppointment[]
  healthcarePatients           HealthcarePatient[]
  holidayCalendars             HolidayCalendar[]
  invoices                     Invoice[]
  invoicingConfig              InvoicingConfig?
  jobRequisitions              JobRequisition[]
  knowledgeDocuments           KnowledgeDocument[]
  knowledgeQueries             KnowledgeQuery[]
  landingPages                 LandingPage[]
  leadSources                  LeadSource[]
  leaveBalances                LeaveBalance[]
  leavePolicies                LeavePolicy[]
  leaveRequests                LeaveRequest[]
  leaveTypes                   LeaveType[]
  locations                    Location[]                    @relation("TenantLocations")
  logos                        Logo[]
  logoVariations               LogoVariation[]
  loyaltyPoints                LoyaltyPoints[]
  loyaltyPrograms              LoyaltyProgram[]
  loyaltyTransactions          LoyaltyTransaction[]
  manufacturingMaterials       ManufacturingMaterial[]
  manufacturingOrders          ManufacturingOrder[]
  mediaLibrary                 MediaLibrary[]
  newsItems                    NewsItem[]
  nurtureEnrollments           NurtureEnrollment[]
  nurtureTemplates             NurtureTemplate[]
  oauthIntegrations            OAuthIntegration[]
  offers                       Offer[]
  onboardingInstances          OnboardingInstance[]
  onboardingTemplates          OnboardingTemplate[]
  orders                       Order[]
  pfConfigs                    PFConfig?
  ptConfigs                    PTConfig[]
  payrollCycles                PayrollCycle[]
  payrollRuns                  PayrollRun[]
  products                     Product[]
  productionSchedules          ProductionSchedule[]
  projects                     Project[]
  purchaseOrders               PurchaseOrder[]
  realEstateAdvances           RealEstateAdvance[]
  realEstateProperties         RealEstateProperty[]
  // Phase 1: Critical Gaps
  healthcarePrescriptions      HealthcarePrescription[]
  healthcareLabTests           HealthcareLabTest[]
  healthcareMedicalRecords     HealthcareMedicalRecord[]
  educationStudents            EducationStudent[]
  educationCourses             EducationCourse[]
  educationEnrollments         EducationEnrollment[]
  educationAttendance          EducationAttendance[]
  educationGrades              EducationGrade[]
  educationFees                EducationFee[]
  realEstateLeads              RealEstateLead[]
  realEstateSiteVisits         RealEstateSiteVisit[]
  realEstateDocuments          RealEstateDocument[]
  realEstateCommissions        RealEstateCommission[]
  realEstatePaymentMilestones  RealEstatePaymentMilestone[]
  logisticsShipments           LogisticsShipment[]
  logisticsRoutes              LogisticsRoute[]
  logisticsVehicles            LogisticsVehicle[]
  comments                     Comment[]
  activityFeeds                ActivityFeed[]
  logisticsDrivers             LogisticsDriver[]
  logisticsDeliveryProofs      LogisticsDeliveryProof[]
  logisticsFreights            LogisticsFreight[]
  // Phase 2: High Value
  agricultureCrops             AgricultureCrop[]
  agricultureInputs            AgricultureInput[]
  agricultureMandiPrices       AgricultureMandiPrice[]
  agricultureHarvests          AgricultureHarvest[]
  agricultureFPOs              AgricultureFPO[]
  constructionProjects         ConstructionProject[]
  constructionMaterials        ConstructionMaterial[]
  constructionLabors           ConstructionLabor[]
  constructionMilestones       ConstructionMilestone[]
  constructionEquipment        ConstructionEquipment[]
  beautyAppointments           BeautyAppointment[]
  beautyServices               BeautyService[]
  beautyMemberships            BeautyMembership[]
  beautyCustomerHistories      BeautyCustomerHistory[]
  beautyStaffCommissions       BeautyStaffCommission[]
  automotiveVehicles           AutomotiveVehicle[]
  automotiveJobCards           AutomotiveJobCard[]
  automotiveServiceHistories   AutomotiveServiceHistory[]
  automotiveSpareParts         AutomotiveSparePart[]
  automotiveWarranties         AutomotiveWarranty[]
  // Phase 3: Market Expansion
  hospitalityRooms             HospitalityRoom[]
  hospitalityBookings          HospitalityBooking[]
  hospitalityCheckIns          HospitalityCheckIn[]
  hospitalityHousekeepings     HospitalityHousekeeping[]
  hospitalityGuests            HospitalityGuest[]
  legalCases                   LegalCase[]
  legalClientMatters           LegalClientMatter[]
  legalCourtDates              LegalCourtDate[]
  legalDocuments               LegalDocument[]
  legalBillableHours           LegalBillableHour[]
  financialClients             FinancialClient[]
  financialTaxFilings          FinancialTaxFiling[]
  financialCompliances         FinancialCompliance[]
  financialDocuments           FinancialDocument[]
  financialAdvisories          FinancialAdvisory[]
  eventManagementEvents        EventManagementEvent[]
  eventVendors                 EventVendor[]
  eventGuests                  EventGuest[]
  eventBudgets                 EventBudget[]
  eventChecklists              EventChecklist[]
  wholesaleCustomers           WholesaleCustomer[]
  wholesalePricings            WholesalePricing[]
  wholesaleCreditLimits        WholesaleCreditLimit[]
  wholesaleRoutes              WholesaleRoute[]
  wholesaleStockTransfers      WholesaleStockTransfer[]
  reports                      Report[]
  reportTemplates              ReportTemplate[]
  // Financial Dashboard Module 1.3
  chartOfAccounts              ChartOfAccounts[]
  financialTransactions        FinancialTransaction[]
  generalLedger                GeneralLedger[]
  financialPeriods             FinancialPeriod[]
  financialBudgets             FinancialBudget[]
  financialVariances           FinancialVariance[]
  financialForecasts           FinancialForecast[]
  financialAlerts              FinancialAlert[]
  financialAlertLogs           FinancialAlertLog[]
  cashFlowProjections          CashFlowProjection[]
  restaurantMenuItems          RestaurantMenuItem[]
  savedFilters                 SavedFilter[]
  restaurantOrders             RestaurantOrder[]
  restaurantReservations       RestaurantReservation[]
  restaurantTables             RestaurantTable[]
  retailProducts               RetailProduct[]
  retailTransactions           RetailTransaction[]
  smsDeliveryReports           SMSDeliveryReport[]
  smsOptOuts                   SMSOptOut[]
  smsTemplates                 SMSTemplate[]
  salaryStructures             SalaryStructure[]
  salesReps                    SalesRep[]
  scheduledEmails              ScheduledEmail[]
  scheduledPosts               ScheduledPost[]
  scheduledReportRuns          ScheduledReportRun[]
  segments                     Segment[]
  socialMediaAccounts          SocialMediaAccount[]
  socialPosts                  SocialPost[]
  subscription                 Subscription?
  suppliers                    Supplier[]
  machines                     Machine[]
  shifts                       Shift[]
  tdsConfigs                   TDSConfig?
  tasks                        Task[]
  taxDeclarationCategories     TaxDeclarationCategory[]
  tenantMembers                TenantMember[]
  paymentSettings              TenantPaymentSettings?
  users                        User[]                        @relation("PrimaryTenant")
  vendors                      Vendor[]
  vendorRatings                VendorRating[]
  websites                     Website[]
  websiteChatbots              WebsiteChatbot[]
  websiteEvents                WebsiteEvent[]
  websiteHeatmaps              WebsiteHeatmap[]
  websiteSessions              WebsiteSession[]
  websiteVisits                WebsiteVisit[]
  whatsappAccounts             WhatsappAccount[]
  // Voice Agent Relations
  voiceAgents                  VoiceAgent[]
  voiceAgentCalls              VoiceAgentCall[]
  voiceAgentSquads             VoiceAgentSquad[]
  voiceAgentExperiments        VoiceAgentExperiment[]
  // Productivity Suite Relations
  spreadsheets                 Spreadsheet[]
  documents                    Document[]
  driveFiles                   DriveFile[]
  presentations                Presentation[]
  meetings                     Meeting[]
  // Advanced Inventory Relations
  inventoryLocations           InventoryLocation[]
  stockTransfers               StockTransfer[]
  batchSerials                 BatchSerial[]
  // Contracts & Field Service Relations
  contracts                    Contract[]
  workOrders                   WorkOrder[]
  // Asset Management Relations
  assetMaintenance             AssetMaintenance[]
  // API & Integrations Relations
  webhooks                     Webhook[]
  currencies                   Currency[]
  // Workflow Automation Relations
  workflows                    Workflow[]
  workflowExecutions           WorkflowExecution[]
  // Public Help Center Relations
  helpCenterArticles           HelpCenterArticle[]
  helpCenterSearchLogs         HelpCenterSearchLog[]
  // FSSAI Integration Relations
  fssaiLicenses                FSSAILicense[]
  fssaiCompliances             FSSAICompliance[]
  // ONDC Integration Relations
  ondcIntegrations             ONDCIntegration[]
  ondcProducts                 ONDCProduct[]
  ondcOrders                   ONDCOrder[]
  businessUnits                BusinessUnit[]
  moduleLicenses               ModuleLicense[]
  locationTrackings            LocationTracking[]
  appointments                 Appointment[]
  appointmentServices          AppointmentService[]
  appointmentReminders         AppointmentReminder[]
  // AI Influencer Marketing Relations
  aiInfluencerCampaigns        AIInfluencerCampaign[]
  aiInfluencerCharacters       AIInfluencerCharacter[]
  aiInfluencerScripts          AIInfluencerScript[]
  aiInfluencerVideos           AIInfluencerVideo[]
  aiInfluencerAnalytics        AIInfluencerAnalytics[]
  // AI Decision Automation Relations (Phase 2)
  // CRM Enhancement Relations (Gap Analysis Implementation)
  // Phase 1: RBAC Relations
  roles                        Role[]                        @relation("TenantRoles")
  userRoles                    UserRole[]                    @relation("TenantUserRoles")
  moduleAccess                 ModuleAccess[]                @relation("TenantModuleAccess")
  permissions                  Permission[]                  @relation("TenantPermissions")
  rolePermissions              RolePermission[]              @relation("TenantRolePermissions")
  userPermissions              UserPermission[]              @relation("TenantUserPermissions")
  forms                        Form[]
  formSubmissions              FormSubmission[]
  territories                  Territory[]
  quotas                       Quota[]
  accounts                     Account[]
  quotes                       Quote[]
  aIDecisions                  AIDecision[]
  riskPolicies                 RiskPolicy[]
  decisionOutcomes             DecisionOutcome[]

  @@index([subdomain])
  @@index([status])
  @@index([industry])
  @@index([subscriptionTier])
}

model TenantPaymentSettings {
  id                  String   @id @default(cuid())
  tenantId            String   @unique
  payaidApiKey        String?
  payaidSalt          String?
  payaidBaseUrl       String?
  payaidEncryptionKey String?
  payaidDecryptionKey String?
  payaidWebhookSecret String?
  isConfigured        Boolean  @default(false)
  isActive            Boolean  @default(false)
  testMode            Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model Subscription {
  id                 String                @id @default(cuid())
  tenantId           String                @unique
  planId             String?
  modules            String[]
  tier               String
  monthlyPrice       Decimal               @default(0)
  billingCycleStart  DateTime
  billingCycleEnd    DateTime
  status             String                @default("active")
  trialEndsAt        DateTime?
  cancelledAt        DateTime?
  cancellationReason String?
  paymentMethodId    String?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  tenant             Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  plan               SubscriptionPlan?     @relation(fields: [planId], references: [id])
  paymentMethod      PaymentMethod?        @relation(fields: [paymentMethodId], references: [id])
  invoices           SubscriptionInvoice[]
  dunningAttempts    DunningAttempt[]

  @@index([tenantId])
  @@index([status])
  @@index([planId])
}

model SubscriptionPlan {
  id            String         @id @default(cuid())
  name          String
  description   String?
  tier          String // starter, professional, enterprise
  monthlyPrice  Decimal
  annualPrice   Decimal?
  modules       String[] // Included modules
  features      Json? // Plan features
  maxUsers      Int?
  maxStorage    Int? // in MB
  isActive      Boolean        @default(true)
  isSystem      Boolean        @default(false) // System plans vs custom
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  subscriptions Subscription[]

  @@index([tier])
  @@index([isActive])
}

model SubscriptionInvoice {
  id              String         @id @default(cuid())
  subscriptionId  String
  tenantId        String
  invoiceNumber   String         @unique
  amount          Decimal
  taxAmount       Decimal        @default(0)
  totalAmount     Decimal
  currency        String         @default("INR")
  status          String         @default("pending") // pending, paid, failed, refunded
  dueDate         DateTime
  paidAt          DateTime?
  paymentMethodId String?
  invoiceUrl      String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  subscription    Subscription   @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])

  @@index([subscriptionId])
  @@index([tenantId])
  @@index([status])
  @@index([dueDate])
}

model PaymentMethod {
  id              String                @id @default(cuid())
  tenantId        String
  type            String // card, bank_account, upi, wallet
  provider        String // payaid (PayAid Payments only)
  token           String? // Encrypted payment token
  last4           String? // Last 4 digits
  expiryMonth     Int?
  expiryYear      Int?
  isDefault       Boolean               @default(false)
  isActive        Boolean               @default(true)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  subscriptions   Subscription[]
  invoices        SubscriptionInvoice[]
  dunningAttempts DunningAttempt[]

  @@index([tenantId])
  @@index([tenantId, isDefault])
}

model DunningAttempt {
  id              String         @id @default(cuid())
  subscriptionId  String
  invoiceId       String?
  tenantId        String
  attemptNumber   Int
  status          String // pending, success, failed
  amount          Decimal
  errorMessage    String?
  attemptedAt     DateTime       @default(now())
  succeededAt     DateTime?
  paymentMethodId String?
  createdAt       DateTime       @default(now())
  subscription    Subscription   @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])

  @@index([subscriptionId])
  @@index([tenantId])
  @@index([status])
}

model ModuleDefinition {
  id                String   @id @default(cuid())
  moduleId          String   @unique
  displayName       String
  description       String
  icon              String?
  starterPrice      Decimal
  professionalPrice Decimal
  enterprisePrice   Decimal?
  features          String[]
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([moduleId])
  @@index([isActive])
}

model CRMConfig {
  id                 String   @id @default(cuid())
  tenantId           String   @unique
  leadScoringEnabled Boolean  @default(true)
  automationsEnabled Boolean  @default(true)
  maxContacts        Int      @default(1000)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model InvoicingConfig {
  id                  String   @id @default(cuid())
  tenantId            String   @unique
  maxInvoicesPerMonth Int      @default(200)
  recurringEnabled    Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model AuditLog {
  id             String   @id @default(cuid())
  entityType     String
  entityId       String
  changedBy      String
  changeSummary  String
  beforeSnapshot Json?
  afterSnapshot  Json?
  tenantId       String
  timestamp      DateTime @default(now())
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, entityType])
  @@index([tenantId, entityId])
  @@index([tenantId, timestamp])
  @@index([changedBy])
}

model ApiKey {
  id          String        @id @default(cuid())
  orgId       String
  name        String
  keyHash     String // bcrypt hashed - original key cannot be recovered
  scopes      String[] // e.g., ['read:contacts', 'write:invoices']
  rateLimit   Int           @default(100) // requests per hour
  ipWhitelist String[] // IP addresses or CIDR ranges allowed
  expiresAt   DateTime
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  tenant      Tenant        @relation(fields: [orgId], references: [id], onDelete: Cascade)
  usageLogs   ApiUsageLog[]

  @@index([orgId])
  @@index([expiresAt])
  @@index([orgId, expiresAt])
}

model User {
  id                         String                     @id @default(cuid())
  email                      String                     @unique
  name                       String?
  password                   String?
  role                       String                     @default("member")
  avatar                     String?
  emailVerified              DateTime?
  createdAt                  DateTime                   @default(now())
  updatedAt                  DateTime                   @updatedAt
  lastLoginAt                DateTime?
  tenantId                   String
  twoFactorSecret            String?
  twoFactorEnabled           Boolean                    @default(false)
  locationTracking           LocationTracking[]
  aiCofounderConversations   AICofounderConversation[]  @relation("AICofounderConversations")
  chatMembers                ChatMember[]               @relation("ChatMembers")
  emailAccounts              EmailAccount[]             @relation("EmailAccounts")
  receivedGRs                GoodsReceipt[]             @relation("GRReceivedBy")
  uploadedMedia              MediaLibrary[]             @relation("MediaUploads")
  ownedProjects              Project[]                  @relation("ProjectOwner")
  projectMemberships         ProjectMember[]            @relation("ProjectMembers")
  assignedProjectTasks       ProjectTask[]              @relation("AssignedProjectTasks")
  approvedPOs                PurchaseOrder[]            @relation("POApprovedBy")
  requestedPOs               PurchaseOrder[]            @relation("PORequestedBy")
  createdReports             Report[]                   @relation("ReportCreator")
  salesRep                   SalesRep?                  @relation("SalesRepUser")
  assignedTasks              Task[]                     @relation("AssignedTasks")
  tenantMemberships          TenantMember[]
  timeEntries                TimeEntry[]                @relation("TimeEntries")
  activityFeeds              ActivityFeed[]
  tenant                     Tenant                     @relation("PrimaryTenant", fields: [tenantId], references: [id], onDelete: Cascade)
  vendorRatings              VendorRating[]             @relation("VendorRatings")
  whatsappMessages           WhatsappMessage[]
  whatsappSessions           WhatsappSession[]
  savedFilters               SavedFilter[]              @relation("SavedFilters")
  // Productivity Suite Relations
  spreadsheetCreated         Spreadsheet[]              @relation("SpreadsheetCreatedBy")
  spreadsheetUpdated         Spreadsheet[]              @relation("SpreadsheetUpdatedBy")
  spreadsheetCollaborations  SpreadsheetCollaborator[]  @relation("SpreadsheetCollaborations")
  spreadsheetVersionCreated  SpreadsheetVersion[]       @relation("SpreadsheetVersionCreatedBy")
  documentCreated            Document[]                 @relation("DocumentCreatedBy")
  documentUpdated            Document[]                 @relation("DocumentUpdatedBy")
  documentCollaborations     DocumentCollaborator[]     @relation("DocumentCollaborations")
  documentVersionCreated     DocumentVersion[]          @relation("DocumentVersionCreatedBy")
  driveFileCreated           DriveFile[]                @relation("DriveFileCreatedBy")
  driveFileUpdated           DriveFile[]                @relation("DriveFileUpdatedBy")
  driveFileVersionCreated    DriveFileVersion[]         @relation("DriveFileVersionCreatedBy")
  presentationCreated        Presentation[]             @relation("PresentationCreatedBy")
  presentationUpdated        Presentation[]             @relation("PresentationUpdatedBy")
  presentationCollaborations PresentationCollaborator[] @relation("PresentationCollaborations")
  presentationVersionCreated PresentationVersion[]      @relation("PresentationVersionCreatedBy")
  // Phase 1: RBAC Relations
  userRoles                  UserRole[]                 @relation("UserRoles")
  assignedUserRoles          UserRole[]                 @relation("AssignedUserRoles")
  userPermissions            UserPermission[]           @relation("UserPermissions")
  grantedUserPermissions     UserPermission[]           @relation("GrantedUserPermissions")
  stockTransfersCreated      StockTransfer[]            @relation("StockTransferCreatedBy")
  contractsCreated           Contract[]                 @relation("ContractCreatedBy")
  contractVersionsCreated    ContractVersion[]          @relation("ContractVersionCreatedBy")
  workOrdersCreated          WorkOrder[]                @relation("WorkOrderCreatedBy")
  workOrdersAssigned         WorkOrder[]                @relation("WorkOrderTechnician")
  serviceHistoryRecords      ServiceHistory[]           @relation("ServiceHistoryTechnician")
  meetingHost                Meeting[]                  @relation("MeetingHost")
  meetingCreated             Meeting[]                  @relation("MeetingCreatedBy")
  createdWhatsappTemplates   WhatsappTemplate[]
  helpCenterArticles         HelpCenterArticle[]        @relation("HelpCenterArticleAuthor")

  @@index([email])
  // Performance indexes for 10,000+ users
  @@index([tenantId], name: "idx_user_tenant_fk") // Replaces unnamed duplicate
}

model TenantMember {
  id        String   @id @default(cuid())
  userId    String
  tenantId  String
  role      String   @default("member")
  createdAt DateTime @default(now())
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, tenantId])
  @@index([tenantId])
}

model SalesRep {
  id                   String                @id @default(cuid())
  userId               String                @unique
  tenantId             String
  specialization       String?
  conversionRate       Float                 @default(0)
  isOnLeave            Boolean               @default(false)
  leaveEndDate         DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  alerts               Alert[]
  assignedLeads        Contact[]
  deals                Deal[]
  interactions         Interaction[]         @relation("RepInteractions")
  comments             Comment[]             @relation("CommentCreatedBy")
  territoryAssignments TerritoryAssignment[]
  quotas               Quota[]
  tenant               Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                 User                  @relation("SalesRepUser", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, isOnLeave])
}

model Contact {
  id                    String                    @id @default(cuid())
  name                  String
  email                 String?
  phone                 String?
  company               String?
  type                  String                    @default("lead") // Deprecated: Use stage instead
  stage                 String                    @default("prospect") // prospect, contact, customer
  status                String                    @default("active")
  source                String?
  sourceId              String?
  sourceData            Json?
  attributionChannel    String?
  address               String?
  city                  String?
  state                 String?
  postalCode            String?
  country               String?                   @default("India")
  gstin                 String?
  likelyToBuy           Boolean?                  @default(false)
  churnRisk             Boolean?                  @default(false)
  leadScore             Float                     @default(0)
  scoreUpdatedAt        DateTime                  @default(now())
  scoreComponents       Json?
  tags                  String[]
  notes                 String?
  createdAt             DateTime                  @default(now())
  lastContactedAt       DateTime?
  nextFollowUp          DateTime?
  tenantId              String
  assignedToId          String?
  assignedTo            SalesRep?                 @relation(fields: [assignedToId], references: [id])
  leadSource            LeadSource?               @relation(fields: [sourceId], references: [id])
  tenant                Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  deals                 Deal[]
  emailContacts         EmailContact[]            @relation("EmailContacts")
  emailMessages         EmailMessage[]            @relation("EmailMessages")
  interactions          Interaction[]
  invoices              Invoice[]                 @relation("CustomerInvoices")
  loyaltyPoints         LoyaltyPoints[]
  nurtureEnrollments    NurtureEnrollment[]
  orders                Order[]                   @relation("CustomerOrders")
  clientProjects        Project[]                 @relation("ProjectClient")
  realEstateAdvances    RealEstateAdvance[]
  smsDeliveryReports    SMSDeliveryReport[]
  scheduledEmails       ScheduledEmail[]
  tasks                 Task[]
  whatsappIdentities    WhatsappContactIdentity[]
  whatsappConversations WhatsappConversation[]
  workOrders            WorkOrder[]
  formSubmissions       FormSubmission[]
  account               Account?                  @relation(fields: [accountId], references: [id], onDelete: SetNull)
  accountId             String?
  quotes                Quote[]
  contracts             Contract[]

  @@index([tenantId])
  @@index([accountId])
  @@index([tenantId, type])
  @@index([tenantId, stage]) // New index for stage filtering
  @@index([tenantId, createdAt])
  @@index([tenantId, leadScore])
  // Performance indexes for 10,000+ users
  @@index([tenantId, status, createdAt(sort: Desc)], name: "idx_contact_tenant_status_created")
  @@index([tenantId, status], name: "idx_contact_list_covering") // Replaces unnamed duplicate
}

model Interaction {
  id             String    @id @default(cuid())
  type           String
  subject        String?
  notes          String?
  duration       Int?
  outcome        String?
  createdByRepId String?
  createdAt      DateTime  @default(now())
  contactId      String
  contact        Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)
  createdByRep   SalesRep? @relation("RepInteractions", fields: [createdByRepId], references: [id])

  @@index([contactId])
  @@index([createdAt])
  @@index([createdByRepId])
}

model AIUsage {
  id          String   @id @default(cuid())
  tenantId    String
  service     String
  tokens      Int?
  duration    Int?
  requestType String?
  modelUsed   String?
  createdAt   DateTime @default(now())
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, service])
  @@index([tenantId, createdAt])
  @@index([service])
}

model AICofounderConversation {
  id               String   @id @default(cuid())
  tenantId         String
  userId           String
  title            String?
  agentId          String
  messages         Json
  messageCount     Int      @default(0)
  lastMessageAt    DateTime @default(now())
  suggestedActions Json?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user             User     @relation("AICofounderConversations", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, userId])
  @@index([lastMessageAt])
}

model Deal {
  id                String     @id @default(cuid())
  name              String
  value             Float
  probability       Float      @default(50)
  stage             String     @default("lead")
  expectedCloseDate DateTime?
  actualCloseDate   DateTime?
  lostReason        String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  tenantId          String
  contactId         String? // Made optional for direct Deal creation
  contactName       String? // For creating Deal without Contact
  contactEmail      String? // For creating Deal without Contact
  contactPhone      String? // For creating Deal without Contact
  assignedToId      String?
  assignedTo        SalesRep?  @relation(fields: [assignedToId], references: [id])
  contact           Contact?   @relation(fields: [contactId], references: [id], onDelete: SetNull)
  tenant            Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  quote             Quote?
  contracts         Contract[]

  @@index([tenantId])
  @@index([tenantId, stage])
  @@index([contactId])
  // Performance indexes for 10,000+ users
  @@index([tenantId, stage, value(sort: Desc)], name: "idx_deal_tenant_stage_value")
}

model Task {
  id           String    @id @default(cuid())
  title        String
  description  String?
  priority     String    @default("medium")
  status       String    @default("pending")
  dueDate      DateTime?
  completedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenantId     String
  contactId    String?
  assignedToId String?
  assignedTo   User?     @relation("AssignedTasks", fields: [assignedToId], references: [id])
  contact      Contact?  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([assignedToId])
  @@index([contactId], name: "idx_task_contact_fk")
  // Performance indexes for 10,000+ users
  @@index([tenantId, status, dueDate], name: "idx_task_tenant_status_due")
}

model SavedFilter {
  id           String   @id @default(cuid())
  tenantId     String
  userId       String? // If null, it's a shared filter for the tenant
  name         String
  module       String   @default("crm") // crm, sales, etc.
  entityType   String   @default("lead") // lead, contact, deal, etc.
  filters      Json // Filter criteria (source, status, assignedTo, etc.)
  isDefault    Boolean  @default(false)
  displayOrder Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user         User?    @relation("SavedFilters", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, module, entityType])
  @@index([tenantId, userId])
  @@index([tenantId, name, entityType]) // For checking duplicates
}

model Product {
  id                 String              @id @default(cuid())
  name               String
  description        String?
  sku                String
  barcode            String?
  costPrice          Float
  salePrice          Float
  discountPrice      Float?
  quantity           Int                 @default(0)
  reorderLevel       Int                 @default(10)
  images             String[]
  categories         String[]
  hsnCode            String?
  sacCode            String?
  gstRate            Float?
  itemType           String?
  totalSold          Int                 @default(0)
  totalRevenue       Float               @default(0)
  lastSoldAt         DateTime?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  tenantId           String
  orderItems         OrderItem[]
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  purchaseOrderItems PurchaseOrderItem[] @relation("PurchaseOrderItems")
  inventoryLocations InventoryLocation[]
  stockTransfers     StockTransfer[]
  batchSerials       BatchSerial[]

  @@index([tenantId])
  @@index([tenantId, sku])
  @@index([tenantId, categories])
}

model Order {
  id              String      @id @default(cuid())
  orderNumber     String      @unique
  status          String      @default("pending")
  subtotal        Float
  tax             Float
  shipping        Float
  total           Float
  discountCode    String?
  discountAmount  Float?
  shippingAddress String
  shippingCity    String
  shippingPostal  String
  shippingCountry String      @default("India")
  shippingOrderId String?
  trackingUrl     String?
  createdAt       DateTime    @default(now())
  paidAt          DateTime?
  shippedAt       DateTime?
  deliveredAt     DateTime?
  tenantId        String
  customerId      String?
  customer        Contact?    @relation("CustomerOrders", fields: [customerId], references: [id])
  tenant          Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items           OrderItem[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([orderNumber])
  // Performance indexes for 10,000+ users
  @@index([tenantId, status, createdAt(sort: Desc)], name: "idx_order_tenant_status_created")
}

model OrderItem {
  id          String   @id @default(cuid())
  productName String
  quantity    Int
  price       Float
  total       Float
  orderId     String
  productId   String?
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product? @relation(fields: [productId], references: [id])

  @@index([orderId])
}

model Invoice {
  id                     String            @id @default(cuid())
  invoiceNumber          String            @unique
  status                 String            @default("draft")
  subtotal               Float
  tax                    Float
  total                  Float
  gstRate                Float?
  gstAmount              Float?
  cgst                   Float?
  sgst                   Float?
  igst                   Float?
  isInterState           Boolean           @default(false)
  placeOfSupply          String?
  hsnCode                String?
  reverseCharge          Boolean           @default(false)
  supplierGSTIN          String?
  orderNumber            String?
  terms                  String?
  accountsReceivable     String?
  salespersonId          String?
  template               String?
  discount               Float             @default(0)
  discountType           String            @default("amount")
  tdsType                String?
  tdsTax                 String?
  tdsAmount              Float?
  adjustment             Float             @default(0)
  notes                  String?
  termsAndConditions     String?
  items                  Json?
  customerName           String?
  customerEmail          String?
  customerPhone          String?
  customerAddress        String?
  customerCity           String?
  customerState          String?
  customerPostalCode     String?
  customerGSTIN          String?
  paymentLinkUrl         String?
  paymentLinkUuid        String?
  paymentLinkExpiry      DateTime?
  paymentTransactionId   String?
  paymentStatus          String?
  paymentMode            String?
  paymentChannel         String?
  paymentDatetime        DateTime?
  paymentLinkOpenedAt    DateTime?
  paymentLinkOpenedCount Int               @default(0)
  invoiceDate            DateTime          @default(now())
  dueDate                DateTime?
  paidAt                 DateTime?
  tenantId               String
  customerId             String?
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  customer               Contact?          @relation("CustomerInvoices", fields: [customerId], references: [id])
  tenant                 Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  restaurantOrders       RestaurantOrder[] @relation("RestaurantOrderInvoices")

  @@index([tenantId])
  @@index([invoiceNumber])
  @@index([paymentTransactionId])
  @@index([paymentLinkUuid])
  // Performance indexes for 10,000+ users
  @@index([tenantId, status, dueDate], name: "idx_invoice_tenant_status_due")
  @@index([tenantId, status], name: "idx_invoice_list_covering") // Replaces unnamed duplicate
  @@index([tenantId, status, createdAt], name: "idx_invoice_forecast_query") // For revenue forecasting queries
  @@index([tenantId, createdAt], name: "idx_invoice_tenant_created") // For date range queries
  @@index([status, createdAt], name: "idx_invoice_status_created") // For status-based date queries
}

model Department {
  id              String           @id @default(cuid())
  name            String
  code            String?
  tenantId        String
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  tenant          Tenant           @relation("TenantDepartments", fields: [tenantId], references: [id], onDelete: Cascade)
  employees       Employee[]
  jobRequisitions JobRequisition[]

  @@unique([tenantId, name])
  @@index([tenantId])
}

model Designation {
  id        String     @id @default(cuid())
  name      String
  code      String?
  tenantId  String
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  tenant    Tenant     @relation("TenantDesignations", fields: [tenantId], references: [id], onDelete: Cascade)
  employees Employee[]

  @@unique([tenantId, name])
  @@index([tenantId])
}

model Location {
  id                 String              @id @default(cuid())
  name               String
  code               String?
  city               String?
  state              String?
  country            String              @default("India")
  tenantId           String
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  assets             Asset[]
  employees          Employee[]
  holidayCalendars   HolidayCalendar[]
  jobRequisitions    JobRequisition[]
  inventoryLocations InventoryLocation[]
  stockTransfersFrom StockTransfer[]     @relation("StockTransferFrom")
  stockTransfersTo   StockTransfer[]     @relation("StockTransferTo")
  batchSerials       BatchSerial[]
  tenant             Tenant              @relation("TenantLocations", fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId])
}

model Employee {
  id                   String                    @id @default(cuid())
  employeeCode         String
  firstName            String
  lastName             String
  officialEmail        String
  personalEmail        String?
  mobileCountryCode    String                    @default("+91")
  mobileNumber         String
  joiningDate          DateTime
  probationEndDate     DateTime?
  confirmationDate     DateTime?
  exitDate             DateTime?
  exitReason           String?
  status               String                    @default("ACTIVE")
  departmentId         String?
  designationId        String?
  managerId            String?
  locationId           String?
  ctcAnnualInr         Decimal?                  @db.Decimal(12, 2)
  fixedComponentInr    Decimal?                  @db.Decimal(12, 2)
  variableComponentInr Decimal?                  @db.Decimal(12, 2)
  bankAccountNumber    String?
  ifscCode             String?
  bankName             String?
  accountType          String?
  panNumber            String?
  aadhaarNumber        String?
  uanNumber            String?
  esiNumber            String?
  pfApplicable         Boolean                   @default(false)
  esiApplicable        Boolean                   @default(false)
  ptApplicable         Boolean                   @default(true)
  tdsApplicable        Boolean                   @default(true)
  createdBy            String?
  updatedBy            String?
  tenantId             String
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  assetAssignments     AssetAssignment[]
  attendanceRecords    AttendanceRecord[]
  department           Department?               @relation(fields: [departmentId], references: [id])
  designation          Designation?              @relation(fields: [designationId], references: [id])
  location             Location?                 @relation(fields: [locationId], references: [id])
  manager              Employee?                 @relation("EmployeeManager", fields: [managerId], references: [id])
  reports              Employee[]                @relation("EmployeeManager")
  tenant               Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  employeeDocuments    EmployeeDocument[]
  salaryStructures     EmployeeSalaryStructure[]
  taxDeclarations      EmployeeTaxDeclaration[]
  exitInstances        ExitInstance[]
  expenses             Expense[]                 @relation("EmployeeExpenses")
  leaveBalances        LeaveBalance[]
  leaveRequests        LeaveRequest[]
  offers               Offer[]
  onboardingInstances  OnboardingInstance[]
  payrollRuns          PayrollRun[]

  @@unique([tenantId, employeeCode])
  @@unique([tenantId, officialEmail])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, departmentId])
  @@index([tenantId, designationId])
  @@index([managerId])
}

model OAuthIntegration {
  id             String    @id @default(cuid())
  tenantId       String
  provider       String
  accessToken    String
  refreshToken   String?
  expiresAt      DateTime?
  tokenType      String?   @default("Bearer")
  scope          String?
  providerUserId String?
  providerEmail  String?
  providerName   String?
  isActive       Boolean   @default(true)
  lastUsedAt     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, provider])
  @@index([tenantId])
  @@index([provider])
}

model Expense {
  id                 String            @id @default(cuid())
  tenantId           String
  description        String
  amount             Decimal           @db.Decimal(10, 2)
  category           String
  vendor             String?
  date               DateTime          @default(now())
  receiptUrl         String?
  gstAmount          Decimal?          @db.Decimal(10, 2)
  hsnCode            String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  approvedAt         DateTime?
  approverId         String?
  employeeId         String?
  isRecurring        Boolean           @default(false)
  nextRecurrenceDate DateTime?
  recurringFrequency String?
  reimbursedAt       DateTime?
  rejectedAt         DateTime?
  rejectionReason    String?
  status             String            @default("pending")
  employee           Employee?         @relation("EmployeeExpenses", fields: [employeeId], references: [id])
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  approvals          ExpenseApproval[]

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, date])
  @@index([tenantId, status])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model ExpenseApproval {
  id           String   @id @default(cuid())
  expenseId    String
  approverId   String
  approverName String?
  status       String
  comments     String?
  tenantId     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  expense      Expense  @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([expenseId])
  @@index([approverId])
}

model BudgetLine {
  id           String   @id @default(cuid())
  tenantId     String
  category     String
  period       String
  periodType   String
  budgetAmount Decimal  @db.Decimal(12, 2)
  actualAmount Decimal  @default(0) @db.Decimal(12, 2)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, category, period])
  @@index([tenantId])
  @@index([tenantId, period])
}

model Segment {
  id             String   @id @default(cuid())
  name           String
  description    String?
  criteria       String
  criteriaConfig String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, createdAt])
}

model Campaign {
  id                 String              @id @default(cuid())
  name               String
  type               String
  subject            String?
  content            String
  status             String              @default("draft")
  segmentId          String?
  contactIds         String[]
  scheduledFor       DateTime?
  sentAt             DateTime?
  recipientCount     Int                 @default(0)
  sent               Int                 @default(0)
  delivered          Int                 @default(0)
  opened             Int                 @default(0)
  clicked            Int                 @default(0)
  bounced            Int                 @default(0)
  unsubscribed       Int                 @default(0)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  tenantId           String
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  emailBounces       EmailBounce[]
  leadSources        LeadSource[]
  smsDeliveryReports SMSDeliveryReport[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, type])
  @@index([tenantId, createdAt])
}

model NurtureTemplate {
  id          String              @id @default(cuid())
  name        String
  description String?
  tenantId    String
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  enrollments NurtureEnrollment[]
  steps       NurtureStep[]
  tenant      Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, createdAt])
}

model NurtureStep {
  id         String          @id @default(cuid())
  templateId String
  dayNumber  Int
  channel    String          @default("email")
  subject    String?
  body       String
  order      Int
  createdAt  DateTime        @default(now())
  template   NurtureTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@index([templateId, order])
}

model ScheduledEmail {
  id          String    @id @default(cuid())
  contactId   String
  templateId  String?
  channel     String    @default("email")
  subject     String?
  body        String
  scheduledAt DateTime
  sentAt      DateTime?
  status      String    @default("PENDING")
  retryCount  Int       @default(0)
  tenantId    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  contact     Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, scheduledAt])
  @@index([contactId])
  @@index([status, scheduledAt])
  @@index([channel, status])
}

model NurtureEnrollment {
  id             String          @id @default(cuid())
  contactId      String
  templateId     String
  enrolledAt     DateTime        @default(now())
  status         String          @default("ACTIVE")
  completedSteps Int             @default(0)
  totalSteps     Int
  tenantId       String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  contact        Contact         @relation(fields: [contactId], references: [id], onDelete: Cascade)
  template       NurtureTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([contactId])
  @@index([templateId])
  @@index([status, enrolledAt])
}

model LeadSource {
  id               String    @id @default(cuid())
  name             String
  type             String
  tenantId         String
  leadsCount       Int       @default(0)
  conversionsCount Int       @default(0)
  totalValue       Float     @default(0)
  avgDealValue     Float     @default(0)
  conversionRate   Float     @default(0)
  roi              Float     @default(0)
  campaignId       String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  contacts         Contact[]
  campaign         Campaign? @relation(fields: [campaignId], references: [id])
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, createdAt])
}

model Alert {
  id        String    @id @default(cuid())
  repId     String
  type      String
  title     String
  message   String
  leadId    String?
  dealId    String?
  taskId    String?
  channels  String[]
  priority  String    @default("MEDIUM")
  isRead    Boolean   @default(false)
  readAt    DateTime?
  tenantId  String
  createdAt DateTime  @default(now())
  rep       SalesRep  @relation(fields: [repId], references: [id], onDelete: Cascade)
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, repId])
  @@index([tenantId, isRead])
  @@index([tenantId, createdAt])
  @@index([repId, isRead])
}

model AttendanceRecord {
  id                String    @id @default(cuid())
  employeeId        String
  date              DateTime  @db.Date
  checkInTime       DateTime?
  checkOutTime      DateTime?
  workHours         Decimal?  @db.Decimal(5, 2)
  status            String    @default("PRESENT")
  source            String    @default("WEB")
  checkInLatitude   Decimal?  @db.Decimal(10, 8)
  checkInLongitude  Decimal?  @db.Decimal(11, 8)
  checkOutLatitude  Decimal?  @db.Decimal(10, 8)
  checkOutLongitude Decimal?  @db.Decimal(11, 8)
  remarks           String?
  tenantId          String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  employee          Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, employeeId, date])
  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([tenantId, date])
  @@index([employeeId, date])
}

model LeaveType {
  id            String         @id @default(cuid())
  name          String
  code          String?
  tenantId      String
  isActive      Boolean        @default(true)
  isPaid        Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  leaveBalances LeaveBalance[]
  leavePolicies LeavePolicy[]  @relation("LeaveTypePolicies")
  leaveRequests LeaveRequest[]
  tenant        Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId])
}

model LeavePolicy {
  id                  String    @id @default(cuid())
  leaveTypeId         String
  tenantId            String
  accrualType         String    @default("MONTHLY")
  accrualAmount       Decimal   @db.Decimal(5, 2)
  maxBalance          Decimal?  @db.Decimal(5, 2)
  carryForwardLimit   Decimal?  @db.Decimal(5, 2)
  carryForwardEnabled Boolean   @default(true)
  minDaysNotice       Int?
  maxConsecutiveDays  Int?
  requiresApproval    Boolean   @default(true)
  requiresDocument    Boolean   @default(false)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  leaveType           LeaveType @relation("LeaveTypePolicies", fields: [leaveTypeId], references: [id], onDelete: Cascade)
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([leaveTypeId])
}

model LeaveBalance {
  id          String    @id @default(cuid())
  employeeId  String
  leaveTypeId String
  balance     Decimal   @db.Decimal(5, 2)
  asOfDate    DateTime  @default(now())
  tenantId    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  employee    Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, employeeId, leaveTypeId, asOfDate])
  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model LeaveRequest {
  id                    String    @id @default(cuid())
  employeeId            String
  leaveTypeId           String
  startDate             DateTime  @db.Date
  endDate               DateTime  @db.Date
  days                  Decimal   @db.Decimal(5, 2)
  isHalfDay             Boolean   @default(false)
  halfDayType           String?
  reason                String?
  supportingDocumentUrl String?
  status                String    @default("PENDING")
  approverId            String?
  approvedAt            DateTime?
  rejectedAt            DateTime?
  rejectionReason       String?
  tenantId              String
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  employee              Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  leaveType             LeaveType @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([tenantId, status])
  @@index([employeeId])
  @@index([approverId])
}

model HolidayCalendar {
  id         String    @id @default(cuid())
  name       String
  date       DateTime  @db.Date
  isOptional Boolean   @default(false)
  locationId String?
  tenantId   String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  location   Location? @relation(fields: [locationId], references: [id])
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, locationId, date])
  @@index([tenantId])
  @@index([tenantId, date])
}

model SalaryStructure {
  id                       String                    @id @default(cuid())
  name                     String
  description              String?
  tenantId                 String
  isDefault                Boolean                   @default(false)
  structureJson            Json
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  employeeSalaryStructures EmployeeSalaryStructure[]
  tenant                   Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, isDefault])
}

model EmployeeSalaryStructure {
  id            String          @id @default(cuid())
  employeeId    String
  structureId   String
  effectiveFrom DateTime
  effectiveTo   DateTime?
  tenantId      String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  employee      Employee        @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  structure     SalaryStructure @relation(fields: [structureId], references: [id], onDelete: Cascade)
  tenant        Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
  @@index([structureId])
}

model PayrollCycle {
  id          String       @id @default(cuid())
  month       Int
  year        Int
  tenantId    String
  status      String       @default("DRAFT")
  runType     String       @default("REGULAR")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payrollRuns PayrollRun[]

  @@unique([tenantId, month, year, runType])
  @@index([tenantId])
  @@index([tenantId, status])
}

model PayrollRun {
  id                 String              @id @default(cuid())
  cycleId            String
  employeeId         String
  grossEarningsInr   Decimal             @db.Decimal(12, 2)
  grossDeductionsInr Decimal             @db.Decimal(12, 2)
  tdsInr             Decimal             @db.Decimal(12, 2)
  pfEmployeeInr      Decimal             @db.Decimal(12, 2)
  pfEmployerInr      Decimal             @db.Decimal(12, 2)
  esiEmployeeInr     Decimal             @db.Decimal(12, 2)
  esiEmployerInr     Decimal             @db.Decimal(12, 2)
  ptInr              Decimal             @db.Decimal(12, 2)
  lopDays            Decimal             @db.Decimal(5, 2)
  lopAmountInr       Decimal             @db.Decimal(12, 2)
  netPayInr          Decimal             @db.Decimal(12, 2)
  daysPaid           Int
  payoutStatus       String              @default("PENDING")
  payaidPayoutId     String?
  payslipUrl         String?
  generatedAt        DateTime?
  approvedAt         DateTime?
  paidAt             DateTime?
  tenantId           String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  adjustments        PayrollAdjustment[]
  cycle              PayrollCycle        @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  employee           Employee            @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, cycleId, employeeId])
  @@index([tenantId])
  @@index([tenantId, cycleId])
  @@index([tenantId, employeeId])
  @@index([tenantId, payoutStatus])
}

model PayrollAdjustment {
  id             String     @id @default(cuid())
  payrollRunId   String
  componentName  String
  originalAmount Decimal    @db.Decimal(12, 2)
  adjustedAmount Decimal    @db.Decimal(12, 2)
  reason         String
  adjustedBy     String
  createdAt      DateTime   @default(now())
  payrollRun     PayrollRun @relation(fields: [payrollRunId], references: [id], onDelete: Cascade)

  @@index([payrollRunId])
}

model PFConfig {
  id              String   @id @default(cuid())
  tenantId        String   @unique
  wageCeiling     Decimal  @default(15000) @db.Decimal(10, 2)
  employeePercent Decimal  @default(12) @db.Decimal(5, 2)
  employerPercent Decimal  @default(12) @db.Decimal(5, 2)
  epsPercent      Decimal  @default(3.67) @db.Decimal(5, 2)
  pfPercent       Decimal  @default(8.33) @db.Decimal(5, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model ESIConfig {
  id              String   @id @default(cuid())
  tenantId        String   @unique
  wageCeiling     Decimal  @default(21000) @db.Decimal(10, 2)
  employeePercent Decimal  @default(0.75) @db.Decimal(5, 2)
  employerPercent Decimal  @default(3.25) @db.Decimal(5, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model PTConfig {
  id        String   @id @default(cuid())
  tenantId  String
  state     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ptSlabs   PTSlab[]

  @@unique([tenantId, state])
  @@index([tenantId])
}

model PTSlab {
  id          String   @id @default(cuid())
  configId    String
  salaryFrom  Decimal  @db.Decimal(12, 2)
  salaryTo    Decimal? @db.Decimal(12, 2)
  ptAmountInr Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  config      PTConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@index([configId])
}

model TDSConfig {
  id                String   @id @default(cuid())
  tenantId          String   @unique
  taxSlabsJson      Json
  standardDeduction Decimal  @default(50000) @db.Decimal(10, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model TaxDeclarationCategory {
  id             String                   @id @default(cuid())
  name           String
  code           String
  description    String?
  maxAmountInr   Decimal?                 @db.Decimal(12, 2)
  tenantId       String
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  declarations   EmployeeTaxDeclaration[]
  tenant         Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  proofDocuments TaxProofDocument[]

  @@unique([tenantId, code])
  @@index([tenantId])
}

model EmployeeTaxDeclaration {
  id                String                 @id @default(cuid())
  employeeId        String
  categoryId        String
  financialYear     String
  declaredAmountInr Decimal                @db.Decimal(12, 2)
  approvedAmountInr Decimal?               @db.Decimal(12, 2)
  status            String                 @default("PENDING")
  verifiedBy        String?
  verifiedAt        DateTime?
  rejectionReason   String?
  tenantId          String
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  category          TaxDeclarationCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  employee          Employee               @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant            Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  proofDocuments    TaxProofDocument[]

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
  @@index([categoryId])
}

model TaxProofDocument {
  id                 String                  @id @default(cuid())
  declarationId      String
  categoryId         String?
  fileUrl            String
  fileName           String
  fileType           String
  uploadedAt         DateTime                @default(now())
  verifiedBy         String?
  verificationStatus String                  @default("PENDING")
  createdAt          DateTime                @default(now())
  category           TaxDeclarationCategory? @relation(fields: [categoryId], references: [id])
  declaration        EmployeeTaxDeclaration  @relation(fields: [declarationId], references: [id], onDelete: Cascade)

  @@index([declarationId])
  @@index([categoryId])
}

model JobRequisition {
  id                String         @id @default(cuid())
  title             String
  departmentId      String?
  locationId        String?
  employmentType    String         @default("FULL_TIME")
  requestedBy       String
  approvedBy        String?
  budgetedCtcMinInr Decimal?       @db.Decimal(12, 2)
  budgetedCtcMaxInr Decimal?       @db.Decimal(12, 2)
  status            String         @default("DRAFT")
  tenantId          String
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  candidateJobs     CandidateJob[]
  jobPostings       JobPosting[]
  department        Department?    @relation(fields: [departmentId], references: [id])
  location          Location?      @relation(fields: [locationId], references: [id])
  tenant            Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  offers            Offer[]

  @@index([tenantId])
  @@index([tenantId, status])
}

model JobPosting {
  id            String         @id @default(cuid())
  requisitionId String
  postedOn      String?
  status        String         @default("DRAFT")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  requisition   JobRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)

  @@index([requisitionId])
}

model Candidate {
  id               String           @id @default(cuid())
  fullName         String
  email            String
  phone            String
  source           String           @default("OTHERS")
  currentCompany   String?
  currentCtcInr    Decimal?         @db.Decimal(12, 2)
  expectedCtcInr   Decimal?         @db.Decimal(12, 2)
  noticePeriodDays Int?
  location         String?
  skills           String[]
  resumeFileUrl    String?
  status           String           @default("NEW")
  tenantId         String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  candidateJobs    CandidateJob[]
  interviewRounds  InterviewRound[]
  offers           Offer[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, source])
}

model CandidateJob {
  id            String         @id @default(cuid())
  candidateId   String
  requisitionId String
  stage         String         @default("APPLIED")
  createdAt     DateTime       @default(now())
  candidate     Candidate      @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  requisition   JobRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)

  @@unique([candidateId, requisitionId])
  @@index([candidateId])
  @@index([requisitionId])
}

model InterviewRound {
  id            String    @id @default(cuid())
  candidateId   String
  roundName     String
  scheduledAt   DateTime
  mode          String    @default("VIDEO")
  interviewerId String?
  feedback      String?
  rating        Int?
  status        String    @default("SCHEDULED")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  candidate     Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([interviewerId])
}

model Offer {
  id             String         @id @default(cuid())
  candidateId    String
  requisitionId  String
  employeeId     String?
  offeredCtcInr  Decimal        @db.Decimal(12, 2)
  acceptedCtcInr Decimal?       @db.Decimal(12, 2)
  joiningDate    DateTime?
  offerStatus    String         @default("DRAFT")
  offerLetterUrl String?
  tenantId       String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  candidate      Candidate      @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  employee       Employee?      @relation(fields: [employeeId], references: [id])
  requisition    JobRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
  tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([requisitionId])
  @@index([tenantId])
}

model OnboardingTemplate {
  id          String               @id @default(cuid())
  name        String
  description String?
  tenantId    String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  instances   OnboardingInstance[]
  tasks       OnboardingTask[]
  tenant      Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model OnboardingTask {
  id              String                   @id @default(cuid())
  templateId      String
  title           String
  description     String?
  assignedToRole  String
  dueDaysRelative Int
  order           Int
  createdAt       DateTime                 @default(now())
  instanceTasks   OnboardingInstanceTask[]
  template        OnboardingTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@index([templateId, order])
}

model OnboardingInstance {
  id          String                   @id @default(cuid())
  employeeId  String
  templateId  String
  status      String                   @default("IN_PROGRESS")
  startDate   DateTime                 @default(now())
  completedAt DateTime?
  tenantId    String
  createdAt   DateTime                 @default(now())
  updatedAt   DateTime                 @updatedAt
  employee    Employee                 @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template    OnboardingTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)
  tenant      Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tasks       OnboardingInstanceTask[]

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model OnboardingInstanceTask {
  id          String             @id @default(cuid())
  instanceId  String
  taskId      String
  assigneeId  String?
  status      String             @default("PENDING")
  completedAt DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  instance    OnboardingInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  task        OnboardingTask     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([instanceId, taskId])
  @@index([instanceId])
  @@index([taskId])
  @@index([assigneeId])
}

model ExitTemplate {
  id          String         @id @default(cuid())
  name        String
  description String?
  tenantId    String
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  instances   ExitInstance[]
  tasks       ExitTask[]
  tenant      Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model ExitTask {
  id              String             @id @default(cuid())
  templateId      String
  title           String
  description     String?
  assignedToRole  String
  dueDaysRelative Int
  order           Int
  createdAt       DateTime           @default(now())
  instanceTasks   ExitInstanceTask[]
  template        ExitTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
}

model ExitInstance {
  id          String             @id @default(cuid())
  employeeId  String
  templateId  String
  status      String             @default("IN_PROGRESS")
  exitDate    DateTime
  startDate   DateTime           @default(now())
  completedAt DateTime?
  tenantId    String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  employee    Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template    ExitTemplate       @relation(fields: [templateId], references: [id], onDelete: Cascade)
  tenant      Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tasks       ExitInstanceTask[]

  @@index([tenantId])
  @@index([employeeId])
}

model ExitInstanceTask {
  id          String       @id @default(cuid())
  instanceId  String
  taskId      String
  assigneeId  String?
  status      String       @default("PENDING")
  completedAt DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  instance    ExitInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  task        ExitTask     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([instanceId, taskId])
  @@index([instanceId])
}

model Asset {
  id                  String              @id @default(cuid())
  assetTag            String
  assetType           String
  serialNumber        String?
  brand               String?
  model               String?
  purchaseDate        DateTime?
  purchaseCostInr     Decimal?            @db.Decimal(12, 2)
  currentValue        Decimal?            @db.Decimal(12, 2)
  depreciationMethod  String? // STRAIGHT_LINE, DECLINING_BALANCE, UNITS_OF_PRODUCTION
  depreciationRate    Decimal?            @db.Decimal(5, 2) // Annual percentage
  usefulLifeYears     Int? // Expected useful life
  warrantyExpiryDate  DateTime?
  status              String              @default("AVAILABLE") // AVAILABLE, ASSIGNED, MAINTENANCE, RETIRED, DISPOSED
  locationId          String?
  tenantId            String
  notes               String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  location            Location?           @relation(fields: [locationId], references: [id])
  tenant              Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignments         AssetAssignment[]
  maintenanceRecords  AssetMaintenance[]
  depreciationRecords AssetDepreciation[]

  @@unique([tenantId, assetTag])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, assetType])
}

model AssetMaintenance {
  id                  String    @id @default(cuid())
  assetId             String
  maintenanceType     String // PREVENTIVE, CORRECTIVE, INSPECTION
  scheduledDate       DateTime?
  completedDate       DateTime?
  cost                Decimal?  @db.Decimal(10, 2)
  technician          String?
  description         String
  notes               String?
  nextMaintenanceDate DateTime?
  tenantId            String
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  asset               Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, assetId])
  @@index([tenantId, scheduledDate])
}

model AssetAssignment {
  id                String    @id @default(cuid())
  assetId           String
  employeeId        String
  assignedDate      DateTime  @default(now())
  returnedDate      DateTime?
  conditionOnAssign String?
  conditionOnReturn String?
  remarks           String?
  tenantId          String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  asset             Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)
  employee          Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, assetId])
  @@index([tenantId, employeeId])
  @@index([assetId])
  @@index([employeeId])
}

model HRDocumentTemplate {
  id           String             @id @default(cuid())
  name         String
  type         String
  bodyHtml     String
  placeholders Json
  tenantId     String
  isActive     Boolean            @default(true)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  documents    EmployeeDocument[]
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, type])
}

model EmployeeDocument {
  id           String              @id @default(cuid())
  employeeId   String
  templateId   String?
  documentType String
  fileUrl      String
  generatedAt  DateTime            @default(now())
  generatedBy  String
  tenantId     String
  createdAt    DateTime            @default(now())
  employee     Employee            @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template     HRDocumentTemplate? @relation(fields: [templateId], references: [id])
  tenant       Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, employeeId])
  @@index([employeeId])
}

model Website {
  id              String           @id @default(cuid())
  tenantId        String
  name            String
  domain          String?          @unique
  subdomain       String?          @unique
  status          String           @default("DRAFT")
  metaTitle       String?
  metaDescription String?
  faviconUrl      String?
  trackingCode    String           @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  chatbots        WebsiteChatbot[]
  events          WebsiteEvent[]
  heatmaps        WebsiteHeatmap[]
  pages           WebsitePage[]
  sessions        WebsiteSession[]
  visits          WebsiteVisit[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([domain])
  @@index([subdomain])
  @@index([trackingCode])
}

model WebsitePage {
  id          String           @id @default(cuid())
  websiteId   String
  path        String
  title       String
  contentJson Json
  isPublished Boolean          @default(false)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  events      WebsiteEvent[]
  heatmaps    WebsiteHeatmap[]
  website     Website          @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  visits      WebsiteVisit[]

  @@unique([websiteId, path])
  @@index([websiteId])
  @@index([websiteId, isPublished])
}

model WebsiteVisit {
  id        String          @id @default(cuid())
  websiteId String
  pageId    String?
  sessionId String?
  ipAddress String?
  userAgent String?
  referrer  String?
  country   String?
  city      String?
  device    String?
  browser   String?
  os        String?
  visitedAt DateTime        @default(now())
  duration  Int?
  tenantId  String
  page      WebsitePage?    @relation(fields: [pageId], references: [id])
  session   WebsiteSession? @relation(fields: [sessionId], references: [id])
  tenant    Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website   Website         @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([sessionId])
  @@index([visitedAt])
}

model WebsiteSession {
  id           String         @id @default(cuid())
  websiteId    String
  sessionId    String         @unique
  visitorId    String?
  startedAt    DateTime       @default(now())
  endedAt      DateTime?
  duration     Int?
  pageViews    Int            @default(1)
  isBounce     Boolean        @default(true)
  recordingUrl String?
  tenantId     String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  events       WebsiteEvent[]
  tenant       Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website      Website        @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  visits       WebsiteVisit[]

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([sessionId])
  @@index([startedAt])
}

model WebsiteEvent {
  id              String          @id @default(cuid())
  websiteId       String
  pageId          String?
  sessionId       String?
  eventType       String
  eventName       String
  elementId       String?
  elementText     String?
  elementSelector String?
  metadata        Json?
  occurredAt      DateTime        @default(now())
  tenantId        String
  page            WebsitePage?    @relation(fields: [pageId], references: [id])
  session         WebsiteSession? @relation(fields: [sessionId], references: [id])
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website         Website         @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([sessionId])
  @@index([eventType])
  @@index([occurredAt])
}

model WebsiteHeatmap {
  id          String       @id @default(cuid())
  websiteId   String
  pageId      String?
  heatmapType String
  dataJson    Json
  imageUrl    String?
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime     @default(now())
  tenantId    String
  page        WebsitePage? @relation(fields: [pageId], references: [id])
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website     Website      @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([websiteId])
  @@index([pageId])
  @@index([heatmapType])
}

model AICall {
  id               String           @id @default(cuid())
  tenantId         String
  phoneNumber      String
  direction        String           @default("INBOUND")
  status           String           @default("RINGING")
  twilioCallSid    String?          @unique
  twilioAccountSid String?
  startedAt        DateTime         @default(now())
  answeredAt       DateTime?
  endedAt          DateTime?
  duration         Int?
  handledByAI      Boolean          @default(true)
  aiIntent         String?
  aiConfidence     Decimal?         @db.Decimal(5, 2)
  contactId        String?
  dealId           String?
  leadId           String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  recordings       CallRecording[]
  transcripts      CallTranscript[]

  @@index([tenantId])
  @@index([tenantId, phoneNumber])
  @@index([tenantId, status])
  @@index([twilioCallSid])
  @@index([startedAt])
}

model CallRecording {
  id           String   @id @default(cuid())
  callId       String
  recordingUrl String
  duration     Int
  format       String   @default("mp3")
  createdAt    DateTime @default(now())
  tenantId     String
  call         AICall   @relation(fields: [callId], references: [id], onDelete: Cascade)
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([callId])
}

model CallTranscript {
  id             String   @id @default(cuid())
  callId         String
  transcript     String
  segments       Json?
  language       String   @default("en")
  sentiment      String?
  sentimentScore Decimal? @db.Decimal(5, 2)
  keyPoints      Json?
  actionItems    Json?
  createdAt      DateTime @default(now())
  tenantId       String
  call           AICall   @relation(fields: [callId], references: [id], onDelete: Cascade)
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([callId])
  @@index([sentiment])
}

model CallFAQ {
  id         String    @id @default(cuid())
  tenantId   String
  question   String
  answer     String
  category   String?
  timesUsed  Int       @default(0)
  lastUsedAt DateTime?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isActive])
}

// AI Calling Bot Model
model AICallingBot {
  id               String   @id @default(cuid())
  tenantId         String
  name             String
  phoneNumber      String
  greeting         String?
  faqKnowledgeBase Json? // Array of { question: string, answer: string }
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([phoneNumber])
}

// Voice Agent Models
model VoiceAgent {
  id                   String                  @id @default(cuid())
  tenantId             String
  name                 String
  description          String?
  language             String                  @default("hi") // hi, en, ta, te, kn, mr, gu, pa, bn, ml
  voiceId              String? // Voice identifier for TTS
  voiceTone            String? // professional, friendly, casual
  systemPrompt         String                  @db.Text
  phoneNumber          String?                 @unique // Assigned phone number (E.164 format: +1234567890)
  twilioApplicationSid String? // Twilio Application SID for this agent
  inboundEnabled       Boolean                 @default(true) // Can receive incoming calls
  outboundEnabled      Boolean                 @default(true) // Can make outbound calls
  status               String                  @default("active") // active, paused, deleted
  knowledgeBase        Json? // Knowledge base configuration
  functions            Json? // Function calling configuration
  compliance           Json? // Compliance settings (DND, consent, etc.)
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  tenant               Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  calls                VoiceAgentCall[]
  squadMembers         VoiceAgentSquadMember[]
  experiments          VoiceAgentExperiment[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, language])
  @@index([phoneNumber])
}

model VoiceAgentCall {
  id                    String                           @id @default(cuid())
  agentId               String
  tenantId              String
  callSid               String?                          @unique // Twilio CallSid (unique identifier for the call)
  from                  String? // Caller number (E.164 format: +1234567890)
  to                    String? // Called number (E.164 format: +1234567890)
  phone                 String // Legacy field - keep for backward compatibility
  inbound               Boolean                          @default(false) // Is this an incoming call?
  customerName          String?
  customerId            String?
  status                String // ringing, in-progress, completed, failed
  startTime             DateTime?
  endTime               DateTime?
  durationSeconds       Int?
  languageUsed          String? // Detected language
  transcript            String?                          @db.Text
  recordingUrl          String? // URL to call recording
  recordingSid          String? // Twilio Recording SID
  dndChecked            Boolean                          @default(false)
  dndStatus             String?
  costRupees            Decimal?                         @db.Decimal(10, 2)
  webhookSent           Boolean                          @default(false)
  createdAt             DateTime                         @default(now())
  updatedAt             DateTime                         @updatedAt
  agent                 VoiceAgent                       @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tenant                Tenant                           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  metadata              VoiceAgentCallMetadata?
  experimentAssignments VoiceAgentExperimentAssignment[]
  messages              CallMessage[] // Real-time call messages/transcripts

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
  @@index([agentId])
  @@index([phone])
  @@index([callSid])
  @@index([from])
  @@index([to])
}

model VoiceAgentCallMetadata {
  id                String         @id @default(cuid())
  callId            String         @unique
  recordingUrl      String?
  recordingDuration Int?
  sentiment         String?
  sentimentScore    Decimal?       @db.Decimal(3, 2)
  actionsExecuted   Json? // Array of executed functions
  llmProvider       String? // ollama, groq, etc.
  ttsLatencyMs      Int?
  sttConfidence     Decimal?       @db.Decimal(3, 2)
  conversationTurns Int?
  createdAt         DateTime       @default(now())
  call              VoiceAgentCall @relation(fields: [callId], references: [id], onDelete: Cascade)

  @@index([callId])
  @@index([sentiment])
}

// Real-time call messages/transcripts (for streaming transcripts)
model CallMessage {
  id         String   @id @default(cuid())
  callId     String
  role       String // "user", "assistant", "system"
  content    String   @db.Text
  isPartial  Boolean  @default(false) // Is this a partial/interim transcript?
  confidence Float? // STT confidence score (0.0 to 1.0)
  timestamp  DateTime @default(now())

  call VoiceAgentCall @relation(fields: [callId], references: [id], onDelete: Cascade)

  @@index([callId])
  @@index([timestamp])
  @@index([callId, timestamp])
}

// Multi-Agent Orchestration (Squads)
model VoiceAgentSquad {
  id           String   @id @default(cuid())
  tenantId     String
  name         String
  description  String?
  routingRules Json? // Routing logic configuration
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tenant  Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  members VoiceAgentSquadMember[]

  @@index([tenantId])
}

model VoiceAgentSquadMember {
  id         String   @id @default(cuid())
  squadId    String
  agentId    String
  priority   Int      @default(0) // Higher priority = checked first
  conditions Json? // Routing conditions (when to route to this agent)
  createdAt  DateTime @default(now())

  squad VoiceAgentSquad @relation(fields: [squadId], references: [id], onDelete: Cascade)
  agent VoiceAgent      @relation(fields: [agentId], references: [id], onDelete: Cascade)

  @@unique([squadId, agentId])
  @@index([squadId])
  @@index([agentId])
}

// A/B Testing Framework
model VoiceAgentExperiment {
  id           String    @id @default(cuid())
  agentId      String
  tenantId     String
  name         String
  description  String?
  variants     Json // Array of variant configurations
  trafficSplit Json // Traffic distribution (variantId -> percentage)
  status       String    @default("active") // active, paused, completed
  startDate    DateTime  @default(now())
  endDate      DateTime?
  metrics      Json? // Experiment results
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  agent       VoiceAgent                       @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tenant      Tenant                           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignments VoiceAgentExperimentAssignment[]

  @@index([agentId])
  @@index([tenantId])
  @@index([status])
  @@index([agentId, status])
}

model VoiceAgentExperimentAssignment {
  id           String   @id @default(cuid())
  experimentId String
  callId       String
  variant      String // Which variant was assigned
  metrics      Json? // Call-specific metrics
  createdAt    DateTime @default(now())

  experiment VoiceAgentExperiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)
  call       VoiceAgentCall       @relation(fields: [callId], references: [id], onDelete: Cascade)

  @@unique([experimentId, callId])
  @@index([experimentId])
  @@index([callId])
  @@index([variant])
}

model Logo {
  id           String          @id @default(cuid())
  tenantId     String
  businessName String
  industry     String?
  style        String?
  colors       Json?
  prompt       String
  modelUsed    String?
  status       String          @default("GENERATING")
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  tenant       Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  variations   LogoVariation[]

  @@index([tenantId])
  @@index([tenantId, status])
}

model LogoVariation {
  id              String   @id @default(cuid())
  logoId          String
  imageUrl        String
  thumbnailUrl    String?
  colors          Json?
  fonts           Json?
  iconStyle       String?
  exportedFormats Json?
  isSelected      Boolean  @default(false)
  createdAt       DateTime @default(now())
  tenantId        String
  logo            Logo     @relation(fields: [logoId], references: [id], onDelete: Cascade)
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([logoId])
  @@index([tenantId, isSelected])
}

model LandingPage {
  id              String   @id @default(cuid())
  tenantId        String
  name            String
  slug            String   @unique
  status          String   @default("DRAFT")
  contentJson     Json
  metaTitle       String?
  metaDescription String?
  variantA        String?
  variantB        String?
  activeVariant   String?
  views           Int      @default(0)
  conversions     Int      @default(0)
  conversionRate  Decimal? @db.Decimal(5, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([slug])
}

model CheckoutPage {
  id                  String   @id @default(cuid())
  tenantId            String
  name                String
  slug                String   @unique
  paymentMethods      Json
  couponsEnabled      Boolean  @default(true)
  showOrderSummary    Boolean  @default(true)
  showShippingOptions Boolean  @default(true)
  contentJson         Json
  status              String   @default("DRAFT")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([slug])
}

model WebsiteChatbot {
  id                String                @id @default(cuid())
  tenantId          String
  name              String
  websiteId         String?
  position          String                @default("bottom-right")
  primaryColor      String                @default("#007bff")
  greetingMessage   String                @default("Hello! How can I help you today?")
  autoGreet         Boolean               @default(true)
  autoGreetDelay    Int                   @default(3000)
  leadQualification Boolean               @default(true)
  aiModel           String                @default("gpt-3.5-turbo")
  temperature       Decimal               @default(0.7) @db.Decimal(3, 2)
  faqEnabled        Boolean               @default(true)
  knowledgeBase     Json?
  isActive          Boolean               @default(true)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  conversations     ChatbotConversation[]
  tenant            Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  website           Website?              @relation(fields: [websiteId], references: [id])

  @@index([tenantId])
  @@index([tenantId, websiteId])
  @@index([tenantId, isActive])
}

model ChatbotConversation {
  id           String         @id @default(cuid())
  chatbotId    String
  visitorId    String
  sessionId    String
  contactId    String?
  leadId       String?
  messages     Json
  startedAt    DateTime       @default(now())
  endedAt      DateTime?
  messageCount Int            @default(0)
  qualified    Boolean        @default(false)
  tenantId     String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  chatbot      WebsiteChatbot @relation(fields: [chatbotId], references: [id], onDelete: Cascade)
  tenant       Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([chatbotId])
  @@index([visitorId])
  @@index([contactId])
  @@index([leadId])
}

model KnowledgeDocument {
  id             String                   @id @default(cuid())
  tenantId       String
  title          String
  description    String?
  category       String?
  tags           String[]
  fileUrl        String
  fileName       String
  fileSize       Int
  fileType       String
  mimeType       String
  extractedText  String?
  summary        String?
  isIndexed      Boolean                  @default(false)
  indexedAt      DateTime?
  embeddingModel String?
  uploadedBy     String?
  uploadedAt     DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  tenant         Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  chunks         KnowledgeDocumentChunk[]
  queries        KnowledgeQuery[]

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isIndexed])
}

model KnowledgeDocumentChunk {
  id             String            @id @default(cuid())
  documentId     String
  chunkIndex     Int
  content        String
  startChar      Int?
  endChar        Int?
  embedding      Json?
  embeddingModel String?
  metadata       Json?
  createdAt      DateTime          @default(now())
  document       KnowledgeDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([documentId, chunkIndex])
}

model KnowledgeQuery {
  id         String             @id @default(cuid())
  documentId String?
  tenantId   String
  query      String
  answer     String
  sources    Json
  confidence Float?
  askedBy    String?
  askedAt    DateTime           @default(now())
  modelUsed  String?
  tokensUsed Int?
  document   KnowledgeDocument? @relation(fields: [documentId], references: [id])
  tenant     Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, askedAt])
  @@index([documentId])
}

model Event {
  id                   String              @id @default(cuid())
  tenantId             String
  title                String
  description          String?
  slug                 String              @unique
  startDate            DateTime
  endDate              DateTime
  timezone             String              @default("Asia/Kolkata")
  locationType         String              @default("PHYSICAL")
  address              String?
  city                 String?
  state                String?
  virtualUrl           String?
  registrationEnabled  Boolean             @default(true)
  maxAttendees         Int?
  registrationDeadline DateTime?
  priceInr             Decimal?            @db.Decimal(10, 2)
  streamingEnabled     Boolean             @default(false)
  streamingUrl         String?
  status               String              @default("DRAFT")
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  registrations        EventRegistration[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([slug])
  @@index([startDate])
}

model EventRegistration {
  id            String    @id @default(cuid())
  eventId       String
  name          String
  email         String
  phone         String?
  company       String?
  status        String    @default("REGISTERED")
  registeredAt  DateTime  @default(now())
  confirmedAt   DateTime?
  attendedAt    DateTime?
  paidAmountInr Decimal?  @db.Decimal(10, 2)
  paymentStatus String?
  tenantId      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  event         Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([eventId, email])
  @@index([tenantId])
  @@index([eventId])
  @@index([email])
  @@index([status])
}

model EmailTemplate {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  category    String?
  subject     String
  htmlContent String
  textContent String?
  variables   Json?
  timesUsed   Int       @default(0)
  lastUsedAt  DateTime?
  isActive    Boolean   @default(true)
  isDefault   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isActive])
}

model CustomDashboard {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  description String?
  layoutJson  Json
  widgets     Json
  isDefault   Boolean  @default(false)
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, isDefault])
}

model CustomReport {
  id                String   @id @default(cuid())
  tenantId          String
  name              String
  description       String?
  reportType        String
  filters           Json
  columns           Json
  grouping          Json?
  sorting           Json?
  scheduleEnabled   Boolean  @default(false)
  scheduleFrequency String?
  scheduleDay       Int?
  scheduleTime      String?
  recipients        Json?
  exportFormats     Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, reportType])
}

model FeatureToggle {
  id          String   @id @default(cuid())
  tenantId    String
  featureName String
  isEnabled   Boolean  @default(false)
  settings    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, featureName])
  @@index([tenantId])
  @@index([tenantId, isEnabled])
  @@index([featureName])
}

model CustomField {
  id           String   @id @default(cuid())
  tenantId     String
  name         String
  fieldType    String
  isRequired   Boolean  @default(false)
  model        String
  options      Json?
  defaultValue String?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, model, name])
  @@index([tenantId])
  @@index([tenantId, model])
}

model FieldLayout {
  id         String   @id @default(cuid())
  tenantId   String
  module     String // crm, sales, etc.
  entityType String // lead, contact, deal, etc.
  viewType   String // CREATE, QUICK_CREATE, DETAIL_VIEW, LIST_VIEW
  layoutJson Json // Field layout configuration with sections and fields
  isDefault  Boolean  @default(false)
  createdBy  String? // User ID who created this layout
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, module, entityType, viewType])
  @@index([tenantId])
  @@index([tenantId, module, entityType])
}

model RestaurantOrder {
  id            String                @id @default(cuid())
  tenantId      String
  orderNumber   String
  tableNumber   Int?
  customerName  String?
  customerPhone String?
  status        String                @default("PENDING")
  totalAmount   Decimal               @db.Decimal(10, 2)
  paymentStatus String                @default("PENDING")
  notes         String?
  estimatedTime Int?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  servedAt      DateTime?
  invoiceId     String?
  tableId       String?
  invoice       Invoice?              @relation("RestaurantOrderInvoices", fields: [invoiceId], references: [id])
  table         RestaurantTable?      @relation("TableOrders", fields: [tableId], references: [id])
  tenant        Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items         RestaurantOrderItem[]

  @@unique([tenantId, orderNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
  @@index([status, createdAt])
  @@index([invoiceId])
}

model RestaurantOrderItem {
  id                  String             @id @default(cuid())
  orderId             String
  menuItemId          String
  quantity            Int
  price               Decimal            @db.Decimal(10, 2)
  subtotal            Decimal            @db.Decimal(10, 2)
  specialInstructions String?
  createdAt           DateTime           @default(now())
  menuItem            RestaurantMenuItem @relation(fields: [menuItemId], references: [id])
  order               RestaurantOrder    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([menuItemId])
}

model RestaurantMenuItem {
  id              String                @id @default(cuid())
  tenantId        String
  name            String
  description     String?
  category        String
  price           Decimal               @db.Decimal(10, 2)
  imageUrl        String?
  isAvailable     Boolean               @default(true)
  isVegetarian    Boolean               @default(false)
  isVegan         Boolean               @default(false)
  isSpicy         Boolean               @default(false)
  preparationTime Int?
  calories        Int?
  displayOrder    Int                   @default(0)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  tenant          Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  orderItems      RestaurantOrderItem[]

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isAvailable])
}

model RestaurantTable {
  id           String                  @id @default(cuid())
  tenantId     String
  tableNumber  Int
  name         String?
  capacity     Int
  location     String?
  status       String                  @default("AVAILABLE")
  notes        String?
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  orders       RestaurantOrder[]       @relation("TableOrders")
  reservations RestaurantReservation[]
  tenant       Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, tableNumber])
  @@index([tenantId])
  @@index([tenantId, status])
}

model RestaurantReservation {
  id                String           @id @default(cuid())
  tenantId          String
  reservationNumber String
  tableId           String?
  customerName      String
  customerPhone     String
  customerEmail     String?
  reservationDate   DateTime
  partySize         Int
  status            String           @default("CONFIRMED")
  specialRequests   String?
  notes             String?
  confirmedAt       DateTime?
  seatedAt          DateTime?
  cancelledAt       DateTime?
  cancelledReason   String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  table             RestaurantTable? @relation(fields: [tableId], references: [id])
  tenant            Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, reservationNumber])
  @@index([tenantId])
  @@index([tenantId, reservationDate])
  @@index([tenantId, status])
  @@index([tableId])
}

model RetailTransaction {
  id                  String                  @id @default(cuid())
  tenantId            String
  transactionNumber   String
  customerId          String?
  subtotal            Decimal                 @db.Decimal(10, 2)
  tax                 Decimal                 @db.Decimal(10, 2)
  discount            Decimal                 @default(0) @db.Decimal(10, 2)
  total               Decimal                 @db.Decimal(10, 2)
  paymentMethod       String
  paymentStatus       String                  @default("PENDING")
  receiptPrinted      Boolean                 @default(false)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  loyaltyTransactions LoyaltyTransaction[]    @relation("RetailTransactionLoyalty")
  tenant              Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items               RetailTransactionItem[]

  @@unique([tenantId, transactionNumber])
  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([tenantId, paymentStatus])
}

model RetailTransactionItem {
  id            String            @id @default(cuid())
  transactionId String
  productId     String
  quantity      Int
  unitPrice     Decimal           @db.Decimal(10, 2)
  subtotal      Decimal           @db.Decimal(10, 2)
  createdAt     DateTime          @default(now())
  product       RetailProduct     @relation(fields: [productId], references: [id])
  transaction   RetailTransaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@index([transactionId])
  @@index([productId])
}

model RetailProduct {
  id               String                  @id @default(cuid())
  tenantId         String
  name             String
  description      String?
  sku              String?
  barcode          String?
  category         String?
  brand            String?
  price            Decimal                 @db.Decimal(10, 2)
  costPrice        Decimal?                @db.Decimal(10, 2)
  imageUrl         String?
  stockQuantity    Int                     @default(0)
  minStockLevel    Int                     @default(0)
  maxStockLevel    Int?
  isActive         Boolean                 @default(true)
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  tenant           Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transactionItems RetailTransactionItem[]

  @@unique([tenantId, sku])
  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, barcode])
  @@index([tenantId, isActive])
}

model ManufacturingOrder {
  id             String                  @id @default(cuid())
  tenantId       String
  orderNumber    String
  productName    String
  quantity       Int
  status         String                  @default("PLANNED")
  startDate      DateTime?
  completionDate DateTime?
  actualQuantity Int?
  qualityStatus  String?
  notes          String?
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  materials      ManufacturingMaterial[]
  tenant         Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  schedules      ProductionSchedule[]

  @@unique([tenantId, orderNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, startDate])
}

model ManufacturingMaterial {
  id                String             @id @default(cuid())
  orderId           String
  materialName      String
  requiredQuantity  Decimal            @db.Decimal(10, 2)
  unit              String
  availableQuantity Decimal?           @db.Decimal(10, 2)
  supplierId        String?
  createdAt         DateTime           @default(now())
  tenantId          String?
  order             ManufacturingOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  supplier          Supplier?          @relation(fields: [supplierId], references: [id])
  Tenant            Tenant?            @relation(fields: [tenantId], references: [id])

  @@index([orderId])
  @@index([supplierId])
}

model LoyaltyProgram {
  id                  String               @id @default(cuid())
  tenantId            String
  name                String
  description         String?
  isActive            Boolean              @default(true)
  pointsPerRupee      Decimal              @default(1) @db.Decimal(10, 2)
  redemptionRate      Decimal              @default(100) @db.Decimal(10, 2)
  enableTiers         Boolean              @default(false)
  tiers               Json?
  expiryDays          Int?
  minRedemptionPoints Int                  @default(100)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  loyaltyPoints       LoyaltyPoints[]
  tenant              Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  loyaltyTransactions LoyaltyTransaction[]

  @@index([tenantId])
  @@index([tenantId, isActive])
}

model LoyaltyPoints {
  id                String               @id @default(cuid())
  tenantId          String
  programId         String
  customerId        String
  currentPoints     Decimal              @default(0) @db.Decimal(10, 2)
  totalEarned       Decimal              @default(0) @db.Decimal(10, 2)
  totalRedeemed     Decimal              @default(0) @db.Decimal(10, 2)
  tier              String?
  lastTransactionAt DateTime?
  pointsExpiryAt    DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  customer          Contact              @relation(fields: [customerId], references: [id])
  program           LoyaltyProgram       @relation(fields: [programId], references: [id], onDelete: Cascade)
  tenant            Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transactions      LoyaltyTransaction[]

  @@unique([tenantId, programId, customerId])
  @@index([tenantId])
  @@index([tenantId, programId])
  @@index([tenantId, customerId])
}

model LoyaltyTransaction {
  id            String             @id @default(cuid())
  tenantId      String
  pointsId      String
  programId     String
  transactionId String?
  type          String
  points        Decimal            @db.Decimal(10, 2)
  balanceAfter  Decimal            @db.Decimal(10, 2)
  description   String?
  notes         String?
  createdAt     DateTime           @default(now())
  loyaltyPoints LoyaltyPoints      @relation(fields: [pointsId], references: [id], onDelete: Cascade)
  program       LoyaltyProgram     @relation(fields: [programId], references: [id], onDelete: Cascade)
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transaction   RetailTransaction? @relation("RetailTransactionLoyalty", fields: [transactionId], references: [id])

  @@index([tenantId])
  @@index([tenantId, pointsId])
  @@index([tenantId, transactionId])
  @@index([tenantId, type])
  @@index([tenantId, createdAt])
}

model Supplier {
  id             String                  @id @default(cuid())
  tenantId       String
  name           String
  code           String?
  contactName    String?
  email          String?
  phone          String?
  address        String?
  city           String?
  state          String?
  pincode        String?
  gstin          String?
  pan            String?
  rating         Decimal?                @db.Decimal(3, 2)
  totalOrders    Int                     @default(0)
  onTimeDelivery Decimal?                @db.Decimal(5, 2)
  qualityScore   Decimal?                @db.Decimal(5, 2)
  paymentTerms   String?
  creditLimit    Decimal?                @db.Decimal(12, 2)
  status         String                  @default("ACTIVE")
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  materials      ManufacturingMaterial[]
  purchaseOrders PurchaseOrder[]         @relation("SupplierPurchaseOrders")
  tenant         Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([tenantId, status])
}

model ProductionSchedule {
  id                 String             @id @default(cuid())
  tenantId           String
  orderId            String
  scheduledStartDate DateTime
  scheduledEndDate   DateTime
  actualStartDate    DateTime?
  actualEndDate      DateTime?
  machineId          String?
  machineName        String?
  assignedWorkers    Json?
  status             String             @default("SCHEDULED")
  priority           String             @default("MEDIUM")
  notes              String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  order              ManufacturingOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  tenant             Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  machine            Machine?           @relation(fields: [machineId], references: [id])

  @@index([tenantId])
  @@index([tenantId, orderId])
  @@index([tenantId, scheduledStartDate])
  @@index([tenantId, status])
}

model Webhook {
  id              String    @id @default(cuid())
  tenantId        String
  url             String
  events          String[] // Array of event types
  secret          String
  isActive        Boolean   @default(true)
  description     String?
  lastTriggeredAt DateTime?
  failureCount    Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, isActive])
}

model Currency {
  id            String   @id @default(cuid())
  tenantId      String?
  code          String // ISO 4217 code (USD, INR, EUR, etc.)
  name          String
  symbol        String
  exchangeRate  Decimal  @db.Decimal(10, 4) // Rate to base currency (INR)
  isBase        Boolean  @default(false)
  isActive      Boolean  @default(true)
  decimalPlaces Int      @default(2)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([code])
}

model Workflow {
  id              String              @id @default(cuid())
  tenantId        String
  name            String
  description     String?
  triggerType     String // EVENT, SCHEDULE, MANUAL
  triggerEvent    String? // Event name (e.g., "contact.created")
  triggerSchedule String? // Cron expression
  isActive        Boolean             @default(true)
  isTemplate      Boolean             @default(false)
  steps           Json // Array of workflow steps
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  tenant          Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  executions      WorkflowExecution[]

  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, triggerType])
}

model WorkflowExecution {
  id          String    @id @default(cuid())
  workflowId  String
  status      String    @default("RUNNING") // RUNNING, COMPLETED, FAILED, CANCELLED
  triggerData Json? // Data that triggered the workflow
  result      Json? // Execution result
  error       String?
  startedAt   DateTime  @default(now())
  completedAt DateTime?
  tenantId    String
  workflow    Workflow  @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, workflowId])
  @@index([tenantId, status])
  @@index([startedAt])
}

model HelpCenterArticle {
  id              String                     @id @default(cuid())
  tenantId        String
  title           String
  content         String
  category        String?
  tags            String[]
  isPublished     Boolean                    @default(false)
  isPublic        Boolean                    @default(true) // Public-facing vs internal
  viewCount       Int                        @default(0)
  helpfulCount    Int                        @default(0)
  notHelpfulCount Int                        @default(0)
  authorId        String?
  createdAt       DateTime                   @default(now())
  updatedAt       DateTime                   @updatedAt
  tenant          Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  author          User?                      @relation("HelpCenterArticleAuthor", fields: [authorId], references: [id])
  versions        HelpCenterArticleVersion[]
  searchLogs      HelpCenterSearchLog[]

  @@index([tenantId])
  @@index([tenantId, isPublished])
  @@index([tenantId, isPublic])
  @@index([tenantId, category])
}

// Help Center Search Analytics
model HelpCenterSearchLog {
  id               String             @id @default(cuid())
  tenantId         String
  articleId        String?
  searchQuery      String
  resultsCount     Int
  clickedArticleId String?
  timestamp        DateTime           @default(now())
  tenant           Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  article          HelpCenterArticle? @relation(fields: [articleId], references: [id], onDelete: SetNull)

  @@index([tenantId])
  @@index([tenantId, timestamp])
  @@index([searchQuery])
}

// Help Center Article Version History
model HelpCenterArticleVersion {
  id        String            @id @default(cuid())
  articleId String
  title     String
  content   String
  version   Int
  authorId  String?
  createdAt DateTime          @default(now())
  article   HelpCenterArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@index([articleId, version])
}

model FSSAILicense {
  id                  String            @id @default(cuid())
  tenantId            String
  licenseNumber       String
  licenseType         String // BASIC, STATE, CENTRAL
  businessName        String
  businessAddress     String
  issueDate           DateTime
  expiryDate          DateTime
  status              String            @default("ACTIVE") // ACTIVE, EXPIRED, SUSPENDED, RENEWED
  renewalReminderSent Boolean           @default(false)
  documents           String[] // URLs to license documents
  notes               String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  tenant              Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  compliances         FSSAICompliance[]

  @@unique([tenantId, licenseNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, expiryDate])
}

model FSSAICompliance {
  id             String       @id @default(cuid())
  tenantId       String
  licenseId      String
  complianceType String // INSPECTION, RENEWAL, DOCUMENT_UPDATE, VIOLATION
  complianceDate DateTime
  description    String
  status         String       @default("PENDING") // PENDING, COMPLETED, OVERDUE
  dueDate        DateTime?
  completedDate  DateTime?
  documents      String[] // URLs to compliance documents
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  license        FSSAILicense @relation(fields: [licenseId], references: [id], onDelete: Cascade)
  tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, licenseId])
  @@index([tenantId, status])
  @@index([tenantId, complianceDate])
}

model ONDCIntegration {
  id             String        @id @default(cuid())
  tenantId       String
  sellerId       String // ONDC seller ID
  sellerAppId    String
  sellerAppKey   String
  networkId      String        @default("ONDC:RETail")
  isActive       Boolean       @default(false)
  isTestMode     Boolean       @default(true)
  lastSyncAt     DateTime?
  productsSynced Int           @default(0)
  ordersReceived Int           @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  tenant         Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  products       ONDCProduct[]
  orders         ONDCOrder[]

  @@unique([tenantId])
  @@index([tenantId])
}

model ONDCProduct {
  id            String          @id @default(cuid())
  tenantId      String
  integrationId String
  productId     String // PayAid product ID
  ondcProductId String? // ONDC product ID
  category      String
  price         Decimal         @db.Decimal(10, 2)
  isListed      Boolean         @default(false)
  syncedAt      DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  integration   ONDCIntegration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  tenant        Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, productId])
  @@index([tenantId])
  @@index([tenantId, integrationId])
}

model ONDCOrder {
  id            String          @id @default(cuid())
  tenantId      String
  integrationId String
  ondcOrderId   String // ONDC order ID
  orderId       String? // PayAid order ID (if created)
  status        String          @default("PENDING") // PENDING, ACCEPTED, REJECTED, CANCELLED, COMPLETED
  orderData     Json // Full ONDC order data
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  integration   ONDCIntegration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  tenant        Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, ondcOrderId])
  @@index([tenantId])
  @@index([tenantId, integrationId])
  @@index([tenantId, status])
}

model Machine {
  id                  String               @id @default(cuid())
  tenantId            String
  name                String
  code                String?
  machineType         String?
  capacityHoursPerDay Decimal?             @db.Decimal(5, 2)
  status              String               @default("ACTIVE")
  location            String?
  lastMaintenanceDate DateTime?
  nextMaintenanceDate DateTime?
  notes               String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  tenant              Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  schedules           ProductionSchedule[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([tenantId, status])
}

model Shift {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  startTime     String // HH:mm format
  endTime       String // HH:mm format
  breakDuration Int? // minutes
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId])
}

model InventoryLocation {
  id           String   @id @default(cuid())
  tenantId     String
  productId    String
  locationId   String
  quantity     Int      @default(0)
  reserved     Int      @default(0) // Reserved for orders
  reorderLevel Int?     @default(10)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  location     Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, productId, locationId])
  @@index([tenantId])
  @@index([tenantId, productId])
  @@index([tenantId, locationId])
}

model StockTransfer {
  id             String    @id @default(cuid())
  tenantId       String
  transferNumber String
  fromLocationId String
  toLocationId   String
  productId      String
  quantity       Int
  status         String    @default("PENDING") // PENDING, IN_TRANSIT, COMPLETED, CANCELLED
  transferDate   DateTime?
  receivedDate   DateTime?
  notes          String?
  createdById    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  fromLocation   Location  @relation("StockTransferFrom", fields: [fromLocationId], references: [id])
  toLocation     Location  @relation("StockTransferTo", fields: [toLocationId], references: [id])
  product        Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy      User?     @relation("StockTransferCreatedBy", fields: [createdById], references: [id])

  @@unique([tenantId, transferNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, fromLocationId])
  @@index([tenantId, toLocationId])
}

model BatchSerial {
  id                String    @id @default(cuid())
  tenantId          String
  productId         String
  batchNumber       String?
  serialNumber      String?
  locationId        String?
  quantity          Int       @default(1)
  expiryDate        DateTime?
  manufacturingDate DateTime?
  purchaseDate      DateTime?
  cost              Decimal?  @db.Decimal(10, 2)
  status            String    @default("AVAILABLE") // AVAILABLE, RESERVED, SOLD, EXPIRED
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  product           Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  location          Location? @relation(fields: [locationId], references: [id])
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, productId, serialNumber])
  @@index([tenantId])
  @@index([tenantId, productId])
  @@index([tenantId, batchNumber])
  @@index([tenantId, locationId])
}

model EmailBounce {
  id              String    @id @default(cuid())
  tenantId        String
  campaignId      String?
  emailAddress    String
  bounceType      String
  bounceReason    String?
  bounceCategory  String?
  messageId       String?
  isSuppressed    Boolean   @default(true)
  suppressedAt    DateTime  @default(now())
  suppressedUntil DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  campaign        Campaign? @relation(fields: [campaignId], references: [id])
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, emailAddress])
  @@index([tenantId])
  @@index([tenantId, bounceType])
  @@index([tenantId, isSuppressed])
}

model SMSTemplate {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  content     String
  description String?
  type        String   @default("GENERAL")
  variables   Json?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, isActive])
}

model SMSDeliveryReport {
  id             String    @id @default(cuid())
  tenantId       String
  contactId      String?
  campaignId     String?
  phoneNumber    String
  message        String
  messageId      String
  status         String    @default("PENDING")
  provider       String?
  providerStatus String?
  providerError  String?
  sentAt         DateTime?
  deliveredAt    DateTime?
  failedAt       DateTime?
  cost           Decimal?  @db.Decimal(10, 4)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  campaign       Campaign? @relation(fields: [campaignId], references: [id])
  contact        Contact?  @relation(fields: [contactId], references: [id])
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, messageId])
  @@index([tenantId, messageId])
  @@index([tenantId])
  @@index([tenantId, phoneNumber])
  @@index([tenantId, status])
  @@index([tenantId, provider])
  @@index([tenantId, createdAt])
  @@index([tenantId, campaignId])
}

model SMSOptOut {
  id           String   @id @default(cuid())
  tenantId     String
  phoneNumber  String
  reason       String?
  source       String?
  isSuppressed Boolean  @default(true)
  suppressedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, phoneNumber])
  @@index([tenantId])
  @@index([tenantId, isSuppressed])
}

model RealEstateProperty {
  id           String              @id @default(cuid())
  tenantId     String
  propertyName String
  propertyType String
  address      String
  city         String
  state        String
  pincode      String?
  totalArea    Decimal?            @db.Decimal(10, 2)
  builtUpArea  Decimal?            @db.Decimal(10, 2)
  bedrooms     Int?
  bathrooms    Int?
  price        Decimal             @db.Decimal(12, 2)
  status       String              @default("AVAILABLE")
  description  String?
  images       String[]
  floorPlan    String?
  virtualTour  String?
  amenities    String[]
  ownerId      String?
  customerId   String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  advances     RealEstateAdvance[]
  tenant       Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, propertyType])
  @@index([tenantId, status])
  @@index([tenantId, city])
}

model RealEstateAdvance {
  id              String             @id @default(cuid())
  tenantId        String
  propertyId      String
  customerId      String
  advanceAmount   Decimal            @db.Decimal(12, 2)
  totalAmount     Decimal            @db.Decimal(12, 2)
  remainingAmount Decimal            @db.Decimal(12, 2)
  paymentStatus   String             @default("PENDING")
  paymentTerms    String?
  dueDate         DateTime?
  paidAt          DateTime?
  receiptNumber   String?
  notes           String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  customer        Contact            @relation(fields: [customerId], references: [id])
  property        RealEstateProperty @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenant          Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, propertyId])
  @@index([tenantId, customerId])
  @@index([tenantId, paymentStatus])
}

model HealthcarePatient {
  id                    String                    @id @default(cuid())
  tenantId              String
  contactId             String?
  patientId             String
  fullName              String
  dateOfBirth           DateTime?
  gender                String?
  phone                 String?
  email                 String?
  address               String?
  bloodGroup            String?
  allergies             String[]
  medicalHistory        String?
  medications           String?
  emergencyContactName  String?
  emergencyContactPhone String?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  appointments          HealthcareAppointment[]
  prescriptions         HealthcarePrescription[]
  labTests              HealthcareLabTest[]
  medicalRecords        HealthcareMedicalRecord[]
  tenant                Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, patientId])
  @@index([tenantId])
  @@index([tenantId, phone])
  @@index([tenantId, email])
}

model HealthcareAppointment {
  id              String            @id @default(cuid())
  tenantId        String
  patientId       String
  appointmentDate DateTime
  appointmentTime String?
  duration        Int?
  doctorName      String?
  department      String?
  status          String            @default("SCHEDULED")
  appointmentType String?
  reason          String?
  notes           String?
  reminderSent    Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  completedAt     DateTime?
  patient         HealthcarePatient @relation(fields: [patientId], references: [id], onDelete: Cascade)
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, patientId])
  @@index([tenantId, appointmentDate])
  @@index([tenantId, status])
  @@index([appointmentDate, status])
}

model SocialMediaAccount {
  id                String          @id @default(cuid())
  tenantId          String
  platform          String
  accountName       String
  accountId         String?
  accessToken       String
  refreshToken      String?
  expiresAt         DateTime?
  isConnected       Boolean         @default(true)
  lastSyncAt        DateTime?
  followerCount     Int             @default(0)
  lastFollowerCount DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  scheduledPosts    ScheduledPost[]
  tenant            Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  posts             SocialPost[]

  @@unique([tenantId, platform, accountId])
  @@index([tenantId])
  @@index([tenantId, platform])
  @@index([tenantId, isConnected])
}

model SocialPost {
  id             String             @id @default(cuid())
  tenantId       String
  accountId      String
  content        String
  imageUrl       String?
  videoUrl       String?
  platform       String
  status         String             @default("DRAFT")
  scheduledAt    DateTime?
  publishedAt    DateTime?
  reach          Int                @default(0)
  impressions    Int                @default(0)
  engagement     Int                @default(0)
  likes          Int                @default(0)
  comments       Int                @default(0)
  shares         Int                @default(0)
  clicks         Int                @default(0)
  platformPostId String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  account        SocialMediaAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  tenant         Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, platform])
  @@index([tenantId, status])
  @@index([tenantId, accountId])
  @@index([accountId])
  @@index([status, scheduledAt])
}

model MediaLibrary {
  id             String   @id @default(cuid())
  tenantId       String
  fileName       String
  fileUrl        String
  fileSize       Int
  mimeType       String
  width          Int?
  height         Int?
  title          String?
  description    String?
  tags           String[]
  category       String?
  source         String?
  originalPrompt String?
  editHistory    Json?
  usageCount     Int      @default(0)
  uploadedById   String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploadedBy     User?    @relation("MediaUploads", fields: [uploadedById], references: [id])

  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, source])
  @@index([tenantId, createdAt])
  @@index([uploadedById])
}

model ScheduledPost {
  id           String             @id @default(cuid())
  tenantId     String
  accountId    String
  content      String
  imageUrl     String?
  videoUrl     String?
  platform     String
  scheduledAt  DateTime
  status       String             @default("SCHEDULED")
  createdBy    String?
  postedAt     DateTime?
  errorMessage String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  account      SocialMediaAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, platform])
  @@index([tenantId, status])
  @@index([tenantId, scheduledAt])
  @@index([accountId])
  @@index([status, scheduledAt])
}

model EmailAccount {
  id                  String                @id @default(cuid())
  tenantId            String
  userId              String
  email               String
  displayName         String?
  storageQuotaMB      Int                   @default(25000)
  storageUsedMB       Int                   @default(0)
  provider            String                @default("custom")
  providerAccountId   String?
  providerCredentials Json?
  password            String
  imapHost            String?
  smtpHost            String?
  imapPort            Int                   @default(993)
  smtpPort            Int                   @default(587)
  isActive            Boolean               @default(true)
  isLocked            Boolean               @default(false)
  settings            Json?
  lastLoginAt         DateTime?
  loginAttempts       Int                   @default(0)
  lastSyncAt          DateTime?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User                  @relation("EmailAccounts", fields: [userId], references: [id], onDelete: Cascade)
  autoReply           EmailAutoResponder[]
  contacts            EmailContact[]
  folders             EmailFolder[]
  forwarding          EmailForwardingRule[]
  messages            EmailMessage[]

  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([tenantId, userId])
  @@index([tenantId, isActive])
  @@index([email])
}

model EmailFolder {
  id           String         @id @default(cuid())
  accountId    String
  name         String
  type         String         @default("custom")
  unreadCount  Int            @default(0)
  totalCount   Int            @default(0)
  displayOrder Int            @default(0)
  isHidden     Boolean        @default(false)
  account      EmailAccount   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  messages     EmailMessage[]

  @@unique([accountId, name])
  @@index([accountId])
  @@index([accountId, type])
}

model EmailMessage {
  id          String            @id @default(cuid())
  accountId   String
  folderId    String
  messageId   String
  uid         Int?
  fromEmail   String
  fromName    String?
  toEmails    String[]
  ccEmails    String[]
  bccEmails   String[]
  subject     String
  body        String?
  htmlBody    String?
  isRead      Boolean           @default(false)
  isStarred   Boolean           @default(false)
  isSpam      Boolean           @default(false)
  isDraft     Boolean           @default(false)
  isArchived  Boolean           @default(false)
  threadId    String?
  inReplyTo   String?
  sentAt      DateTime?
  receivedAt  DateTime          @default(now())
  flags       String[]
  searchText  String?
  contactId   String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  attachments EmailAttachment[]
  account     EmailAccount      @relation(fields: [accountId], references: [id], onDelete: Cascade)
  contact     Contact?          @relation("EmailMessages", fields: [contactId], references: [id])
  folder      EmailFolder       @relation(fields: [folderId], references: [id], onDelete: Cascade)

  @@index([accountId, folderId, isRead])
  @@index([accountId, folderId, receivedAt])
  @@index([accountId, threadId])
  @@index([accountId, fromEmail])
  @@index([accountId, subject])
  @@index([contactId])
}

model EmailAttachment {
  id         String       @id @default(cuid())
  messageId  String
  fileName   String
  mimeType   String
  sizeBytes  Int
  storageUrl String
  localPath  String?
  scanStatus String       @default("pending")
  scanResult String?
  createdAt  DateTime     @default(now())
  message    EmailMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

model EmailContact {
  id          String       @id @default(cuid())
  accountId   String
  name        String?
  email       String
  frequency   Int          @default(1)
  lastContact DateTime     @default(now())
  contactId   String?
  account     EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  contact     Contact?     @relation("EmailContacts", fields: [contactId], references: [id])

  @@unique([accountId, email])
  @@index([accountId])
  @@index([contactId])
}

model EmailForwardingRule {
  id           String       @id @default(cuid())
  accountId    String
  matchPattern String?
  forwardTo    String[]
  isEnabled    Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  tenantId     String?
  account      EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  Tenant       Tenant?      @relation(fields: [tenantId], references: [id])

  @@index([accountId])
}

model EmailAutoResponder {
  id        String       @id @default(cuid())
  accountId String
  subject   String
  message   String
  isEnabled Boolean      @default(false)
  startDate DateTime
  endDate   DateTime?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  tenantId  String?
  account   EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  Tenant    Tenant?      @relation(fields: [tenantId], references: [id])

  @@index([accountId])
  @@index([accountId, isEnabled])
}

model ChatWorkspace {
  id            String             @id @default(cuid())
  tenantId      String             @unique
  name          String
  description   String?
  settings      Json?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  channels      ChatChannel[]
  conversations ChatConversation[]
  members       ChatMember[]
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model ChatChannel {
  id          String               @id @default(cuid())
  workspaceId String
  name        String
  description String?
  isPrivate   Boolean              @default(false)
  topic       String?
  purpose     String?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  workspace   ChatWorkspace        @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  members     ChatChannelMember[]
  messages    ChatChannelMessage[]

  @@unique([workspaceId, name])
  @@index([workspaceId])
  @@index([workspaceId, isPrivate])
}

model ChatChannelMember {
  id         String      @id @default(cuid())
  channelId  String
  memberId   String
  role       String      @default("member")
  joinedAt   DateTime    @default(now())
  lastReadAt DateTime?
  channel    ChatChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  member     ChatMember  @relation("ChannelMemberships", fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([channelId, memberId])
  @@index([channelId])
  @@index([memberId])
}

model ChatChannelMessage {
  id                  String                  @id @default(cuid())
  channelId           String
  senderId            String
  content             String
  threadParentId      String?
  isEdited            Boolean                 @default(false)
  editedAt            DateTime?
  mentionedContactIds String[]
  mentionedDealIds    String[]
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  channel             ChatChannel             @relation(fields: [channelId], references: [id], onDelete: Cascade)
  sender              ChatMember              @relation("ChannelMessages", fields: [senderId], references: [id], onDelete: Cascade)
  threadParent        ChatChannelMessage?     @relation("MessageThread", fields: [threadParentId], references: [id])
  threadMessages      ChatChannelMessage[]    @relation("MessageThread")
  attachments         ChatMessageAttachment[]
  reactions           ChatMessageReaction[]

  @@index([channelId, createdAt])
  @@index([channelId, senderId])
  @@index([threadParentId])
}

model ChatConversation {
  id           String                        @id @default(cuid())
  workspaceId  String
  name         String?
  isGroup      Boolean                       @default(false)
  createdAt    DateTime                      @default(now())
  updatedAt    DateTime                      @updatedAt
  workspace    ChatWorkspace                 @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  participants ChatConversationParticipant[]
  messages     ChatDirectMessage[]

  @@index([workspaceId])
}

model ChatConversationParticipant {
  id             String              @id @default(cuid())
  conversationId String
  memberId       String
  joinedAt       DateTime            @default(now())
  lastReadAt     DateTime?
  conversation   ChatConversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  member         ChatMember          @relation("ConversationParticipants", fields: [memberId], references: [id], onDelete: Cascade)
  directMessages ChatDirectMessage[]

  @@unique([conversationId, memberId])
  @@index([conversationId])
  @@index([memberId])
}

model ChatDirectMessage {
  id                  String                      @id @default(cuid())
  conversationId      String
  senderId            String
  content             String
  isEdited            Boolean                     @default(false)
  editedAt            DateTime?
  mentionedContactIds String[]
  mentionedDealIds    String[]
  createdAt           DateTime                    @default(now())
  updatedAt           DateTime                    @updatedAt
  conversation        ChatConversation            @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender              ChatConversationParticipant @relation(fields: [senderId], references: [id], onDelete: Cascade)
  attachments         ChatMessageAttachment[]
  reactions           ChatMessageReaction[]

  @@index([conversationId, createdAt])
  @@index([senderId])
}

model ChatMember {
  id                       String                        @id @default(cuid())
  workspaceId              String
  userId                   String
  displayName              String
  avatar                   String?
  status                   String                        @default("offline")
  lastSeen                 DateTime                      @default(now())
  channelMemberships       ChatChannelMember[]           @relation("ChannelMemberships")
  channelMessages          ChatChannelMessage[]          @relation("ChannelMessages")
  conversationParticipants ChatConversationParticipant[] @relation("ConversationParticipants")
  user                     User                          @relation("ChatMembers", fields: [userId], references: [id], onDelete: Cascade)
  workspace                ChatWorkspace                 @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, userId])
  @@index([workspaceId])
  @@index([workspaceId, status])
  @@index([userId])
}

model ChatMessageAttachment {
  id               String              @id @default(cuid())
  channelMessageId String?
  directMessageId  String?
  fileName         String
  fileUrl          String
  fileSize         Int
  mimeType         String
  uploadedAt       DateTime            @default(now())
  channelMessage   ChatChannelMessage? @relation(fields: [channelMessageId], references: [id], onDelete: Cascade)
  directMessage    ChatDirectMessage?  @relation(fields: [directMessageId], references: [id], onDelete: Cascade)

  @@index([channelMessageId])
  @@index([directMessageId])
}

model ChatMessageReaction {
  id               String              @id @default(cuid())
  channelMessageId String?
  directMessageId  String?
  userId           String
  emoji            String
  createdAt        DateTime            @default(now())
  channelMessage   ChatChannelMessage? @relation(fields: [channelMessageId], references: [id], onDelete: Cascade)
  directMessage    ChatDirectMessage?  @relation(fields: [directMessageId], references: [id], onDelete: Cascade)

  @@unique([channelMessageId, userId, emoji])
  @@unique([directMessageId, userId, emoji])
  @@index([channelMessageId])
  @@index([directMessageId])
}

model WhatsappAccount {
  id                String                 @id @default(cuid())
  tenantId          String
  deploymentType    String                 @default("payaid_hosted")
  paynaidInstanceId String?
  internalWahaUrl   String?
  internalApiKey    String?
  channelType       String                 @default("web")
  wahaBaseUrl       String?
  wahaApiKey        String?
  isWebConnected    Boolean                @default(false)
  wabaId            String?
  phoneNumberId     String?
  accessToken       String?
  metaAppId         String?
  metaAppSecret     String?
  isCloudConnected  Boolean                @default(false)
  businessName      String
  primaryPhone      String
  status            String                 @default("waiting_qr")
  errorMessage      String?
  isActive          Boolean                @default(true)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  tenant            Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  auditLogs         WhatsappAuditLog[]
  conversations     WhatsappConversation[]
  sessions          WhatsappSession[]
  templates         WhatsappTemplate[]

  @@index([tenantId])
  @@index([status])
  @@index([deploymentType])
}

model WhatsappSession {
  id                String                 @id @default(cuid())
  accountId         String
  employeeId        String?
  providerSessionId String?
  qrCodeUrl         String?
  status            String                 @default("pending_qr")
  deviceName        String?
  phoneNumber       String?
  lastSyncAt        DateTime?
  lastSeenAt        DateTime?
  dailySentCount    Int                    @default(0)
  dailyRecvCount    Int                    @default(0)
  dailyResetAt      DateTime?
  isActive          Boolean                @default(true)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  auditLogs         WhatsappAuditLog[]
  conversations     WhatsappConversation[]
  messages          WhatsappMessage[]
  account           WhatsappAccount        @relation(fields: [accountId], references: [id], onDelete: Cascade)
  employee          User?                  @relation(fields: [employeeId], references: [id])

  @@unique([accountId, providerSessionId])
  @@index([accountId])
  @@index([employeeId])
  @@index([status])
}

model WhatsappContactIdentity {
  id               String    @id @default(cuid())
  contactId        String
  whatsappNumber   String    @unique
  verified         Boolean   @default(false)
  verificationDate DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  contact          Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model WhatsappConversation {
  id            String            @id @default(cuid())
  accountId     String
  contactId     String
  sessionId     String?
  ticketId      String?
  status        String            @default("open")
  lastMessageAt DateTime?
  lastDirection String?
  unreadCount   Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  account       WhatsappAccount   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  contact       Contact           @relation(fields: [contactId], references: [id], onDelete: Cascade)
  session       WhatsappSession?  @relation(fields: [sessionId], references: [id])
  messages      WhatsappMessage[]

  @@unique([accountId, contactId])
  @@index([accountId])
  @@index([contactId])
  @@index([ticketId])
  @@index([status])
}

model WhatsappMessage {
  id                String               @id @default(cuid())
  conversationId    String
  sessionId         String?
  employeeId        String?
  direction         String
  messageType       String
  whatsappMessageId String?
  fromNumber        String
  toNumber          String
  text              String?
  mediaUrl          String?
  mediaMimeType     String?
  mediaCaption      String?
  templateId        String?
  status            String?
  errorCode         String?
  errorMessage      String?
  sentAt            DateTime?
  deliveredAt       DateTime?
  readAt            DateTime?
  createdAt         DateTime             @default(now())
  conversation      WhatsappConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  employee          User?                @relation(fields: [employeeId], references: [id])
  session           WhatsappSession?     @relation(fields: [sessionId], references: [id])
  template          WhatsappTemplate?    @relation(fields: [templateId], references: [id])

  @@index([conversationId])
  @@index([sessionId])
  @@index([employeeId])
  @@index([direction])
  @@index([messageType])
  @@index([status])
}

model WhatsappTemplate {
  id            String            @id @default(cuid())
  accountId     String
  name          String
  category      String
  languageCode  String
  bodyTemplate  String
  headerType    String?
  headerContent String?
  footerContent String?
  buttons       String?
  isMetaBacked  Boolean           @default(false)
  metaName      String?
  metaStatus    String?
  metaReason    String?
  createdById   String?
  isActive      Boolean           @default(true)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  messages      WhatsappMessage[]
  account       WhatsappAccount   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  createdBy     User?             @relation(fields: [createdById], references: [id])

  @@unique([accountId, name, languageCode])
  @@index([accountId])
  @@index([category])
}

model WhatsappAuditLog {
  id           String           @id @default(cuid())
  accountId    String
  sessionId    String?
  action       String
  description  String?
  status       String
  errorCode    String?
  errorMessage String?
  userId       String?
  details      String?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime         @default(now())
  account      WhatsappAccount  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  session      WhatsappSession? @relation(fields: [sessionId], references: [id])

  @@index([accountId])
  @@index([sessionId])
  @@index([action])
  @@index([status])
}

model Coupon {
  id                String   @id @default(cuid())
  code              String   @unique
  discountType      String
  discountValue     Float
  validFrom         DateTime
  validUntil        DateTime
  maxUses           Int?
  currentUses       Int      @default(0)
  applicableModules String[]
  minAmount         Float?
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([code])
  @@index([isActive])
  @@index([validFrom, validUntil])
}

model Vendor {
  id             String          @id @default(cuid())
  tenantId       String
  name           String
  companyName    String?
  email          String?
  phone          String?
  address        String?
  city           String?
  state          String?
  postalCode     String?
  country        String          @default("India")
  gstin          String?
  pan            String?
  paymentTerms   String?
  creditLimit    Decimal?        @db.Decimal(10, 2)
  rating         Decimal?        @db.Decimal(3, 2)
  ratingCount    Int             @default(0)
  status         String          @default("ACTIVE")
  notes          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  purchaseOrders PurchaseOrder[]
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ratings        VendorRating[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, gstin])
}

model PurchaseOrder {
  id                   String              @id @default(cuid())
  tenantId             String
  poNumber             String
  vendorId             String
  supplierId           String?
  status               String              @default("DRAFT")
  orderDate            DateTime            @default(now())
  expectedDeliveryDate DateTime?
  actualDeliveryDate   DateTime?
  subtotal             Decimal             @db.Decimal(10, 2)
  tax                  Decimal             @db.Decimal(10, 2)
  discount             Decimal             @default(0) @db.Decimal(10, 2)
  total                Decimal             @db.Decimal(10, 2)
  requestedById        String?
  approvedById         String?
  approvedAt           DateTime?
  rejectionReason      String?
  notes                String?
  termsAndConditions   String?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  goodsReceipts        GoodsReceipt[]
  approvedBy           User?               @relation("POApprovedBy", fields: [approvedById], references: [id])
  requestedBy          User?               @relation("PORequestedBy", fields: [requestedById], references: [id])
  supplier             Supplier?           @relation("SupplierPurchaseOrders", fields: [supplierId], references: [id])
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor               Vendor              @relation(fields: [vendorId], references: [id])
  items                PurchaseOrderItem[]

  @@unique([tenantId, poNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, vendorId])
  @@index([tenantId, orderDate])
}

model PurchaseOrderItem {
  id                String             @id @default(cuid())
  poId              String
  productId         String?
  productName       String
  description       String?
  quantity          Int
  unitPrice         Decimal            @db.Decimal(10, 2)
  taxRate           Decimal            @default(0) @db.Decimal(5, 2)
  taxAmount         Decimal            @default(0) @db.Decimal(10, 2)
  total             Decimal            @db.Decimal(10, 2)
  receivedQuantity  Int                @default(0)
  hsnCode           String?
  notes             String?
  createdAt         DateTime           @default(now())
  goodsReceiptItems GoodsReceiptItem[]
  purchaseOrder     PurchaseOrder      @relation(fields: [poId], references: [id], onDelete: Cascade)
  product           Product?           @relation("PurchaseOrderItems", fields: [productId], references: [id])

  @@index([poId])
  @@index([productId])
}

model GoodsReceipt {
  id            String             @id @default(cuid())
  tenantId      String
  grnNumber     String
  poId          String
  status        String             @default("PENDING")
  receivedDate  DateTime           @default(now())
  qualityStatus String?
  qualityNotes  String?
  receivedById  String?
  notes         String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  purchaseOrder PurchaseOrder      @relation(fields: [poId], references: [id])
  receivedBy    User?              @relation("GRReceivedBy", fields: [receivedById], references: [id])
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items         GoodsReceiptItem[]

  @@unique([tenantId, grnNumber])
  @@index([tenantId])
  @@index([tenantId, poId])
  @@index([tenantId, receivedDate])
}

model GoodsReceiptItem {
  id               String            @id @default(cuid())
  grnId            String
  poItemId         String
  receivedQuantity Int
  acceptedQuantity Int
  rejectedQuantity Int               @default(0)
  condition        String?
  notes            String?
  createdAt        DateTime          @default(now())
  goodsReceipt     GoodsReceipt      @relation(fields: [grnId], references: [id], onDelete: Cascade)
  poItem           PurchaseOrderItem @relation(fields: [poItemId], references: [id])

  @@index([grnId])
  @@index([poItemId])
}

model VendorRating {
  id                  String   @id @default(cuid())
  tenantId            String
  vendorId            String
  rating              Decimal  @db.Decimal(3, 2)
  qualityRating       Decimal? @db.Decimal(3, 2)
  deliveryRating      Decimal? @db.Decimal(3, 2)
  communicationRating Decimal? @db.Decimal(3, 2)
  pricingRating       Decimal? @db.Decimal(3, 2)
  comment             String?
  ratedById           String?
  createdAt           DateTime @default(now())
  ratedBy             User?    @relation("VendorRatings", fields: [ratedById], references: [id])
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor              Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, vendorId])
}

model Project {
  id              String          @id @default(cuid())
  tenantId        String
  name            String
  description     String?
  code            String?
  status          String          @default("PLANNING")
  startDate       DateTime?
  endDate         DateTime?
  actualStartDate DateTime?
  actualEndDate   DateTime?
  budget          Decimal?        @db.Decimal(10, 2)
  actualCost      Decimal         @default(0) @db.Decimal(10, 2)
  progress        Int             @default(0)
  priority        String          @default("MEDIUM")
  ownerId         String?
  clientId        String?
  tags            String[]
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  client          Contact?        @relation("ProjectClient", fields: [clientId], references: [id])
  owner           User?           @relation("ProjectOwner", fields: [ownerId], references: [id])
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  budgets         ProjectBudget[]
  members         ProjectMember[]
  tasks           ProjectTask[]
  timeEntries     TimeEntry[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, ownerId])
  @@index([tenantId, clientId])
  @@index([code])
}

model ProjectTask {
  id              String        @id @default(cuid())
  projectId       String
  name            String
  description     String?
  status          String        @default("TODO")
  priority        String        @default("MEDIUM")
  assignedToId    String?
  startDate       DateTime?
  dueDate         DateTime?
  completedAt     DateTime?
  dependsOnTaskId String?
  estimatedHours  Decimal?      @db.Decimal(10, 2)
  actualHours     Decimal       @default(0) @db.Decimal(10, 2)
  progress        Int           @default(0)
  tags            String[]
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  assignedTo      User?         @relation("AssignedProjectTasks", fields: [assignedToId], references: [id])
  dependsOnTask   ProjectTask?  @relation("TaskDependencies", fields: [dependsOnTaskId], references: [id])
  dependentTasks  ProjectTask[] @relation("TaskDependencies")
  project         Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  timeEntries     TimeEntry[]

  @@index([projectId])
  @@index([projectId, status])
  @@index([assignedToId])
  @@index([dependsOnTaskId])
}

model ProjectMember {
  id                   String   @id @default(cuid())
  projectId            String
  userId               String
  role                 String   @default("MEMBER")
  allocationPercentage Int      @default(100)
  joinedAt             DateTime @default(now())
  project              Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user                 User     @relation("ProjectMembers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
}

model TimeEntry {
  id          String       @id @default(cuid())
  projectId   String
  taskId      String?
  userId      String
  date        DateTime
  hours       Decimal      @db.Decimal(10, 2)
  description String?
  billable    Boolean      @default(false)
  billingRate Decimal?     @db.Decimal(10, 2)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  project     Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  task        ProjectTask? @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user        User         @relation("TimeEntries", fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, taskId])
  @@index([userId])
  @@index([date])
}

model ProjectBudget {
  id             String   @id @default(cuid())
  projectId      String
  category       String
  budgetedAmount Decimal  @db.Decimal(10, 2)
  actualAmount   Decimal  @default(0) @db.Decimal(10, 2)
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, category])
}

model Report {
  id             String               @id @default(cuid())
  tenantId       String
  name           String
  description    String?
  type           String
  config         Json
  templateId     String?
  scheduleConfig Json?
  lastRunAt      DateTime?
  nextRunAt      DateTime?
  createdById    String
  isPublic       Boolean              @default(false)
  isActive       Boolean              @default(true)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  createdBy      User                 @relation("ReportCreator", fields: [createdById], references: [id])
  template       ReportTemplate?      @relation(fields: [templateId], references: [id])
  tenant         Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  scheduledRuns  ScheduledReportRun[]

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, createdById])
  @@index([tenantId, isActive])
}

model ReportTemplate {
  id           String   @id @default(cuid())
  tenantId     String?
  name         String
  description  String?
  category     String
  config       Json
  previewImage String?
  isPublic     Boolean  @default(false)
  isSystem     Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  reports      Report[]
  tenant       Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([category])
  @@index([isPublic])
}

model ScheduledReportRun {
  id           String    @id @default(cuid())
  tenantId     String
  reportId     String
  status       String    @default("PENDING")
  startedAt    DateTime?
  completedAt  DateTime?
  errorMessage String?
  outputFormat String    @default("PDF")
  fileUrl      String?
  recipients   Json?
  createdAt    DateTime  @default(now())
  report       Report    @relation(fields: [reportId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, reportId])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
}

model NewsItem {
  id                 String    @id @default(cuid())
  tenantId           String?
  title              String
  summary            String?
  description        String?
  source             String
  category           String
  urgency            String    @default("informational")
  icon               String?
  industry           String?
  industryType       String?
  location           String?
  businessImpact     Json?
  recommendedActions Json?
  sourceUrl          String?
  sourceName         String?
  publishedAt        DateTime?
  expiresAt          DateTime?
  isRead             Boolean   @default(false)
  isDismissed        Boolean   @default(false)
  readAt             DateTime?
  dismissedAt        DateTime?
  tags               String[]  @default([])
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  tenant             Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, urgency])
  @@index([tenantId, industry])
  @@index([tenantId, isRead])
  @@index([tenantId, createdAt])
  @@index([industry])
  @@index([urgency])
  @@index([category])
  @@index([createdAt])
}

// Productivity Suite Models
model Spreadsheet {
  id            String                    @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  data          Json // Spreadsheet data (cells, formulas, formatting)
  settings      Json? // Chart settings, pivot tables, etc.
  version       Int                       @default(1)
  createdById   String?
  updatedById   String?
  createdAt     DateTime                  @default(now())
  updatedAt     DateTime                  @updatedAt
  tenant        Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy     User?                     @relation("SpreadsheetCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?                     @relation("SpreadsheetUpdatedBy", fields: [updatedById], references: [id])
  collaborators SpreadsheetCollaborator[]
  versions      SpreadsheetVersion[]

  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model SpreadsheetCollaborator {
  id            String      @id @default(cuid())
  spreadsheetId String
  userId        String
  role          String      @default("viewer") // viewer, editor, owner
  createdAt     DateTime    @default(now())
  spreadsheet   Spreadsheet @relation(fields: [spreadsheetId], references: [id], onDelete: Cascade)
  user          User        @relation("SpreadsheetCollaborations", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([spreadsheetId, userId])
  @@index([spreadsheetId])
  @@index([userId])
}

model SpreadsheetVersion {
  id            String      @id @default(cuid())
  spreadsheetId String
  version       Int
  data          Json
  createdById   String?
  createdAt     DateTime    @default(now())
  spreadsheet   Spreadsheet @relation(fields: [spreadsheetId], references: [id], onDelete: Cascade)
  createdBy     User?       @relation("SpreadsheetVersionCreatedBy", fields: [createdById], references: [id])

  @@index([spreadsheetId])
  @@index([spreadsheetId, version])
}

model Document {
  id            String                 @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  content       Json // Document content (Tiptap JSON)
  htmlContent   String? // HTML representation
  version       Int                    @default(1)
  templateId    String?
  createdById   String?
  updatedById   String?
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  tenant        Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy     User?                  @relation("DocumentCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?                  @relation("DocumentUpdatedBy", fields: [updatedById], references: [id])
  collaborators DocumentCollaborator[]
  versions      DocumentVersion[]

  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model DocumentCollaborator {
  id         String   @id @default(cuid())
  documentId String
  userId     String
  role       String   @default("viewer") // viewer, editor, commenter, owner
  createdAt  DateTime @default(now())
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  user       User     @relation("DocumentCollaborations", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([documentId, userId])
  @@index([documentId])
  @@index([userId])
}

model DocumentVersion {
  id          String   @id @default(cuid())
  documentId  String
  version     Int
  content     Json
  htmlContent String?
  createdById String?
  createdAt   DateTime @default(now())
  document    Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  createdBy   User?    @relation("DocumentVersionCreatedBy", fields: [createdById], references: [id])

  @@index([documentId])
  @@index([documentId, version])
}

model Contract {
  id                 String              @id @default(cuid())
  tenantId           String
  contractNumber     String
  title              String
  description        String?
  contractType       String // SERVICE, SALES, PURCHASE, EMPLOYMENT, NDA, etc.
  partyName          String // Other party name
  partyEmail         String?
  partyPhone         String?
  partyAddress       String?
  startDate          DateTime?
  endDate            DateTime?
  value              Decimal?            @db.Decimal(12, 2)
  currency           String              @default("INR")
  status             String              @default("DRAFT") // DRAFT, PENDING_APPROVAL, PENDING_SIGNATURE, ACTIVE, EXPIRED, TERMINATED, REJECTED
  requiresApproval   Boolean             @default(false)
  approvalWorkflow   Json? // Approval workflow configuration
  templateId         String?
  documentUrl        String?
  signedByParty      Boolean             @default(false)
  signedByUs         Boolean             @default(false)
  signedAt           DateTime?
  expiryReminderSent Boolean             @default(false)
  tags               String[]
  notes              String?
  createdById        String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  // CRM Enhancement: Link to deals, contacts, accounts
  dealId             String?
  contactId          String?
  accountId          String?
  autoRenew          Boolean             @default(false)
  renewalDate        DateTime?
  cancelledAt        DateTime?
  cancellationReason String?
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy          User?               @relation("ContractCreatedBy", fields: [createdById], references: [id])
  signatures         ContractSignature[]
  versions           ContractVersion[]
  approvals          ContractApproval[]
  deal               Deal?               @relation(fields: [dealId], references: [id], onDelete: SetNull)
  contact            Contact?            @relation(fields: [contactId], references: [id], onDelete: SetNull)
  account            Account?            @relation(fields: [accountId], references: [id], onDelete: SetNull)

  @@unique([tenantId, contractNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, contractType])
  @@index([tenantId, startDate])
  @@index([dealId])
  @@index([contactId])
  @@index([accountId])
  @@index([endDate])
  @@index([renewalDate])
}

model ContractApproval {
  id            String    @id @default(cuid())
  contractId    String
  approverId    String
  approverName  String
  approverEmail String
  approvalOrder Int // Order in approval chain (1, 2, 3, etc.)
  status        String    @default("PENDING") // PENDING, APPROVED, REJECTED
  comments      String?
  approvedAt    DateTime?
  rejectedAt    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  contract      Contract  @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@unique([contractId, approvalOrder, approverId])
  @@index([contractId])
  @@index([contractId, approvalOrder])
  @@index([approverId])
  @@index([status])
}

model ContractSignature {
  id              String    @id @default(cuid())
  contractId      String
  signerName      String
  signerEmail     String
  signerRole      String // PARTY, US, WITNESS
  signatureMethod String // MANUAL, DOCUSIGN, HELLOSIGN, E_MUDRA
  signatureUrl    String?
  signedAt        DateTime?
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime  @default(now())
  contract        Contract  @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@index([contractId])
  @@index([signerEmail])
}

model ContractVersion {
  id          String   @id @default(cuid())
  contractId  String
  version     Int
  content     Json // Contract content
  documentUrl String?
  changes     String? // Summary of changes
  createdById String?
  createdAt   DateTime @default(now())
  contract    Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  createdBy   User?    @relation("ContractVersionCreatedBy", fields: [createdById], references: [id])

  @@index([contractId])
  @@index([contractId, version])
}

model WorkOrder {
  id                    String           @id @default(cuid())
  tenantId              String
  workOrderNumber       String
  contactId             String?
  serviceType           String
  priority              String           @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  status                String           @default("SCHEDULED") // SCHEDULED, IN_PROGRESS, COMPLETED, CANCELLED
  scheduledDate         DateTime
  scheduledTime         String? // HH:mm format
  actualStartDate       DateTime?
  actualEndDate         DateTime?
  estimatedDuration     Int? // minutes
  actualDuration        Int? // minutes
  technicianId          String?
  location              String?
  latitude              Decimal?         @db.Decimal(10, 8)
  longitude             Decimal?         @db.Decimal(11, 8)
  customerNotes         String?
  technicianNotes       String?
  serviceHistory        String?
  totalCost             Decimal?         @db.Decimal(10, 2)
  createdById           String?
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  tenant                Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contact               Contact?         @relation(fields: [contactId], references: [id])
  technician            User?            @relation("WorkOrderTechnician", fields: [technicianId], references: [id])
  createdBy             User?            @relation("WorkOrderCreatedBy", fields: [createdById], references: [id])
  serviceHistoryRecords ServiceHistory[]

  @@unique([tenantId, workOrderNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, scheduledDate])
  @@index([tenantId, technicianId])
}

model ServiceHistory {
  id                String    @id @default(cuid())
  workOrderId       String
  serviceDate       DateTime
  serviceType       String
  description       String
  partsUsed         Json? // Array of parts with quantities
  laborHours        Decimal?  @db.Decimal(5, 2)
  cost              Decimal?  @db.Decimal(10, 2)
  technicianId      String?
  customerSignature String? // Base64 signature image
  photos            String[] // URLs to service photos
  notes             String?
  createdAt         DateTime  @default(now())
  workOrder         WorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)
  technician        User?     @relation("ServiceHistoryTechnician", fields: [technicianId], references: [id])

  @@index([workOrderId])
  @@index([serviceDate])
}

model DriveFile {
  id          String             @id @default(cuid())
  tenantId    String
  name        String
  fileName    String
  fileUrl     String
  fileSize    Int
  mimeType    String
  fileType    String // file, folder
  parentId    String? // For folder structure
  parent      DriveFile?         @relation("DriveFileParent", fields: [parentId], references: [id])
  children    DriveFile[]        @relation("DriveFileParent")
  version     Int                @default(1)
  isShared    Boolean            @default(false)
  sharedWith  Json? // Sharing permissions
  tags        String[]           @default([])
  createdById String?
  updatedById String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  tenant      Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy   User?              @relation("DriveFileCreatedBy", fields: [createdById], references: [id])
  updatedBy   User?              @relation("DriveFileUpdatedBy", fields: [updatedById], references: [id])
  versions    DriveFileVersion[]

  @@index([tenantId])
  @@index([tenantId, parentId])
  @@index([tenantId, fileType])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model DriveFileVersion {
  id          String    @id @default(cuid())
  fileId      String
  version     Int
  fileUrl     String
  fileSize    Int
  createdById String?
  createdAt   DateTime  @default(now())
  file        DriveFile @relation(fields: [fileId], references: [id], onDelete: Cascade)
  createdBy   User?     @relation("DriveFileVersionCreatedBy", fields: [createdById], references: [id])

  @@index([fileId])
  @@index([fileId, version])
}

model Presentation {
  id            String                     @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  slides        Json // Array of slide data
  theme         String                     @default("default")
  settings      Json? // Animation settings, etc.
  version       Int                        @default(1)
  createdById   String?
  updatedById   String?
  createdAt     DateTime                   @default(now())
  updatedAt     DateTime                   @updatedAt
  tenant        Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy     User?                      @relation("PresentationCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?                      @relation("PresentationUpdatedBy", fields: [updatedById], references: [id])
  collaborators PresentationCollaborator[]
  versions      PresentationVersion[]

  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([createdById])
}

model PresentationCollaborator {
  id             String       @id @default(cuid())
  presentationId String
  userId         String
  role           String       @default("viewer") // viewer, editor, owner
  createdAt      DateTime     @default(now())
  presentation   Presentation @relation(fields: [presentationId], references: [id], onDelete: Cascade)
  user           User         @relation("PresentationCollaborations", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([presentationId, userId])
  @@index([presentationId])
  @@index([userId])
}

model PresentationVersion {
  id             String       @id @default(cuid())
  presentationId String
  version        Int
  slides         Json
  createdById    String?
  createdAt      DateTime     @default(now())
  presentation   Presentation @relation(fields: [presentationId], references: [id], onDelete: Cascade)
  createdBy      User?        @relation("PresentationVersionCreatedBy", fields: [createdById], references: [id])

  @@index([presentationId])
  @@index([presentationId, version])
}

model Meeting {
  id           String    @id @default(cuid())
  tenantId     String
  title        String
  description  String?
  meetingCode  String    @unique // Unique meeting code for joining
  startTime    DateTime
  endTime      DateTime?
  status       String    @default("scheduled") // scheduled, in-progress, ended, cancelled
  hostId       String
  participants Json? // Array of participant IDs
  recordingUrl String?
  transcript   String?
  settings     Json? // Q&A, polling, etc.
  createdById  String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  host         User      @relation("MeetingHost", fields: [hostId], references: [id])
  createdBy    User?     @relation("MeetingCreatedBy", fields: [createdById], references: [id])

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, startTime])
  @@index([meetingCode])
  @@index([hostId])
}

// ============================================
// PHASE 1: CRITICAL GAPS - Industry Modules
// ============================================

// 1. HEALTHCARE & MEDICAL - Additional Models
model HealthcarePrescription {
  id               String            @id @default(cuid())
  tenantId         String
  patientId        String
  appointmentId    String?
  doctorName       String
  prescriptionDate DateTime          @default(now())
  medications      Json // Array of {name, dosage, frequency, duration}
  instructions     String?
  followUpDate     DateTime?
  status           String            @default("ACTIVE") // ACTIVE, COMPLETED, CANCELLED
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  patient          HealthcarePatient @relation(fields: [patientId], references: [id], onDelete: Cascade)
  tenant           Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, patientId])
  @@index([tenantId, prescriptionDate])
}

model HealthcareLabTest {
  id            String            @id @default(cuid())
  tenantId      String
  patientId     String
  appointmentId String?
  testName      String
  testType      String? // BLOOD, URINE, XRAY, etc.
  orderedDate   DateTime          @default(now())
  sampleDate    DateTime?
  resultDate    DateTime?
  results       Json? // Test results data
  status        String            @default("ORDERED") // ORDERED, SAMPLE_COLLECTED, COMPLETED, CANCELLED
  labName       String?
  notes         String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  patient       HealthcarePatient @relation(fields: [patientId], references: [id], onDelete: Cascade)
  tenant        Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, patientId])
  @@index([tenantId, status])
}

model HealthcareMedicalRecord {
  id          String            @id @default(cuid())
  tenantId    String
  patientId   String
  recordType  String // DIAGNOSIS, TREATMENT, SURGERY, VACCINATION, etc.
  recordDate  DateTime
  doctorName  String?
  department  String?
  diagnosis   String?
  treatment   String?
  notes       String?
  attachments String[] // File URLs
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  patient     HealthcarePatient @relation(fields: [patientId], references: [id], onDelete: Cascade)
  tenant      Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, patientId])
  @@index([tenantId, recordDate])
}

// 2. EDUCATION & TRAINING
model EducationStudent {
  id            String                @id @default(cuid())
  tenantId      String
  contactId     String?
  studentId     String // Unique student ID
  fullName      String
  dateOfBirth   DateTime?
  gender        String?
  phone         String?
  email         String?
  address       String?
  parentName    String?
  parentPhone   String?
  parentEmail   String?
  admissionDate DateTime?
  status        String                @default("ACTIVE") // ACTIVE, INACTIVE, GRADUATED, DROPPED
  notes         String?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  enrollments   EducationEnrollment[]
  attendance    EducationAttendance[]
  grades        EducationGrade[]
  fees          EducationFee[]
  tenant        Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, studentId])
  @@index([tenantId])
  @@index([tenantId, phone])
  @@index([tenantId, status])
}

model EducationCourse {
  id             String                @id @default(cuid())
  tenantId       String
  courseCode     String
  courseName     String
  description    String?
  category       String? // ACADEMIC, VOCATIONAL, SKILL, etc.
  duration       Int? // Duration in months
  fee            Decimal?              @db.Decimal(10, 2)
  maxStudents    Int?
  instructorName String?
  schedule       Json? // Class schedule
  status         String                @default("ACTIVE")
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  enrollments    EducationEnrollment[]
  tenant         Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, courseCode])
  @@index([tenantId])
  @@index([tenantId, status])
}

model EducationEnrollment {
  id             String           @id @default(cuid())
  tenantId       String
  studentId      String
  courseId       String
  enrollmentDate DateTime         @default(now())
  status         String           @default("ACTIVE") // ACTIVE, COMPLETED, DROPPED, SUSPENDED
  feePaid        Decimal?         @db.Decimal(10, 2)
  feeDue         Decimal?         @db.Decimal(10, 2)
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  student        EducationStudent @relation(fields: [studentId], references: [id], onDelete: Cascade)
  course         EducationCourse  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, studentId, courseId])
  @@index([tenantId])
  @@index([tenantId, studentId])
  @@index([tenantId, courseId])
  @@index([tenantId, status])
}

model EducationAttendance {
  id             String           @id @default(cuid())
  tenantId       String
  studentId      String
  courseId       String?
  attendanceDate DateTime
  status         String // PRESENT, ABSENT, LATE, EXCUSED
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  student        EducationStudent @relation(fields: [studentId], references: [id], onDelete: Cascade)
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, studentId])
  @@index([tenantId, attendanceDate])
}

model EducationGrade {
  id            String           @id @default(cuid())
  tenantId      String
  studentId     String
  courseId      String?
  examName      String
  examDate      DateTime?
  subject       String?
  marksObtained Decimal?         @db.Decimal(10, 2)
  maxMarks      Decimal?         @db.Decimal(10, 2)
  percentage    Decimal?         @db.Decimal(5, 2)
  grade         String? // A+, A, B+, B, etc.
  remarks       String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  student       EducationStudent @relation(fields: [studentId], references: [id], onDelete: Cascade)
  tenant        Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, studentId])
  @@index([tenantId, examDate])
}

model EducationFee {
  id            String           @id @default(cuid())
  tenantId      String
  studentId     String
  feeType       String // TUITION, EXAM, LIBRARY, TRANSPORT, etc.
  amount        Decimal          @db.Decimal(10, 2)
  dueDate       DateTime
  paidDate      DateTime?
  paymentMethod String?
  status        String           @default("PENDING") // PENDING, PAID, OVERDUE, WAIVED
  receiptNumber String?
  notes         String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  student       EducationStudent @relation(fields: [studentId], references: [id], onDelete: Cascade)
  tenant        Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, studentId])
  @@index([tenantId, status])
  @@index([tenantId, dueDate])
}

// 3. REAL ESTATE - Additional Models
model RealEstateLead {
  id           String                @id @default(cuid())
  tenantId     String
  contactId    String?
  leadType     String // BUYER, TENANT, SELLER, LESSOR
  propertyType String? // APARTMENT, VILLA, PLOT, COMMERCIAL
  budget       Decimal?              @db.Decimal(10, 2)
  location     String?
  requirements String?
  status       String                @default("NEW") // NEW, CONTACTED, QUALIFIED, CONVERTED, LOST
  source       String? // WEBSITE, REFERRAL, WALK_IN, etc.
  assignedTo   String?
  notes        String?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  siteVisits   RealEstateSiteVisit[]
  tenant       Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, leadType])
}

model RealEstateSiteVisit {
  id         String         @id @default(cuid())
  tenantId   String
  leadId     String
  propertyId String?
  visitDate  DateTime
  visitTime  String?
  status     String         @default("SCHEDULED") // SCHEDULED, COMPLETED, CANCELLED, NO_SHOW
  feedback   String?
  nextAction String?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  lead       RealEstateLead @relation(fields: [leadId], references: [id], onDelete: Cascade)
  tenant     Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, leadId])
  @@index([tenantId, visitDate])
}

model RealEstateDocument {
  id           String    @id @default(cuid())
  tenantId     String
  propertyId   String?
  leadId       String?
  documentType String // AGREEMENT, REGISTRATION, NOC, TITLE_DEED, etc.
  documentName String
  fileUrl      String
  expiryDate   DateTime?
  status       String    @default("ACTIVE") // ACTIVE, EXPIRED, RENEWED
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, propertyId])
  @@index([tenantId, documentType])
}

model RealEstateCommission {
  id               String    @id @default(cuid())
  tenantId         String
  propertyId       String?
  leadId           String?
  dealId           String? // Reference to deal/invoice
  commissionType   String // SALE, RENTAL, REFERRAL
  commissionRate   Decimal?  @db.Decimal(5, 2) // Percentage
  commissionAmount Decimal   @db.Decimal(10, 2)
  status           String    @default("PENDING") // PENDING, PAID, CANCELLED
  paidDate         DateTime?
  notes            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, paidDate])
}

model RealEstatePaymentMilestone {
  id            String    @id @default(cuid())
  tenantId      String
  propertyId    String?
  milestoneName String // BOOKING, FOUNDATION, PLINTH, etc.
  milestoneDate DateTime
  amount        Decimal   @db.Decimal(10, 2)
  status        String    @default("PENDING") // PENDING, PAID, OVERDUE
  paidDate      DateTime?
  invoiceId     String?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, propertyId])
  @@index([tenantId, status])
  @@index([tenantId, milestoneDate])
}

// 4. LOGISTICS & TRANSPORTATION
model LogisticsShipment {
  id              String                   @id @default(cuid())
  tenantId        String
  shipmentNumber  String
  orderId         String? // Reference to order
  customerName    String
  customerPhone   String?
  customerAddress String
  pickupAddress   String
  deliveryAddress String
  shipmentType    String // EXPRESS, STANDARD, FREIGHT
  weight          Decimal?                 @db.Decimal(10, 2) // kg
  volume          Decimal?                 @db.Decimal(10, 2) // cubic meters
  status          String                   @default("PENDING") // PENDING, PICKED_UP, IN_TRANSIT, DELIVERED, RETURNED
  vehicleId       String?
  driverId        String?
  routeId         String?
  pickupDate      DateTime?
  deliveryDate    DateTime?
  deliveryProof   String? // Photo/signature URL
  trackingNumber  String?
  charges         Decimal?                 @db.Decimal(10, 2)
  paymentStatus   String                   @default("PENDING")
  notes           String?
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime                 @updatedAt
  deliveries      LogisticsDeliveryProof[]
  tenant          Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, shipmentNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, trackingNumber])
}

model LogisticsRoute {
  id            String   @id @default(cuid())
  tenantId      String
  routeName     String
  routeCode     String
  startLocation String
  endLocation   String
  distance      Decimal? @db.Decimal(10, 2) // km
  estimatedTime Int? // minutes
  waypoints     Json? // Array of intermediate locations
  status        String   @default("ACTIVE")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, routeCode])
  @@index([tenantId])
}

model LogisticsVehicle {
  id                 String    @id @default(cuid())
  tenantId           String
  vehicleNumber      String
  vehicleType        String // TRUCK, VAN, BIKE, CAR
  make               String?
  model              String?
  year               Int?
  capacity           Decimal?  @db.Decimal(10, 2) // tons or cubic meters
  fuelType           String? // PETROL, DIESEL, ELECTRIC, CNG
  registrationExpiry DateTime?
  insuranceExpiry    DateTime?
  status             String    @default("ACTIVE") // ACTIVE, MAINTENANCE, RETIRED
  currentDriverId    String?
  notes              String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, vehicleNumber])
  @@index([tenantId])
  @@index([tenantId, status])
}

model LogisticsDriver {
  id            String    @id @default(cuid())
  tenantId      String
  employeeId    String? // Reference to HR employee
  driverName    String
  phone         String
  licenseNumber String
  licenseExpiry DateTime?
  address       String?
  status        String    @default("ACTIVE") // ACTIVE, ON_LEAVE, TERMINATED
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, licenseNumber])
  @@index([tenantId])
  @@index([tenantId, status])
}

model LogisticsDeliveryProof {
  id             String            @id @default(cuid())
  tenantId       String
  shipmentId     String
  proofType      String // SIGNATURE, PHOTO, OTP
  proofData      String // URL or data
  deliveredBy    String? // Driver name
  deliveredAt    DateTime          @default(now())
  recipientName  String?
  recipientPhone String?
  notes          String?
  createdAt      DateTime          @default(now())
  shipment       LogisticsShipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  tenant         Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, shipmentId])
  @@index([tenantId, deliveredAt])
}

model LogisticsFreight {
  id                String   @id @default(cuid())
  tenantId          String
  shipmentId        String?
  freightNumber     String
  customerName      String
  fromLocation      String
  toLocation        String
  weight            Decimal? @db.Decimal(10, 2)
  volume            Decimal? @db.Decimal(10, 2)
  baseRate          Decimal  @db.Decimal(10, 2)
  additionalCharges Decimal? @db.Decimal(10, 2)
  totalAmount       Decimal  @db.Decimal(10, 2)
  paymentStatus     String   @default("PENDING")
  invoiceId         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, freightNumber])
  @@index([tenantId])
  @@index([tenantId, paymentStatus])
}

// ============================================
// PHASE 2: HIGH VALUE
// ============================================

// 5. AGRICULTURE & FARMING
model AgricultureCrop {
  id                  String               @id @default(cuid())
  tenantId            String
  cropName            String
  cropType            String? // CEREAL, PULSE, VEGETABLE, FRUIT, etc.
  season              String? // KHARIF, RABI, SUMMER
  area                Decimal?             @db.Decimal(10, 2) // acres/hectares
  sowingDate          DateTime?
  expectedHarvestDate DateTime?
  status              String               @default("PLANNED") // PLANNED, SOWN, GROWING, HARVESTED
  notes               String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  harvests            AgricultureHarvest[]
  tenant              Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
}

model AgricultureInput {
  id           String    @id @default(cuid())
  tenantId     String
  inputType    String // SEED, FERTILIZER, PESTICIDE, EQUIPMENT
  inputName    String
  quantity     Decimal   @db.Decimal(10, 2)
  unit         String? // KG, LITERS, BAGS, etc.
  purchaseDate DateTime?
  expiryDate   DateTime?
  supplier     String?
  cost         Decimal?  @db.Decimal(10, 2)
  status       String    @default("IN_STOCK") // IN_STOCK, USED, EXPIRED
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, inputType])
  @@index([tenantId, status])
}

model AgricultureMandiPrice {
  id        String   @id @default(cuid())
  tenantId  String
  cropName  String
  mandiName String
  price     Decimal  @db.Decimal(10, 2) // per unit
  unit      String? // QUINTAL, KG, etc.
  date      DateTime @default(now())
  source    String? // APMC, PRIVATE, etc.
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, cropName])
  @@index([tenantId, date])
}

model AgricultureHarvest {
  id              String           @id @default(cuid())
  tenantId        String
  cropId          String?
  cropName        String
  harvestDate     DateTime         @default(now())
  quantity        Decimal          @db.Decimal(10, 2)
  unit            String? // QUINTAL, KG, etc.
  quality         String? // GRADE_A, GRADE_B, etc.
  soldQuantity    Decimal?         @db.Decimal(10, 2)
  salePrice       Decimal?         @db.Decimal(10, 2)
  storageLocation String?
  notes           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  crop            AgricultureCrop? @relation(fields: [cropId], references: [id], onDelete: Cascade)
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, cropId])
  @@index([tenantId, harvestDate])
}

model AgricultureFPO {
  id                 String   @id @default(cuid())
  tenantId           String
  fpoName            String
  registrationNumber String?
  memberCount        Int?
  crops              String[] // Crops handled
  services           String[] // Services provided
  contactPerson      String?
  phone              String?
  address            String?
  status             String   @default("ACTIVE")
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
}

// 6. CONSTRUCTION & CONTRACTING
model ConstructionProject {
  id              String                  @id @default(cuid())
  tenantId        String
  projectName     String
  projectType     String? // RESIDENTIAL, COMMERCIAL, INFRASTRUCTURE
  clientName      String
  clientPhone     String?
  location        String
  startDate       DateTime?
  expectedEndDate DateTime?
  actualEndDate   DateTime?
  budget          Decimal?                @db.Decimal(10, 2)
  status          String                  @default("PLANNING") // PLANNING, IN_PROGRESS, ON_HOLD, COMPLETED, CANCELLED
  projectManager  String?
  notes           String?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  materials       ConstructionMaterial[]
  milestones      ConstructionMilestone[]
  tenant          Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, startDate])
}

model ConstructionMaterial {
  id           String               @id @default(cuid())
  tenantId     String
  projectId    String?
  materialName String
  materialType String? // CEMENT, STEEL, BRICK, SAND, etc.
  quantity     Decimal              @db.Decimal(10, 2)
  unit         String? // BAGS, TONS, CUBIC_METERS, etc.
  purchaseDate DateTime?
  supplier     String?
  cost         Decimal?             @db.Decimal(10, 2)
  status       String               @default("ORDERED") // ORDERED, DELIVERED, USED
  notes        String?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  project      ConstructionProject? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant       Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, projectId])
  @@index([tenantId, status])
}

model ConstructionLabor {
  id         String   @id @default(cuid())
  tenantId   String
  projectId  String?
  employeeId String? // Reference to HR employee
  laborName  String
  phone      String?
  skillType  String? // MASON, CARPENTER, ELECTRICIAN, etc.
  dailyWage  Decimal? @db.Decimal(10, 2)
  workDays   Int?
  totalWage  Decimal? @db.Decimal(10, 2)
  status     String   @default("ACTIVE") // ACTIVE, COMPLETED, TERMINATED
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, projectId])
  @@index([tenantId, status])
}

model ConstructionMilestone {
  id                   String              @id @default(cuid())
  tenantId             String
  projectId            String
  milestoneName        String // FOUNDATION, PLINTH, FIRST_FLOOR, etc.
  plannedDate          DateTime
  actualDate           DateTime?
  completionPercentage Decimal?            @db.Decimal(5, 2)
  status               String              @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, DELAYED
  notes                String?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  project              ConstructionProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, projectId])
  @@index([tenantId, status])
  @@index([tenantId, plannedDate])
}

model ConstructionEquipment {
  id            String   @id @default(cuid())
  tenantId      String
  projectId     String?
  equipmentName String
  equipmentType String? // EXCAVATOR, CRANE, MIXER, etc.
  rentalOrOwned String? // RENTAL, OWNED
  dailyRate     Decimal? @db.Decimal(10, 2)
  rentalDays    Int?
  totalCost     Decimal? @db.Decimal(10, 2)
  supplier      String?
  status        String   @default("ACTIVE") // ACTIVE, RETURNED, MAINTENANCE
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, projectId])
  @@index([tenantId, status])
}

// 7. BEAUTY & WELLNESS
model BeautyAppointment {
  id              String         @id @default(cuid())
  tenantId        String
  customerId      String? // Reference to contact
  customerName    String
  customerPhone   String?
  serviceId       String?
  serviceName     String
  staffId         String? // Assigned staff
  appointmentDate DateTime
  appointmentTime String?
  duration        Int? // minutes
  status          String         @default("SCHEDULED") // SCHEDULED, CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED, NO_SHOW
  amount          Decimal?       @db.Decimal(10, 2)
  paymentStatus   String         @default("PENDING")
  notes           String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  service         BeautyService? @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  tenant          Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, appointmentDate])
  @@index([tenantId, status])
}

model BeautyService {
  id              String              @id @default(cuid())
  tenantId        String
  serviceName     String
  serviceCategory String? // HAIR, SKIN, NAIL, MASSAGE, etc.
  duration        Int? // minutes
  price           Decimal             @db.Decimal(10, 2)
  description     String?
  isActive        Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  appointments    BeautyAppointment[]
  tenant          Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, serviceCategory])
  @@index([tenantId, isActive])
}

model BeautyMembership {
  id             String   @id @default(cuid())
  tenantId       String
  customerId     String? // Reference to contact
  customerName   String
  membershipType String // MONTHLY, QUARTERLY, YEARLY
  startDate      DateTime @default(now())
  endDate        DateTime
  price          Decimal  @db.Decimal(10, 2)
  services       String[] // Included services
  status         String   @default("ACTIVE") // ACTIVE, EXPIRED, CANCELLED
  autoRenew      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, customerId])
  @@index([tenantId, status])
  @@index([tenantId, endDate])
}

model BeautyCustomerHistory {
  id           String   @id @default(cuid())
  tenantId     String
  customerId   String? // Reference to contact
  customerName String
  serviceName  String
  serviceDate  DateTime @default(now())
  staffName    String?
  amount       Decimal? @db.Decimal(10, 2)
  preferences  Json? // Customer preferences
  feedback     String?
  rating       Int? // 1-5
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, customerId])
  @@index([tenantId, serviceDate])
}

model BeautyStaffCommission {
  id               String    @id @default(cuid())
  tenantId         String
  staffId          String? // Reference to HR employee
  staffName        String
  appointmentId    String?
  serviceName      String
  serviceDate      DateTime
  serviceAmount    Decimal   @db.Decimal(10, 2)
  commissionRate   Decimal?  @db.Decimal(5, 2) // Percentage
  commissionAmount Decimal   @db.Decimal(10, 2)
  status           String    @default("PENDING") // PENDING, PAID
  paidDate         DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, staffId])
  @@index([tenantId, status])
  @@index([tenantId, serviceDate])
}

// 8. AUTOMOTIVE & REPAIR
model AutomotiveVehicle {
  id               String                     @id @default(cuid())
  tenantId         String
  customerId       String? // Reference to contact
  customerName     String
  vehicleNumber    String
  vehicleMake      String? // MARUTI, HYUNDAI, etc.
  vehicleModel     String?
  vehicleYear      Int?
  vehicleType      String? // CAR, BIKE, SCOOTER, etc.
  chassisNumber    String?
  engineNumber     String?
  color            String?
  registrationDate DateTime?
  insuranceExpiry  DateTime?
  lastServiceDate  DateTime?
  notes            String?
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt
  serviceHistory   AutomotiveServiceHistory[]
  jobCards         AutomotiveJobCard[]
  warranties       AutomotiveWarranty[]
  tenant           Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, vehicleNumber])
  @@index([tenantId])
  @@index([tenantId, customerId])
}

model AutomotiveJobCard {
  id              String            @id @default(cuid())
  tenantId        String
  vehicleId       String
  jobCardNumber   String
  customerName    String
  vehicleNumber   String
  serviceType     String // REGULAR, REPAIR, ACCIDENT, etc.
  issues          String? // Customer reported issues
  workDescription String?
  estimatedCost   Decimal?          @db.Decimal(10, 2)
  actualCost      Decimal?          @db.Decimal(10, 2)
  status          String            @default("OPEN") // OPEN, IN_PROGRESS, COMPLETED, DELIVERED, CANCELLED
  assignedTo      String? // Mechanic name
  startDate       DateTime?
  completionDate  DateTime?
  deliveryDate    DateTime?
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  vehicle         AutomotiveVehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, jobCardNumber])
  @@index([tenantId])
  @@index([tenantId, vehicleId])
  @@index([tenantId, status])
}

model AutomotiveServiceHistory {
  id              String            @id @default(cuid())
  tenantId        String
  vehicleId       String
  jobCardId       String?
  serviceDate     DateTime          @default(now())
  serviceType     String
  workDone        String?
  partsUsed       String[] // Part names
  laborCost       Decimal?          @db.Decimal(10, 2)
  partsCost       Decimal?          @db.Decimal(10, 2)
  totalCost       Decimal?          @db.Decimal(10, 2)
  nextServiceDate DateTime?
  mileage         Int?
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  vehicle         AutomotiveVehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, vehicleId])
  @@index([tenantId, serviceDate])
}

model AutomotiveSparePart {
  id            String   @id @default(cuid())
  tenantId      String
  partName      String
  partNumber    String?
  vehicleMake   String?
  vehicleModel  String?
  category      String? // ENGINE, BRAKE, SUSPENSION, etc.
  stockQuantity Int      @default(0)
  minStockLevel Int      @default(0)
  unitPrice     Decimal? @db.Decimal(10, 2)
  supplier      String?
  status        String   @default("ACTIVE")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, partNumber])
  @@index([tenantId, category])
}

model AutomotiveWarranty {
  id           String            @id @default(cuid())
  tenantId     String
  vehicleId    String
  warrantyType String // MANUFACTURER, EXTENDED, SERVICE
  startDate    DateTime
  endDate      DateTime
  coverage     String? // What's covered
  terms        String?
  status       String            @default("ACTIVE") // ACTIVE, EXPIRED, VOID
  notes        String?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  vehicle      AutomotiveVehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  tenant       Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, vehicleId])
  @@index([tenantId, status])
  @@index([tenantId, endDate])
}

// ============================================
// PHASE 3: MARKET EXPANSION
// ============================================

// 9. HOSPITALITY & HOTELS
model HospitalityRoom {
  id            String               @id @default(cuid())
  tenantId      String
  roomNumber    String
  roomType      String // SINGLE, DOUBLE, SUITE, etc.
  floor         String?
  capacity      Int                  @default(1)
  pricePerNight Decimal              @db.Decimal(10, 2)
  amenities     String[] // AC, TV, WIFI, etc.
  status        String               @default("AVAILABLE") // AVAILABLE, OCCUPIED, MAINTENANCE, OUT_OF_ORDER
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  bookings      HospitalityBooking[]
  tenant        Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, roomNumber])
  @@index([tenantId])
  @@index([tenantId, status])
}

model HospitalityBooking {
  id              String               @id @default(cuid())
  tenantId        String
  roomId          String
  guestId         String?
  guestName       String
  guestPhone      String?
  guestEmail      String?
  checkInDate     DateTime
  checkOutDate    DateTime
  numberOfGuests  Int                  @default(1)
  totalNights     Int?
  roomRate        Decimal              @db.Decimal(10, 2)
  totalAmount     Decimal?             @db.Decimal(10, 2)
  status          String               @default("CONFIRMED") // CONFIRMED, CHECKED_IN, CHECKED_OUT, CANCELLED
  paymentStatus   String               @default("PENDING")
  specialRequests String?
  notes           String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  room            HospitalityRoom      @relation(fields: [roomId], references: [id], onDelete: Cascade)
  checkIns        HospitalityCheckIn[]
  tenant          Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, roomId])
  @@index([tenantId, checkInDate])
  @@index([tenantId, status])
}

model HospitalityCheckIn {
  id            String             @id @default(cuid())
  tenantId      String
  bookingId     String
  checkInTime   DateTime           @default(now())
  checkOutTime  DateTime?
  actualGuests  Int?
  idProofType   String? // AADHAAR, PAN, PASSPORT, etc.
  idProofNumber String?
  paymentMethod String?
  finalAmount   Decimal?           @db.Decimal(10, 2)
  status        String             @default("CHECKED_IN") // CHECKED_IN, CHECKED_OUT
  notes         String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  booking       HospitalityBooking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, bookingId])
  @@index([tenantId, checkInTime])
}

model HospitalityHousekeeping {
  id            String    @id @default(cuid())
  tenantId      String
  roomId        String
  taskType      String // CLEANING, MAINTENANCE, INSPECTION
  assignedTo    String? // Staff name
  scheduledDate DateTime
  completedDate DateTime?
  status        String    @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, roomId])
  @@index([tenantId, status])
  @@index([tenantId, scheduledDate])
}

model HospitalityGuest {
  id            String    @id @default(cuid())
  tenantId      String
  contactId     String? // Reference to contact
  guestName     String
  phone         String?
  email         String?
  address       String?
  idProofType   String?
  idProofNumber String?
  preferences   Json? // Room preferences, etc.
  totalVisits   Int       @default(0)
  lastVisitDate DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, phone])
  @@index([tenantId, email])
}

// 10. LEGAL SERVICES
model LegalCase {
  id            String              @id @default(cuid())
  tenantId      String
  caseNumber    String
  clientId      String? // Reference to contact
  clientName    String
  caseTitle     String
  caseType      String? // CIVIL, CRIMINAL, CORPORATE, etc.
  courtName     String?
  filingDate    DateTime?
  status        String              @default("OPEN") // OPEN, IN_PROGRESS, CLOSED, WON, LOST
  assignedTo    String? // Advocate name
  description   String?
  notes         String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  courtDates    LegalCourtDate[]
  matters       LegalClientMatter[]
  documents     LegalDocument[]
  billableHours LegalBillableHour[]
  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, caseNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, clientId])
}

model LegalClientMatter {
  id          String     @id @default(cuid())
  tenantId    String
  caseId      String?
  clientId    String? // Reference to contact
  clientName  String
  matterTitle String
  matterType  String? // CONTRACT, LITIGATION, ADVISORY, etc.
  status      String     @default("ACTIVE") // ACTIVE, CLOSED
  description String?
  notes       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  case        LegalCase? @relation(fields: [caseId], references: [id], onDelete: Cascade)
  tenant      Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, caseId])
  @@index([tenantId, status])
}

model LegalCourtDate {
  id              String    @id @default(cuid())
  tenantId        String
  caseId          String
  courtName       String
  hearingDate     DateTime
  hearingTime     String?
  purpose         String? // HEARING, ARGUMENT, JUDGMENT, etc.
  status          String    @default("SCHEDULED") // SCHEDULED, COMPLETED, ADJOURNED, CANCELLED
  outcome         String?
  nextHearingDate DateTime?
  notes           String?
  reminderSent    Boolean   @default(false)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  case            LegalCase @relation(fields: [caseId], references: [id], onDelete: Cascade)
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, caseId])
  @@index([tenantId, hearingDate])
  @@index([tenantId, status])
}

model LegalDocument {
  id           String     @id @default(cuid())
  tenantId     String
  caseId       String?
  matterId     String?
  documentType String // PETITION, AFFIDAVIT, CONTRACT, etc.
  documentName String
  fileUrl      String
  uploadDate   DateTime   @default(now())
  expiryDate   DateTime?
  status       String     @default("ACTIVE") // ACTIVE, EXPIRED, ARCHIVED
  notes        String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  case         LegalCase? @relation(fields: [caseId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, caseId])
  @@index([tenantId, documentType])
}

model LegalBillableHour {
  id           String     @id @default(cuid())
  tenantId     String
  caseId       String?
  matterId     String?
  advocateName String
  date         DateTime   @default(now())
  hours        Decimal    @db.Decimal(5, 2)
  rate         Decimal?   @db.Decimal(10, 2)
  totalAmount  Decimal?   @db.Decimal(10, 2)
  description  String? // Work description
  status       String     @default("PENDING") // PENDING, BILLED, PAID
  invoiceId    String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  case         LegalCase? @relation(fields: [caseId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, caseId])
  @@index([tenantId, date])
  @@index([tenantId, status])
}

// 11. FINANCIAL SERVICES
model FinancialClient {
  id          String                @id @default(cuid())
  tenantId    String
  contactId   String? // Reference to contact
  clientName  String
  phone       String?
  email       String?
  clientType  String? // INDIVIDUAL, BUSINESS, HUF, etc.
  panNumber   String?
  gstin       String?
  services    String[] // TAX_FILING, AUDIT, ADVISORY, etc.
  status      String                @default("ACTIVE")
  notes       String?
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  taxFilings  FinancialTaxFiling[]
  compliances FinancialCompliance[]
  documents   FinancialDocument[]
  advisories  FinancialAdvisory[]
  tenant      Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, phone])
  @@index([tenantId, email])
  @@index([tenantId, status])
}

model FinancialTaxFiling {
  id                   String          @id @default(cuid())
  tenantId             String
  clientId             String
  financialYear        String // 2023-24, etc.
  assessmentYear       String // 2024-25, etc.
  filingType           String // ITR1, ITR2, ITR3, etc.
  filingDate           DateTime?
  dueDate              DateTime
  status               String          @default("PENDING") // PENDING, FILED, ASSESSED, REFUND_RECEIVED
  acknowledgmentNumber String?
  taxAmount            Decimal?        @db.Decimal(10, 2)
  refundAmount         Decimal?        @db.Decimal(10, 2)
  notes                String?
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  client               FinancialClient @relation(fields: [clientId], references: [id], onDelete: Cascade)
  tenant               Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, clientId])
  @@index([tenantId, financialYear])
  @@index([tenantId, status])
  @@index([tenantId, dueDate])
}

model FinancialCompliance {
  id             String           @id @default(cuid())
  tenantId       String
  clientId       String?
  complianceType String // GST_RETURN, TDS_RETURN, ROC_FILING, etc.
  period         String? // Month/Quarter
  dueDate        DateTime
  filingDate     DateTime?
  status         String           @default("PENDING") // PENDING, FILED, OVERDUE
  formNumber     String?
  notes          String?
  reminderSent   Boolean          @default(false)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  client         FinancialClient? @relation(fields: [clientId], references: [id], onDelete: Cascade)
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, clientId])
  @@index([tenantId, complianceType])
  @@index([tenantId, dueDate])
  @@index([tenantId, status])
}

model FinancialDocument {
  id            String           @id @default(cuid())
  tenantId      String
  clientId      String?
  documentType  String // ITR, FINANCIAL_STATEMENT, AUDIT_REPORT, etc.
  documentName  String
  fileUrl       String
  financialYear String?
  uploadDate    DateTime         @default(now())
  expiryDate    DateTime?
  status        String           @default("ACTIVE")
  notes         String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  client        FinancialClient? @relation(fields: [clientId], references: [id], onDelete: Cascade)
  tenant        Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, clientId])
  @@index([tenantId, documentType])
}

model FinancialAdvisory {
  id              String          @id @default(cuid())
  tenantId        String
  clientId        String
  advisoryType    String // TAX_PLANNING, INVESTMENT, BUSINESS, etc.
  advisoryDate    DateTime        @default(now())
  subject         String
  description     String?
  recommendations String?
  status          String          @default("ACTIVE") // ACTIVE, IMPLEMENTED, ARCHIVED
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  client          FinancialClient @relation(fields: [clientId], references: [id], onDelete: Cascade)
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, clientId])
  @@index([tenantId, advisoryDate])
}

// 12. EVENT MANAGEMENT (Different from marketing Event)
model EventManagementEvent {
  id             String           @id @default(cuid())
  tenantId       String
  eventName      String
  eventType      String? // WEDDING, CORPORATE, BIRTHDAY, etc.
  clientName     String
  clientPhone    String?
  eventDate      DateTime
  eventTime      String?
  venue          String?
  numberOfGuests Int?
  budget         Decimal?         @db.Decimal(10, 2)
  status         String           @default("PLANNING") // PLANNING, CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED
  eventManager   String?
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  vendors        EventVendor[]
  guests         EventGuest[]
  budgets        EventBudget[]
  checklists     EventChecklist[]
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, eventDate])
  @@index([tenantId, status])
}

model EventVendor {
  id            String                @id @default(cuid())
  tenantId      String
  eventId       String?
  vendorName    String
  vendorType    String // CATERING, DECORATION, PHOTOGRAPHY, etc.
  contactPerson String?
  phone         String?
  email         String?
  quoteAmount   Decimal?              @db.Decimal(10, 2)
  finalAmount   Decimal?              @db.Decimal(10, 2)
  status        String                @default("QUOTED") // QUOTED, CONFIRMED, PAID, CANCELLED
  notes         String?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  event         EventManagementEvent? @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant        Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, eventId])
  @@index([tenantId, vendorType])
  @@index([tenantId, status])
}

model EventGuest {
  id                  String               @id @default(cuid())
  tenantId            String
  eventId             String
  guestName           String
  phone               String?
  email               String?
  rsvpStatus          String               @default("PENDING") // PENDING, CONFIRMED, DECLINED
  dietaryRestrictions String?
  specialRequests     String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  event               EventManagementEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant              Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, eventId])
  @@index([tenantId, rsvpStatus])
}

model EventBudget {
  id            String               @id @default(cuid())
  tenantId      String
  eventId       String
  category      String // VENUE, CATERING, DECORATION, etc.
  itemName      String
  estimatedCost Decimal              @db.Decimal(10, 2)
  actualCost    Decimal?             @db.Decimal(10, 2)
  vendor        String?
  status        String               @default("PLANNED") // PLANNED, BOOKED, PAID
  notes         String?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  event         EventManagementEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant        Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, eventId])
  @@index([tenantId, category])
}

model EventChecklist {
  id            String               @id @default(cuid())
  tenantId      String
  eventId       String
  taskName      String
  taskCategory  String? // PRE_EVENT, DURING_EVENT, POST_EVENT
  assignedTo    String?
  dueDate       DateTime?
  status        String               @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED
  completedDate DateTime?
  notes         String?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  event         EventManagementEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant        Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, eventId])
  @@index([tenantId, status])
  @@index([tenantId, dueDate])
}

// 13. WHOLESALE & DISTRIBUTION
model WholesaleCustomer {
  id           String                 @id @default(cuid())
  tenantId     String
  contactId    String? // Reference to contact
  customerName String
  customerType String // WHOLESALER, DISTRIBUTOR, STOCKIST, RETAILER
  phone        String?
  email        String?
  address      String?
  gstin        String?
  creditLimit  Decimal?               @db.Decimal(10, 2)
  paymentTerms String? // COD, NET_15, NET_30, etc.
  status       String                 @default("ACTIVE")
  notes        String?
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  pricings     WholesalePricing[]
  creditLimits WholesaleCreditLimit[]
  tenant       Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, customerType])
  @@index([tenantId, status])
}

model WholesalePricing {
  id            String             @id @default(cuid())
  tenantId      String
  productId     String? // Reference to product
  customerId    String?
  customerType  String // WHOLESALER, DISTRIBUTOR, RETAILER
  priceLevel    String // LEVEL_1, LEVEL_2, LEVEL_3
  price         Decimal            @db.Decimal(10, 2)
  minQuantity   Int? // Minimum quantity for this price
  effectiveFrom DateTime           @default(now())
  effectiveTo   DateTime?
  status        String             @default("ACTIVE")
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  customer      WholesaleCustomer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, productId])
  @@index([tenantId, customerId])
  @@index([tenantId, customerType])
}

model WholesaleCreditLimit {
  id              String            @id @default(cuid())
  tenantId        String
  customerId      String
  creditLimit     Decimal           @db.Decimal(10, 2)
  currentBalance  Decimal?          @db.Decimal(10, 2)
  availableCredit Decimal?          @db.Decimal(10, 2)
  paymentTerms    String? // NET_15, NET_30, etc.
  status          String            @default("ACTIVE") // ACTIVE, SUSPENDED, EXCEEDED
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  customer        WholesaleCustomer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, customerId])
  @@index([tenantId, status])
}

model WholesaleRoute {
  id           String   @id @default(cuid())
  tenantId     String
  routeName    String
  routeCode    String
  salesRepId   String? // Reference to employee
  salesRepName String
  area         String?
  customers    String[] // Customer IDs or names
  frequency    String? // DAILY, WEEKLY, BIWEEKLY
  status       String   @default("ACTIVE")
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, routeCode])
  @@index([tenantId])
  @@index([tenantId, salesRepId])
}

model WholesaleStockTransfer {
  id           String    @id @default(cuid())
  tenantId     String
  productId    String? // Reference to product
  fromLocation String
  toLocation   String
  quantity     Decimal   @db.Decimal(10, 2)
  transferDate DateTime  @default(now())
  reason       String? // STOCK_BALANCING, DEMAND, etc.
  status       String    @default("PENDING") // PENDING, IN_TRANSIT, COMPLETED, CANCELLED
  receivedDate DateTime?
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, productId])
  @@index([tenantId, fromLocation])
  @@index([tenantId, toLocation])
  @@index([tenantId, status])
}

// Business Unit Model - For multi-industry, multi-line businesses
model BusinessUnit {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  location      String?
  industryPacks Json // Array of industry pack IDs (e.g., ["manufacturing", "retail"])
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, isActive])
}

// Module License Model - Tracks which modules are enabled for each tenant
model ModuleLicense {
  id          String    @id @default(cuid())
  tenantId    String
  moduleId    String // e.g., "crm", "manufacturing", "retail"
  isActive    Boolean   @default(true)
  activatedAt DateTime  @default(now())
  expiresAt   DateTime?
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, moduleId])
  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([moduleId])
}

// API Usage Log - Tracks API calls for analytics
model ApiUsageLog {
  id           String   @id @default(cuid())
  tenantId     String?
  apiKeyId     String?
  endpoint     String
  method       String // GET, POST, PUT, DELETE, etc.
  statusCode   Int
  responseTime Int // in milliseconds
  timestamp    DateTime @default(now())
  tenant       Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  apiKey       ApiKey?  @relation(fields: [apiKeyId], references: [id], onDelete: SetNull)

  @@index([tenantId])
  @@index([apiKeyId])
  @@index([timestamp])
  @@index([tenantId, timestamp])
  @@index([endpoint])
}

// Phase 3: Manufacturing BOM
model ManufacturingBOM {
  id          String   @id @default(cuid())
  tenantId    String
  bomNumber   String
  productName String
  productSku  String?
  version     String   @default("1.0")
  isActive    Boolean  @default(true)
  items       Json // Array of BOM items with material, quantity, unit
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, bomNumber])
  @@index([tenantId])
  @@index([tenantId, isActive])
}

// Phase 3: Manufacturing Quality Control
model ManufacturingQualityControl {
  id             String   @id @default(cuid())
  tenantId       String
  orderId        String? // Link to ManufacturingOrder
  inspectionType String // INCOMING, IN_PROCESS, FINAL
  inspectorName  String
  inspectionDate DateTime
  passed         Boolean
  defects        Json? // Array of defects found
  notes          String?
  createdAt      DateTime @default(now())
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([orderId])
  @@index([inspectionDate])
}

// Phase 3: Asset Depreciation
model AssetDepreciation {
  id                 String   @id @default(cuid())
  assetId            String
  period             DateTime // Month/Year
  openingValue       Decimal  @db.Decimal(12, 2)
  depreciationAmount Decimal  @db.Decimal(12, 2)
  closingValue       Decimal  @db.Decimal(12, 2)
  createdAt          DateTime @default(now())
  asset              Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@unique([assetId, period])
  @@index([assetId])
  @@index([period])
}

// Phase 4: Compliance & Legal
model ComplianceRecord {
  id             String    @id @default(cuid())
  tenantId       String
  complianceType String // GDPR, DATA_PRIVACY, LEGAL, AUDIT
  title          String
  description    String?
  status         String    @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, OVERDUE
  dueDate        DateTime?
  completedDate  DateTime?
  assignedTo     String?
  documents      String[] // URLs
  notes          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, complianceType])
  @@index([tenantId, status])
  @@index([dueDate])
}

// Phase 4: Learning Management System
model LMSCourse {
  id          String          @id @default(cuid())
  tenantId    String
  title       String
  description String?
  category    String?
  duration    Int? // in hours
  isPublished Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  tenant      Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  enrollments LMSEnrollment[]
  modules     LMSModule[]

  @@index([tenantId])
  @@index([tenantId, isPublished])
}

model LMSModule {
  id        String    @id @default(cuid())
  courseId  String
  title     String
  content   String? // HTML or markdown
  order     Int
  duration  Int? // in minutes
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  course    LMSCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
}

model LMSEnrollment {
  id             String    @id @default(cuid())
  courseId       String
  employeeId     String
  progress       Int       @default(0) // percentage
  status         String    @default("ENROLLED") // ENROLLED, IN_PROGRESS, COMPLETED, CERTIFIED
  enrolledAt     DateTime  @default(now())
  completedAt    DateTime?
  certificateUrl String?
  course         LMSCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, employeeId])
  @@index([courseId])
  @@index([employeeId])
  @@index([status])
}

// Phase 3: E-commerce Store
model EcommerceStore {
  id           String             @id @default(cuid())
  tenantId     String
  name         String
  domain       String?            @unique
  subdomain    String?            @unique
  theme        String             @default("default")
  logo         String?
  favicon      String?
  primaryColor String?            @default("#3B82F6")
  isActive     Boolean            @default(true)
  settings     Json? // Store settings
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  products     EcommerceProduct[]
  orders       EcommerceOrder[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([domain])
  @@index([subdomain])
}

// Phase 3: E-commerce Product
model EcommerceProduct {
  id                String               @id @default(cuid())
  storeId           String
  tenantId          String
  sku               String
  name              String
  description       String?
  shortDescription  String?
  price             Decimal              @db.Decimal(10, 2)
  compareAtPrice    Decimal?             @db.Decimal(10, 2)
  costPrice         Decimal?             @db.Decimal(10, 2)
  inventoryQuantity Int                  @default(0)
  trackInventory    Boolean              @default(true)
  weight            Decimal?             @db.Decimal(10, 2)
  images            String[]
  category          String?
  tags              String[]
  isActive          Boolean              @default(true)
  isDigital         Boolean              @default(false)
  seoTitle          String?
  seoDescription    String?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  store             EcommerceStore       @relation(fields: [storeId], references: [id], onDelete: Cascade)
  orderItems        EcommerceOrderItem[]

  @@unique([storeId, sku])
  @@index([storeId])
  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isActive])
}

// Phase 3: E-commerce Order
model EcommerceOrder {
  id              String               @id @default(cuid())
  storeId         String
  tenantId        String
  orderNumber     String
  customerEmail   String
  customerName    String?
  customerPhone   String?
  shippingAddress Json? // Full address object
  billingAddress  Json?
  status          String               @default("PENDING") // PENDING, CONFIRMED, PROCESSING, SHIPPED, DELIVERED, CANCELLED, REFUNDED
  paymentStatus   String               @default("PENDING") // PENDING, PAID, FAILED, REFUNDED
  paymentMethod   String? // PayAid Payments, COD, etc.
  subtotal        Decimal              @db.Decimal(10, 2)
  tax             Decimal              @db.Decimal(10, 2)
  shipping        Decimal              @db.Decimal(10, 2)
  discount        Decimal              @default(0) @db.Decimal(10, 2)
  total           Decimal              @db.Decimal(10, 2)
  currency        String               @default("INR")
  shippingMethod  String?
  trackingNumber  String?
  notes           String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  store           EcommerceStore       @relation(fields: [storeId], references: [id], onDelete: Cascade)
  items           EcommerceOrderItem[]

  @@unique([storeId, orderNumber])
  @@index([storeId])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, paymentStatus])
  @@index([customerEmail])
}

// Phase 3: E-commerce Order Item
model EcommerceOrderItem {
  id          String            @id @default(cuid())
  orderId     String
  productId   String?
  productName String
  productSku  String?
  quantity    Int
  unitPrice   Decimal           @db.Decimal(10, 2)
  totalPrice  Decimal           @db.Decimal(10, 2)
  order       EcommerceOrder    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     EcommerceProduct? @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@index([orderId])
  @@index([productId])
}

// Competitor Intelligence Models
model Competitor {
  id                      String               @id @default(cuid())
  tenantId                String
  name                    String
  website                 String?
  industry                String?
  description             String?
  isActive                Boolean              @default(true)
  monitoringEnabled       Boolean              @default(true)
  priceTrackingEnabled    Boolean              @default(false)
  locationTrackingEnabled Boolean              @default(false)
  createdAt               DateTime             @default(now())
  updatedAt               DateTime             @updatedAt
  tenant                  Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  prices                  CompetitorPrice[]
  locations               CompetitorLocation[]
  alerts                  CompetitorAlert[]

  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, monitoringEnabled])
}

model CompetitorPrice {
  id            String     @id @default(cuid())
  competitorId  String
  productName   String
  productSku    String?
  price         Decimal    @db.Decimal(10, 2)
  currency      String     @default("INR")
  source        String? // website, api, manual
  url           String?
  lastCheckedAt DateTime   @default(now())
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  competitor    Competitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([competitorId])
  @@index([competitorId, productSku])
  @@index([lastCheckedAt])
}

model CompetitorLocation {
  id            String     @id @default(cuid())
  competitorId  String
  name          String
  address       String
  city          String?
  state         String?
  postalCode    String?
  country       String?    @default("India")
  latitude      Decimal?   @db.Decimal(10, 8)
  longitude     Decimal?   @db.Decimal(11, 8)
  phone         String?
  email         String?
  isActive      Boolean    @default(true)
  discoveredAt  DateTime   @default(now())
  lastCheckedAt DateTime   @default(now())
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  competitor    Competitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([competitorId])
  @@index([competitorId, isActive])
  @@index([latitude, longitude])
}

model CompetitorAlert {
  id           String     @id @default(cuid())
  competitorId String
  type         String // PRICE_CHANGE, NEW_LOCATION, LOCATION_CLOSED, PRICE_DROP, PRICE_INCREASE
  title        String
  message      String
  severity     String     @default("INFO") // INFO, WARNING, CRITICAL
  isRead       Boolean    @default(false)
  metadata     Json? // Additional data (oldPrice, newPrice, location, etc.)
  createdAt    DateTime   @default(now())
  competitor   Competitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([competitorId])
  @@index([competitorId, isRead])
  @@index([competitorId, type])
  @@index([createdAt])
}

// Mobile Location Tracking
model LocationTracking {
  id        String   @id @default(cuid())
  tenantId  String
  userId    String
  latitude  Decimal  @db.Decimal(10, 8)
  longitude Decimal  @db.Decimal(11, 8)
  accuracy  Decimal? @db.Decimal(10, 2)
  timestamp DateTime @default(now())
  createdAt DateTime @default(now())
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([timestamp])
}

// Developer Marketplace
model MarketplaceApp {
  id            String                       @id @default(cuid())
  name          String
  description   String
  category      String
  icon          String?
  developer     String
  rating        Decimal?                     @db.Decimal(3, 2)
  installs      Int                          @default(0)
  pricing       String                       @default("Free")
  isActive      Boolean                      @default(true)
  createdAt     DateTime                     @default(now())
  updatedAt     DateTime                     @updatedAt
  installations MarketplaceAppInstallation[]

  @@index([category])
  @@index([isActive])
}

model MarketplaceAppInstallation {
  id          String         @id @default(cuid())
  tenantId    String
  appId       String
  status      String         @default("active")
  config      Json?
  installedAt DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  tenant      Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  app         MarketplaceApp @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@unique([tenantId, appId])
  @@index([tenantId])
  @@index([appId])
}

// Data Governance
model DataGovernancePolicy {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  description String?
  type        String // RETENTION, BACKUP, ENCRYPTION, ACCESS_CONTROL
  config      Json
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, type])
}

model DataRetentionLog {
  id          String   @id @default(cuid())
  tenantId    String
  entityType  String // CONTACT, DEAL, INVOICE, etc.
  entityId    String
  action      String // DELETED, ARCHIVED, EXPORTED
  reason      String?
  performedBy String
  performedAt DateTime @default(now())
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, entityType])
  @@index([performedAt])
}

// General Appointments Module (Core - Available to All Industries)
model Appointment {
  id                 String                @id @default(cuid())
  tenantId           String
  contactId          String? // Link to CRM Contact
  contactName        String
  contactEmail       String?
  contactPhone       String?
  serviceId          String?
  serviceName        String?
  assignedToId       String? // Staff/User assigned
  assignedToName     String?
  appointmentDate    DateTime
  startTime          String // HH:mm format
  endTime            String? // HH:mm format
  duration           Int? // minutes
  status             String                @default("SCHEDULED") // SCHEDULED, CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED, NO_SHOW
  type               String? // CONSULTATION, FOLLOW_UP, SERVICE, MEETING, etc.
  location           String? // Physical location or video link
  isOnline           Boolean               @default(false)
  meetingLink        String? // Video meeting URL
  notes              String?
  internalNotes      String? // Private notes for staff
  amount             Decimal?              @db.Decimal(10, 2)
  paymentStatus      String                @default("PENDING") // PENDING, PAID, PARTIAL, REFUNDED
  reminderSent       Boolean               @default(false)
  reminderSentAt     DateTime?
  cancelledAt        DateTime?
  cancellationReason String?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  tenant             Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  service            AppointmentService?   @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  reminders          AppointmentReminder[]

  @@index([tenantId])
  @@index([tenantId, appointmentDate])
  @@index([tenantId, status])
  @@index([tenantId, contactId])
  @@index([tenantId, assignedToId])
  @@index([appointmentDate, status])
}

model AppointmentService {
  id           String        @id @default(cuid())
  tenantId     String
  name         String
  description  String?
  category     String? // CONSULTATION, SERVICE, FOLLOW_UP, etc.
  duration     Int // minutes
  price        Decimal?      @db.Decimal(10, 2)
  isActive     Boolean       @default(true)
  color        String? // For calendar display
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  tenant       Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  appointments Appointment[]

  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, category])
}

model AppointmentReminder {
  id            String      @id @default(cuid())
  appointmentId String
  type          String // EMAIL, SMS, WHATSAPP, PUSH
  scheduledAt   DateTime // When to send reminder
  sentAt        DateTime?
  status        String      @default("PENDING") // PENDING, SENT, FAILED, CANCELLED
  message       String?
  error         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  tenant        Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId      String

  @@index([appointmentId])
  @@index([tenantId])
  @@index([scheduledAt, status])
  @@index([status])
}

// AI Influencer Marketing Models
model AIInfluencerCampaign {
  id         String                  @id @default(cuid())
  tenantId   String
  name       String?
  industry   String?
  createdAt  DateTime                @default(now())
  updatedAt  DateTime                @updatedAt
  tenant     Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  characters AIInfluencerCharacter[]
  scripts    AIInfluencerScript[]
  videos     AIInfluencerVideo[]

  @@index([tenantId])
  @@index([tenantId, createdAt])
}

model AIInfluencerCharacter {
  id              String                @id @default(cuid())
  tenantId        String
  campaignId      String?
  name            String?
  industry        String?
  gender          String?
  ageRange        String?
  imageUrl        String // PayAid Drive file URL
  driveFileId     String? // Reference to DriveFile
  generatedPrompt String?               @db.Text
  usageCount      Int                   @default(0)
  createdAt       DateTime              @default(now())
  tenant          Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  campaign        AIInfluencerCampaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  videos          AIInfluencerVideo[]

  @@index([tenantId])
  @@index([tenantId, industry])
  @@index([campaignId])
}

model AIInfluencerScript {
  id                String               @id @default(cuid())
  tenantId          String
  campaignId        String
  productName       String?
  tone              String? // casual, professional, funny
  variations        Json? // [{type, text, duration}, ...]
  selectedVariation Int?
  createdAt         DateTime             @default(now())
  tenant            Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  campaign          AIInfluencerCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  videos            AIInfluencerVideo[]

  @@index([tenantId])
  @@index([campaignId])
}

model AIInfluencerVideo {
  id           String                  @id @default(cuid())
  tenantId     String
  campaignId   String
  characterId  String
  scriptId     String
  videoUrl     String? // PayAid Drive file URL
  driveFileId  String? // Reference to DriveFile
  status       String                  @default("generating") // generating, ready, failed
  duration     Int? // seconds
  errorMessage String?                 @db.Text
  createdAt    DateTime                @default(now())
  completedAt  DateTime?
  tenant       Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  campaign     AIInfluencerCampaign    @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  character    AIInfluencerCharacter   @relation(fields: [characterId], references: [id], onDelete: Cascade)
  script       AIInfluencerScript      @relation(fields: [scriptId], references: [id], onDelete: Cascade)
  analytics    AIInfluencerAnalytics[]

  @@index([tenantId])
  @@index([tenantId, status])
  @@index([campaignId])
  @@index([characterId])
  @@index([scriptId])
}

model AIInfluencerAnalytics {
  id          String            @id @default(cuid())
  videoId     String
  tenantId    String
  platform    String? // meta, youtube, organic
  views       Int               @default(0)
  clicks      Int               @default(0)
  conversions Int               @default(0)
  revenue     Decimal?          @db.Decimal(10, 2)
  date        DateTime          @default(now())
  createdAt   DateTime          @default(now())
  tenant      Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  video       AIInfluencerVideo @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@index([videoId])
  @@index([tenantId])
  @@index([tenantId, date])
  @@index([platform])
}

// AI Decision Automation Models (Phase 2)
model AIDecision {
  id            String @id @default(cuid())
  tenantId      String
  type          String // 'send_invoice', 'apply_discount', etc.
  description   String
  riskScore     Int // 0-100
  approvalLevel String // 'AUTO_EXECUTE', 'AUDIT_LOG', 'MANAGER_APPROVAL', 'EXECUTIVE_APPROVAL'

  // Recommendation details
  recommendation     Json // Full recommendation from Co-Founder
  reasoningChain     String // "Why" explanation
  alternativeOptions Json? // Other options considered (array stored as JSON)
  confidenceScore    Float? // 0-1, how confident is AI

  // Execution status
  status     String    @default("pending") // pending, approved, rejected, executed, rolled_back
  approvedBy String?
  approvedAt DateTime?
  executedAt DateTime?

  // Execution details
  executionResult Json? // What happened when executed
  rollbackable    Boolean   @default(true)
  rolledBackAt    DateTime?

  // Audit trail
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  requestedBy   String // User ID who triggered
  tenant        Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  approvalQueue ApprovalQueue?

  @@index([tenantId])
  @@index([status])
  @@index([approvalLevel])
  @@index([createdAt])
  @@index([tenantId, status])
}

model ApprovalQueue {
  id         String     @id @default(cuid())
  decisionId String     @unique
  decision   AIDecision @relation(fields: [decisionId], references: [id], onDelete: Cascade)

  requiredApprovers String[] // User IDs
  approvedBy        String[] @default([])
  rejectedBy        String[] @default([])

  createdAt DateTime @default(now())
  expiresAt DateTime // Auto-reject if not approved in 24h
  priority  Int      @default(0) // For sorting approval queue

  @@index([createdAt])
  @@index([priority])
}

// Risk Policy & Historical Tracking (Week 7)
model RiskPolicy {
  id                       String   @id @default(cuid())
  tenantId                 String
  decisionType             String // DecisionType enum
  customBaseRisk           Int? // Override default base risk
  amountThreshold          Decimal? @db.Decimal(10, 2)
  autoApproveThreshold     Int? // Risk score below which to auto-approve
  requireApprovalThreshold Int? // Risk score above which to require approval
  maxAutoExecuteAmount     Decimal? @db.Decimal(10, 2) // Max amount for auto-execution
  enabled                  Boolean  @default(true)
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  tenant                   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, decisionType])
  @@index([tenantId])
  @@index([decisionType])
}

model DecisionOutcome {
  id               String   @id @default(cuid())
  decisionId       String
  tenantId         String
  decisionType     String // DecisionType enum
  riskScore        Int
  approvalLevel    String
  status           String
  wasApproved      Boolean  @default(false)
  wasRejected      Boolean  @default(false)
  wasRolledBack    Boolean  @default(false)
  executionSuccess Boolean
  executionError   String?
  actualImpact     Json? // { amount, affectedUsers, revenueImpact }
  createdAt        DateTime @default(now())
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([decisionType])
  @@index([createdAt])
  @@index([tenantId, decisionType])
}

// Approval Token for Email Approvals (Week 8)
model ApprovalToken {
  id         String    @id @default(cuid())
  decisionId String
  userId     String
  token      String    @unique
  expiresAt  DateTime
  used       Boolean   @default(false)
  usedAt     DateTime?
  createdAt  DateTime  @default(now())

  @@index([decisionId])
  @@index([userId])
  @@index([token])
  @@index([expiresAt])
}

// Comment model for collaboration (Phase 6)
model Comment {
  id             String   @id @default(cuid())
  content        String
  entityType     String // 'deal' | 'contact' | 'task' | 'project'
  entityId       String
  createdByRepId String
  tenantId       String
  parentId       String?
  mentions       String[] @default([])
  attachments    Json     @default("[]")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  createdByRep SalesRep  @relation("CommentCreatedBy", fields: [createdByRepId], references: [id], onDelete: Restrict)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Restrict)
  parent       Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies      Comment[] @relation("CommentReplies")

  @@index([entityType, entityId])
  @@index([tenantId])
  @@index([parentId])
}

// ActivityFeed model for collaboration (Phase 6)
model ActivityFeed {
  id          String   @id @default(cuid())
  tenantId    String
  type        String // 'comment' | 'update' | 'create' | 'delete' | etc.
  entityType  String // 'deal' | 'contact' | 'task' | 'project'
  entityId    String
  userId      String
  description String
  metadata    Json     @default("{}")
  createdAt   DateTime @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Restrict)
  user   User   @relation(fields: [userId], references: [id], onDelete: Restrict)

  @@index([tenantId])
  @@index([entityType, entityId])
  @@index([createdAt])
}

// ============================================
// CRM ENHANCEMENT MODELS (Gap Analysis Implementation)
// ============================================

// Web Forms & Lead Capture (Critical Gap #2)
model Form {
  id          String           @id @default(cuid())
  tenantId    String
  name        String
  description String?
  slug        String           @unique // For embed URLs: /forms/{slug}
  status      String           @default("draft") // draft, active, archived
  fields      FormField[]
  submissions FormSubmission[]
  settings    Json             @default("{}") // GDPR consent, redirect URL, notifications
  analytics   Json             @default("{}") // Conversion tracking
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  tenant      Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([slug])
  @@index([tenantId, status])
}

model FormField {
  id               String   @id @default(cuid())
  formId           String
  label            String
  type             String // text, email, phone, select, checkbox, radio, textarea, number, date
  placeholder      String?
  required         Boolean  @default(false)
  options          Json? // For select/radio/checkbox
  conditionalLogic Json? // IF/THEN display logic
  order            Int      @default(0)
  validation       Json? // Min/max length, regex patterns
  createdAt        DateTime @default(now())
  form             Form     @relation(fields: [formId], references: [id], onDelete: Cascade)

  @@index([formId])
  @@index([formId, order])
}

model FormSubmission {
  id          String    @id @default(cuid())
  formId      String
  tenantId    String
  contactId   String? // Auto-created contact
  data        Json // Field responses
  source      String? // Website URL, referrer
  ipAddress   String?
  userAgent   String?
  status      String    @default("new") // new, processed, converted, spam
  convertedAt DateTime?
  createdAt   DateTime  @default(now())
  form        Form      @relation(fields: [formId], references: [id], onDelete: Cascade)
  contact     Contact?  @relation(fields: [contactId], references: [id], onDelete: SetNull)
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([formId])
  @@index([tenantId])
  @@index([contactId])
  @@index([tenantId, createdAt])
  @@index([status])
}

// Territory & Quota Management (Critical Gap #3)
model Territory {
  id           String                @id @default(cuid())
  tenantId     String
  name         String
  description  String?
  criteria     Json // Geographic, industry, account size criteria
  assignedReps TerritoryAssignment[]
  quotas       Quota[]
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  tenant       Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model TerritoryAssignment {
  id          String    @id @default(cuid())
  territoryId String
  salesRepId  String
  role        String    @default("owner") // owner, member
  createdAt   DateTime  @default(now())
  territory   Territory @relation(fields: [territoryId], references: [id], onDelete: Cascade)
  salesRep    SalesRep  @relation(fields: [salesRepId], references: [id], onDelete: Cascade)

  @@unique([territoryId, salesRepId])
  @@index([salesRepId])
  @@index([territoryId])
}

model Quota {
  id          String     @id @default(cuid())
  tenantId    String
  territoryId String?
  salesRepId  String?
  period      String // monthly, quarterly, annual
  periodStart DateTime
  periodEnd   DateTime
  target      Float // Quota amount in INR
  actual      Float      @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  territory   Territory? @relation(fields: [territoryId], references: [id], onDelete: Cascade)
  salesRep    SalesRep?  @relation(fields: [salesRepId], references: [id], onDelete: Cascade)
  tenant      Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([salesRepId])
  @@index([territoryId])
  @@index([periodStart, periodEnd])
}

// Advanced Account Management (Critical Gap #4)
model Account {
  id                   String     @id @default(cuid())
  tenantId             String
  name                 String
  parentAccountId      String? // For account hierarchy
  type                 String? // customer, partner, competitor
  industry             String?
  annualRevenue        Float?
  employeeCount        Int?
  website              String?
  phone                String?
  email                String?
  address              String?
  city                 String?
  state                String?
  postalCode           String?
  country              String?    @default("India")
  healthScore          Float?     @default(0)
  healthScoreUpdatedAt DateTime?
  decisionTree         Json? // Decision maker mapping
  engagementTimeline   Json? // Interaction summary
  riskAssessment       Json? // Risk factors
  createdAt            DateTime   @default(now())
  updatedAt            DateTime   @updatedAt
  parentAccount        Account?   @relation("AccountHierarchy", fields: [parentAccountId], references: [id], onDelete: SetNull)
  childAccounts        Account[]  @relation("AccountHierarchy")
  contacts             Contact[]
  contracts            Contract[]
  tenant               Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([parentAccountId])
  @@index([tenantId, type])
}

// Quote/CPQ Management (Critical Gap - Implementation Review)
model Quote {
  id                  String          @id @default(cuid())
  tenantId            String
  dealId              String          @unique
  contactId           String?
  quoteNumber         String          @unique
  status              String          @default("draft") // draft, pending_approval, sent, viewed, accepted, expired, rejected
  requiresApproval    Boolean         @default(false)
  approvalWorkflow    Json? // Approval workflow configuration
  lineItems           QuoteLineItem[]
  subtotal            Float
  tax                 Float           @default(0)
  discount            Float           @default(0)
  total               Float
  validUntil          DateTime?
  acceptedAt          DateTime?
  rejectedAt          DateTime?
  rejectionReason     String?
  notes               String?
  signatureEnvelopeId String? // E-signature envelope ID (DocuSign, HelloSign)
  signatureProvider   String? // DOCUSIGN, HELLOSIGN, E_MUDRA, MANUAL
  signatureStatus     String? // pending, sent, signed, completed, declined
  signedAt            DateTime?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  deal                Deal            @relation(fields: [dealId], references: [id], onDelete: Cascade)
  contact             Contact?        @relation(fields: [contactId], references: [id], onDelete: SetNull)
  tenant              Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  approvals           QuoteApproval[]

  @@index([tenantId])
  @@index([dealId])
  @@index([contactId])
  @@index([status])
  @@index([quoteNumber])
}

model QuoteApproval {
  id            String    @id @default(cuid())
  quoteId       String
  approverId    String
  approverName  String
  approverEmail String
  approvalOrder Int // Order in approval chain (1, 2, 3, etc.)
  status        String    @default("PENDING") // PENDING, APPROVED, REJECTED
  comments      String?
  approvedAt    DateTime?
  rejectedAt    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  quote         Quote     @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([approverId])
  @@index([status])
}

model QuoteLineItem {
  id          String   @id @default(cuid())
  quoteId     String
  productId   String?
  productName String
  description String?
  quantity    Int      @default(1)
  unitPrice   Float
  discount    Float    @default(0)
  total       Float
  createdAt   DateTime @default(now())
  quote       Quote    @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([productId])
}

// Contract model enhanced above - no duplicate needed

// ============================================
// PHASE 1: RBAC (Role-Based Access Control)
// ============================================

// Roles: Define job titles/positions
model Role {
  id          String  @id @default(cuid())
  tenantId    String
  roleName    String
  description String?

  // Role Type
  roleType String @default("custom") // 'admin', 'manager', 'user', 'custom'

  // Permissions (denormalized for performance)
  permissions Json @default("[]")

  // Configuration
  isSystem Boolean @default(false) // Cannot be deleted
  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant          Tenant           @relation("TenantRoles", fields: [tenantId], references: [id], onDelete: Cascade)
  userRoles       UserRole[]
  moduleAccess    ModuleAccess[]
  rolePermissions RolePermission[]

  @@unique([tenantId, roleName])
  @@index([tenantId])
  @@index([roleType])
}

// User Roles: Assign roles to users
model UserRole {
  id       String @id @default(cuid())
  tenantId String
  userId   String
  roleId   String

  // Role assignment details
  assignedById String?
  assignedAt   DateTime  @default(now())
  expiresAt    DateTime? // For temporary role assignments

  // Additional context
  department String?
  teamId     String?

  metadata Json @default("{}")

  // Relations
  tenant     Tenant @relation("TenantUserRoles", fields: [tenantId], references: [id], onDelete: Cascade)
  user       User   @relation("UserRoles", fields: [userId], references: [id], onDelete: Cascade)
  role       Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  assignedBy User?  @relation("AssignedUserRoles", fields: [assignedById], references: [id])

  @@unique([tenantId, userId, roleId])
  @@index([tenantId, userId])
  @@index([roleId])
  @@index([expiresAt])
}

// Module Access: Control which modules users can access
model ModuleAccess {
  id       String @id @default(cuid())
  tenantId String
  roleId   String

  moduleName String // 'crm', 'hr', 'accounting', etc.

  // Access levels
  canView   Boolean @default(false)
  canCreate Boolean @default(false)
  canEdit   Boolean @default(false)
  canDelete Boolean @default(false)
  canAdmin  Boolean @default(false)

  // Field-level access
  visibleFields  Json @default("[]") // ["email", "phone"] - null = all
  editableFields Json @default("[]")

  // Record-level access
  viewScope String @default("own") // 'own', 'team', 'all', 'none'
  editScope String @default("own") // Can edit 'own' records or 'all' or 'team'

  // Advanced restrictions
  customFilters Json @default("{}") // {"department": "sales"}

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant Tenant @relation("TenantModuleAccess", fields: [tenantId], references: [id], onDelete: Cascade)
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([tenantId, roleId, moduleName])
  @@index([tenantId, roleId])
  @@index([moduleName])
}

// Permissions: Define individual permissions
model Permission {
  id       String @id @default(cuid())
  tenantId String

  permissionCode String // 'crm:read_leads', 'hr:manage_employees'
  description    String?
  moduleName     String
  action         String? // 'read', 'create', 'update', 'delete', 'admin'

  isSystem Boolean @default(false)

  createdAt DateTime @default(now())

  // Relations
  tenant          Tenant           @relation("TenantPermissions", fields: [tenantId], references: [id], onDelete: Cascade)
  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  @@unique([tenantId, permissionCode])
  @@index([tenantId])
  @@index([moduleName])
  @@index([permissionCode])
}

// Role Permissions: Assign permissions to roles
model RolePermission {
  id           String @id @default(cuid())
  tenantId     String
  roleId       String
  permissionId String

  createdAt DateTime @default(now())

  // Relations
  tenant     Tenant     @relation("TenantRolePermissions", fields: [tenantId], references: [id], onDelete: Cascade)
  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([tenantId, roleId, permissionId])
  @@index([tenantId, roleId])
  @@index([permissionId])
}

// User Permissions: Direct permission assignment (edge cases)
model UserPermission {
  id           String @id @default(cuid())
  tenantId     String
  userId       String
  permissionId String

  permissionCode String // Denormalized for quick lookup

  // Duration
  grantedById String?
  grantedAt   DateTime  @default(now())
  expiresAt   DateTime?

  reason String?

  // Relations
  tenant     Tenant     @relation("TenantUserPermissions", fields: [tenantId], references: [id], onDelete: Cascade)
  user       User       @relation("UserPermissions", fields: [userId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  grantedBy  User?      @relation("GrantedUserPermissions", fields: [grantedById], references: [id])

  @@unique([tenantId, userId, permissionCode])
  @@index([tenantId, userId])
  @@index([permissionId])
  @@index([expiresAt])
}

// ============================================
// FINANCIAL DASHBOARD MODULE 1.3 MODELS
// ============================================

// Chart of Accounts (Master Data)
model ChartOfAccounts {
  id                 String            @id @default(cuid())
  tenantId           String
  accountCode        String
  accountName        String
  accountType        String // 'asset', 'liability', 'equity', 'revenue', 'expense'
  subType            String? // 'current_asset', 'fixed_asset', etc.
  parentAccountId    String?
  parentAccount      ChartOfAccounts?  @relation("AccountHierarchy", fields: [parentAccountId], references: [id])
  childAccounts      ChartOfAccounts[] @relation("AccountHierarchy")
  isActive           Boolean           @default(true)
  description        String?
  accountGroup       String? // For reporting grouping
  currency           String            @default("INR")
  openingBalance     Decimal           @default(0) @db.Decimal(15, 2)
  openingBalanceDate DateTime?
  metadata           Json?             @default("{}")
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  // Relations
  tenant             Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  debitTransactions  FinancialTransaction[] @relation("DebitAccount")
  creditTransactions FinancialTransaction[] @relation("CreditAccount")
  generalLedger      GeneralLedger[]
  budgets            FinancialBudget[]
  variances          FinancialVariance[]

  @@unique([tenantId, accountCode])
  @@index([tenantId, accountType])
  @@index([parentAccountId])
  @@index([tenantId, isActive])
  @@map("chart_of_accounts")
}

// Financial Transactions (Fact Table - Immutable)
model FinancialTransaction {
  id                   String          @id @default(cuid())
  tenantId             String
  transactionDate      DateTime        @db.Date
  transactionType      String // 'invoice', 'payment', 'expense', 'journal', 'bank_feed'
  transactionCode      String?
  sourceModule         String? // 'crm_invoice', 'payment_gateway', 'bank_feed', 'manual'
  sourceId             String?
  amount               Decimal         @db.Decimal(15, 2)
  amountInBaseCurrency Decimal         @db.Decimal(15, 2)
  currency             String          @default("INR")
  exchangeRate         Decimal         @default(1) @db.Decimal(10, 6)
  description          String?
  notes                String?
  referenceNumber      String?
  relatedEntityId      String?
  relatedEntityType    String? // 'customer', 'vendor', 'employee'
  debitAccountId       String
  debitAccount         ChartOfAccounts @relation("DebitAccount", fields: [debitAccountId], references: [id])
  creditAccountId      String
  creditAccount        ChartOfAccounts @relation("CreditAccount", fields: [creditAccountId], references: [id])
  isPosted             Boolean         @default(false)
  postedDate           DateTime?
  postedById           String?
  isReconciled         Boolean         @default(false)
  reconciledDate       DateTime?
  bankStatementDate    DateTime?       @db.Date
  requiresApproval     Boolean         @default(false)
  approvalStatus       String          @default("pending") // 'pending', 'approved', 'rejected'
  approvedById         String?
  approvedDate         DateTime?
  createdById          String?
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, transactionDate])
  @@index([debitAccountId, creditAccountId])
  @@index([tenantId, isPosted, approvalStatus])
  @@index([sourceModule, sourceId])
  @@map("financial_transactions")
}

// General Ledger (Denormalized for performance)
model GeneralLedger {
  id               String          @id @default(cuid())
  tenantId         String
  fiscalYear       Int
  fiscalMonth      Int
  periodStartDate  DateTime        @db.Date
  periodEndDate    DateTime        @db.Date
  accountId        String
  account          ChartOfAccounts @relation(fields: [accountId], references: [id])
  openingBalance   Decimal         @default(0) @db.Decimal(15, 2)
  debitTotal       Decimal         @default(0) @db.Decimal(15, 2)
  creditTotal      Decimal         @default(0) @db.Decimal(15, 2)
  closingBalance   Decimal         @default(0) @db.Decimal(15, 2)
  transactionCount Int             @default(0)
  lastUpdated      DateTime        @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, fiscalYear, fiscalMonth, accountId])
  @@index([tenantId, fiscalYear, fiscalMonth])
  @@index([accountId])
  @@map("general_ledger")
}

// Financial Periods (Calendar)
model FinancialPeriod {
  id              String    @id @default(cuid())
  tenantId        String
  fiscalYear      Int
  fiscalMonth     Int
  monthName       String?
  periodStartDate DateTime  @db.Date
  periodEndDate   DateTime  @db.Date
  isClosed        Boolean   @default(false)
  closedDate      DateTime?
  closedById      String?
  budgetRevenue   Decimal?  @db.Decimal(15, 2)
  budgetExpense   Decimal?  @db.Decimal(15, 2)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, fiscalYear, fiscalMonth])
  @@index([tenantId, fiscalYear])
  @@map("financial_periods")
}

// Budget Data (for variance analysis)
model FinancialBudget {
  id             String          @id @default(cuid())
  tenantId       String
  budgetName     String
  fiscalYear     Int
  accountId      String
  account        ChartOfAccounts @relation(fields: [accountId], references: [id])
  fiscalMonth    Int
  budgetedAmount Decimal         @db.Decimal(15, 2)
  isApproved     Boolean         @default(false)
  createdById    String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, budgetName, fiscalYear, accountId, fiscalMonth])
  @@index([tenantId, fiscalYear])
  @@map("financial_budgets")
}

// Variance Records (computed)
model FinancialVariance {
  id                    String          @id @default(cuid())
  tenantId              String
  fiscalYear            Int
  fiscalMonth           Int
  accountId             String
  account               ChartOfAccounts @relation(fields: [accountId], references: [id])
  budgetedAmount        Decimal         @db.Decimal(15, 2)
  actualAmount          Decimal         @db.Decimal(15, 2)
  varianceAmount        Decimal         @db.Decimal(15, 2)
  variancePercentage    Decimal         @db.Decimal(5, 2)
  varianceType          String? // 'favorable', 'unfavorable', 'neutral'
  requiresInvestigation Boolean         @default(false)
  investigationNotes    String?
  investigatedById      String?
  investigatedAt        DateTime?
  computedAt            DateTime        @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, fiscalYear, fiscalMonth, accountId])
  @@index([tenantId, fiscalYear, fiscalMonth])
  @@map("financial_variance")
}

// Forecasts (predictive)
model FinancialForecast {
  id               String   @id @default(cuid())
  tenantId         String
  forecastName     String?
  forecastType     String // 'cash_flow', 'revenue', 'expense'
  forecastDate     DateTime @db.Date
  startDate        DateTime @db.Date
  endDate          DateTime @db.Date
  forecastedValues Json // {"2024-02-01": 50000, "2024-03-01": 55000}
  confidenceLevel  Int? // 0-100%
  method           String? // 'moving_average', 'trend', 'ml_model', 'manual'
  createdById      String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, forecastType])
  @@index([tenantId, forecastDate])
  @@map("financial_forecasts")
}

// Alerts Configuration
model FinancialAlert {
  id                    String   @id @default(cuid())
  tenantId              String
  alertName             String
  alertType             String // 'variance', 'cash_flow', 'budget', 'anomaly'
  conditionType         String // 'threshold', 'percentage', 'comparison'
  conditionValue        Decimal? @db.Decimal(15, 2)
  conditionOperator     String? // '>', '<', '>=', '<=', '=='
  appliesToAccountId    String?
  appliesToAccountGroup String?
  notifyEmails          Json?    @default("[]")
  notifySlack           Boolean  @default(false)
  notifyInApp           Boolean  @default(true)
  triggerWorkflow       String?
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  tenant    Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  alertLogs FinancialAlertLog[]

  @@index([tenantId, isActive])
  @@map("financial_alerts")
}

// Alert History (immutable log)
model FinancialAlertLog {
  id                  String         @id @default(cuid())
  tenantId            String
  alertId             String
  alert               FinancialAlert @relation(fields: [alertId], references: [id], onDelete: Cascade)
  triggerDate         DateTime       @default(now())
  triggeredAccountId  String?
  triggeredValue      Decimal?       @db.Decimal(15, 2)
  notificationsSent   Json?
  workflowTriggered   String?
  workflowExecutionId String?
  acknowledged        Boolean        @default(false)
  acknowledgedById    String?
  acknowledgedAt      DateTime?
  createdAt           DateTime       @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, triggerDate])
  @@index([alertId])
  @@map("financial_alert_logs")
}

// Cash Flow Projection
model CashFlowProjection {
  id                  String   @id @default(cuid())
  tenantId            String
  projectionDate      DateTime @db.Date
  projectionDaysAhead Int?
  projectionData      Json // {"2024-02-01": {"opening_cash": 100000, "inflows": 50000, "outflows": 30000, "closing_cash": 120000}}
  confidenceLevel     Int? // 0-100%
  accuracyNotes       String?
  isPublished         Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, projectionDate])
  @@map("cash_flow_projections")
}
